"use strict";

/*----------
try..catch конструкция для обработки ошибок.
Не позволить ошибкам остановить исполнение скрипта
----------*/

try {
  //some code
} catch (err) {}
//do smth with error object

/*Объект ошибки:
error = {
  name: "error name & type"
  message: "more info about error"
  stack: "stack trace caused this error"
}
*/

function example1() {
  var data = "Has Error"; // в данных ошибка

  try {
    var user = JSON.parse(data); // <-- ошибка при выполнении
    console.log(user.name); // не сработает
  } catch (e) {
    // ...выполнится catch
    console.log("Sorry, your data is incorrect");
    console.log(e.name);
    console.log(e.message);
  }
}
// example1()

/* ----------
Генерация ошибок с помощью оператора throw
---------- */
function example2() {
  var data = '{ "age": "30"}'; //неполные данные
  try {
    var user = JSON.parse(data); // выполняется без ошибки
    if (!user.name) {
      throw new SyntaxError("Incorrect data"); //если нет имени - выбрасываем ошибку
    }
  } catch (e) {
    console.log("Sorry, your data is incorrect");
  }
}
// example2()

/* ----------
Проброс исключения:
анализируем в catch(e), если ошибка не подходит - выбрасываем наружу через throw

!!!Ошибку, о которой catch не знает, он не должен обрабатывать.
---------- */

function example3() {
  var data = '{"name": "Tom", "age": "30"}'; //правильные данные

  try {
    var user = JSON.parse(data); // ошибок нет
    if (!user.name) {
      // ошибок нет
      throw new SyntaxError("Incorrect data");
    };
    errorCauseFunction(); // непредусмотренная ошибка :(
  } catch (e) {
    if (e.name === "SyntaxError") {
      console.log("Sorry, your data is incorrect");
    } else {
      throw e; //Проброс ошибки наружу
    }
  }
}
// example3()

/* --------------------------------
  Проброшенную ошибку, можно обработать внутри внешнего try..catch
-------------------------------------- */

function example4() {
  function readData() {
    var data = '{ "name": "Вася", "age": 30 }';

    try {
      blabla(); // ошибка!
    } catch (e) {
      if (e.name != 'SyntaxError') {
        throw e; // пробрасываем
      }
    }
  }

  try {
    readData();
  } catch (e) {
    console.log("Поймал во внешнем catch: " + e); // ловим
  }
}
// example4()

/*----------------------------------------------
Оборачивание исключений

Каждый участок фукнционала должен получать информацию
на том уровне, который ему необходим
----------------------------------------------*/

function example5() {

  /*ошибки низкого уровня оборачиваем в ReadError*/
  function ReadError(message, cause) {
    this.name = "ReadError";
    this.message = message;
    this.cause = cause; //сохраняем оригинальную ошибку
    this.stack = cause.stack;
  }

  function readData() {
    var data = '{ bad data }';

    try {
      JSON.parse(data);
    } catch (e) {
      if (e.name === "URIError") {
        throw new ReadError("Requested URI is incorrect", e);
      } else if (e.name === "SyntaxError") {
        throw new ReadError("Data syntax is incorrect", e);
      } else {
        throw e;
      }
    }
  }

  try {
    readData();
  } catch (e) {
    if (e.name === "ReadError") {
      console.log(e.message);
      console.log(e.cause); //оригинальная ошибка-причина
    } else {
        throw e;
      }
  }
}
// example5()

/*--------------------------------------------
  Конструкция finally

  generateError true ->  try..catch..finally
  generateError false -> try..finally
--------------------------------------------*/

function example6() {
  var generateError = true;

  try {
    console.log('try');
    if (generateError) {
      BAD_CODE();
    };
  } catch (e) {
    console.log('catch');
  } finally {
    console.log('finally');
  }
}
// example6()

/*
пример: Здесь секция finally гарантирует,
что время будет подсчитано в любых ситуациях — при ошибке в sum или без неё.
*/

function example7() {
  function sum(n) {
    return n ? n + sum(n - 1) : 0;
  }
  var n = +prompt('Введите n?', 100);

  var start = new Date();

  try {
    var result = sum(n);
  } catch (e) {
    result = 0;
  } finally {
    var diff = new Date() - start;
  }

  alert(result ? result : 'была ошибка');
  alert("Выполнение заняло " + diff);
}
// example7()

/*
Finally и return
В примере ниже, из try происходит return,
но finally получает управление ДО того, как контроль возвращается во внешний код.
*/
function example8() {

  function func() {
    try {
      return 1; // сразу вернуть значение
    } catch (e) {
      /* ... */
    } finally {
      console.log('finally');
    }
  }
  console.log(func()); // сначала finally, потом 1
}
// example8()

/*
Если внутри try были начаты какие-то процессы,
которые нужно завершить по окончании работы, то в finally это обязательно будет сделано.

Кстати, для таких случаев иногда используют try..finally вообще без catch:
*/
function example9() {
  function func() {
    try {
      return 1;
    } finally {
      console.log('Вызов завершён');
    }
  }

  console.log(func()); // сначала finally, потом 1
}
// example9()

/* ------------------------------------------
  window.onerror
  в случае любой ошибки в коде - выполнит функцию
------------------------------------------*/
function example10() {
  window.onerror = function (message, url, lineNumber) {
    alert("Поймана ошибка, выпавшая в глобальную область!\n" + "Сообщение: " + message + "\n(" + url + ":" + lineNumber + ")");
  };

  function readData() {
    error(); // ой, что-то не так
  }

  readData();
}
// example10()

/*--------------------------------------------------------------------*/

/*Задача 1:
Нужно, чтобы код финализации всегда выполнялся при выходе из блока try..catch и,
таким образом, заканчивал начатую работу.
Имеет ли здесь finally какое-то преимущество или оба фрагмента работают одинаково?

Если имеет, то дайте пример когда код с finally работает верно, а без — неверно.
*/
function exercise1() {
  try {
    GEN_ERROR();
  } catch (e) {
    if (e.name === "SytaxError") {
      console.log(e.name, e.message);
    } else {
      throw e;
    };
  } finally {}
  //this code will be executed

  //this code nope
}
// exercise1()

/*Задача 2:
Напишите интерфейс, который принимает математическое выражение (в prompt) и результат его вычисления через eval.
При ошибке нужно выводить сообщение и просить переввести выражение.
*/
function exercise2() {

  function evalCalculator() {
    function getUserPrompt() {
      return prompt('Enter phraze to calc', 0);
    }
    try {
      var result = eval(getUserPrompt());
      if (typeof result !== 'number' || isNaN(result) !== false) {
        throw new Error('Incorrect data');
      };
      console.log(result);
      return result;
    } catch (e) {
      console.log("Sorry, there is a " + e.name + "\n" + e.message);
      evalCalculator();
    }
  }

  evalCalculator();
}

// exercise2();
//# sourceMappingURL=data:application/json;base64,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QU8sTUFBTSxDQUFDO0tBRWYsQ0FBQyxPQUFNLENBQUMsRUFBQztBQUNSLGFBQU8sQ0FBQyxHQUFHLENBQUMsb0JBQW9CLEdBQUcsQ0FBQyxDQUFDLElBQUksR0FBRyxJQUFJLEdBQUcsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzlELG9CQUFjLEVBQUUsQ0FBQTtLQUNqQjtHQUNGOztBQUVELGdCQUFjLEVBQUUsQ0FBQztDQUNsQjs7O0FBQUEiLCJmaWxlIjoicGFydDEvb3RoZXJfcG9zc2liaWxpdGllcy8wNC50cnlfY2F0Y2guanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKi0tLS0tLS0tLS1cbnRyeS4uY2F0Y2gg0LrQvtC90YHRgtGA0YPQutGG0LjRjyDQtNC70Y8g0L7QsdGA0LDQsdC+0YLQutC4INC+0YjQuNCx0L7Qui5cbtCd0LUg0L/QvtC30LLQvtC70LjRgtGMINC+0YjQuNCx0LrQsNC8INC+0YHRgtCw0L3QvtCy0LjRgtGMINC40YHQv9C+0LvQvdC10L3QuNC1INGB0LrRgNC40L/RgtCwXG4tLS0tLS0tLS0tKi9cblxuXG50cnkge1xuICAvL3NvbWUgY29kZVxufSBjYXRjaCAoZXJyKSB7XG4gIC8vZG8gc210aCB3aXRoIGVycm9yIG9iamVjdFxufVxuXG5cbi8q0J7QsdGK0LXQutGCINC+0YjQuNCx0LrQuDpcbmVycm9yID0ge1xuICBuYW1lOiBcImVycm9yIG5hbWUgJiB0eXBlXCJcbiAgbWVzc2FnZTogXCJtb3JlIGluZm8gYWJvdXQgZXJyb3JcIlxuICBzdGFjazogXCJzdGFjayB0cmFjZSBjYXVzZWQgdGhpcyBlcnJvclwiXG59XG4qL1xuXG5mdW5jdGlvbiBleGFtcGxlMSgpIHtcbiAgdmFyIGRhdGEgPSBcIkhhcyBFcnJvclwiOyAvLyDQsiDQtNCw0L3QvdGL0YUg0L7RiNC40LHQutCwXG5cbiAgdHJ5IHtcbiAgICB2YXIgdXNlciA9IEpTT04ucGFyc2UoZGF0YSk7IC8vIDwtLSDQvtGI0LjQsdC60LAg0L/RgNC4INCy0YvQv9C+0LvQvdC10L3QuNC4XG4gICAgY29uc29sZS5sb2coIHVzZXIubmFtZSApOyAvLyDQvdC1INGB0YDQsNCx0L7RgtCw0LXRglxuXG4gIH0gY2F0Y2ggKGUpIHtcbiAgICAvLyAuLi7QstGL0L/QvtC70L3QuNGC0YHRjyBjYXRjaFxuICAgIGNvbnNvbGUubG9nKCBcIlNvcnJ5LCB5b3VyIGRhdGEgaXMgaW5jb3JyZWN0XCIgKTtcbiAgICBjb25zb2xlLmxvZyggZS5uYW1lICk7XG4gICAgY29uc29sZS5sb2coIGUubWVzc2FnZSApO1xuICB9XG59XG4vLyBleGFtcGxlMSgpXG5cblxuXG4vKiAtLS0tLS0tLS0tXG7Qk9C10L3QtdGA0LDRhtC40Y8g0L7RiNC40LHQvtC6INGBINC/0L7QvNC+0YnRjNGOINC+0L/QtdGA0LDRgtC+0YDQsCB0aHJvd1xuLS0tLS0tLS0tLSAqL1xuZnVuY3Rpb24gZXhhbXBsZTIgKCkge1xuICB2YXIgZGF0YSA9ICd7IFwiYWdlXCI6IFwiMzBcIn0nOyAvL9C90LXQv9C+0LvQvdGL0LUg0LTQsNC90L3Ri9C1XG4gIHRyeSB7XG4gICAgdmFyIHVzZXIgPSBKU09OLnBhcnNlKGRhdGEpOyAvLyDQstGL0L/QvtC70L3Rj9C10YLRgdGPINCx0LXQtyDQvtGI0LjQsdC60LhcbiAgICBpZiAoIXVzZXIubmFtZSkge1xuICAgICAgdGhyb3cgbmV3IFN5bnRheEVycm9yKFwiSW5jb3JyZWN0IGRhdGFcIikgLy/QtdGB0LvQuCDQvdC10YIg0LjQvNC10L3QuCAtINCy0YvQsdGA0LDRgdGL0LLQsNC10Lwg0L7RiNC40LHQutGDXG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgY29uc29sZS5sb2coXCJTb3JyeSwgeW91ciBkYXRhIGlzIGluY29ycmVjdFwiKTtcbiAgfVxufVxuLy8gZXhhbXBsZTIoKVxuXG5cblxuLyogLS0tLS0tLS0tLVxu0J/RgNC+0LHRgNC+0YEg0LjRgdC60LvRjtGH0LXQvdC40Y86XG7QsNC90LDQu9C40LfQuNGA0YPQtdC8INCyIGNhdGNoKGUpLCDQtdGB0LvQuCDQvtGI0LjQsdC60LAg0L3QtSDQv9C+0LTRhdC+0LTQuNGCIC0g0LLRi9Cx0YDQsNGB0YvQstCw0LXQvCDQvdCw0YDRg9C20YMg0YfQtdGA0LXQtyB0aHJvd1xuXG4hISHQntGI0LjQsdC60YMsINC+INC60L7RgtC+0YDQvtC5IGNhdGNoINC90LUg0LfQvdCw0LXRgiwg0L7QvSDQvdC1INC00L7Qu9C20LXQvSDQvtCx0YDQsNCx0LDRgtGL0LLQsNGC0YwuXG4tLS0tLS0tLS0tICovXG5cbmZ1bmN0aW9uIGV4YW1wbGUzICgpIHtcbiAgdmFyIGRhdGEgPSAne1wibmFtZVwiOiBcIlRvbVwiLCBcImFnZVwiOiBcIjMwXCJ9JzsgLy/Qv9GA0LDQstC40LvRjNC90YvQtSDQtNCw0L3QvdGL0LVcblxuICB0cnkge1xuICAgIHZhciB1c2VyID0gSlNPTi5wYXJzZShkYXRhKTsgLy8g0L7RiNC40LHQvtC6INC90LXRglxuICAgIGlmICghdXNlci5uYW1lKSB7IC8vINC+0YjQuNCx0L7QuiDQvdC10YJcbiAgICAgIHRocm93IG5ldyBTeW50YXhFcnJvcihcIkluY29ycmVjdCBkYXRhXCIpXG4gICAgfTtcbiAgICBlcnJvckNhdXNlRnVuY3Rpb24oKSAvLyDQvdC10L/RgNC10LTRg9GB0LzQvtGC0YDQtdC90L3QsNGPINC+0YjQuNCx0LrQsCA6KFxuXG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBpZiAoZS5uYW1lID09PSBcIlN5bnRheEVycm9yXCIpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiU29ycnksIHlvdXIgZGF0YSBpcyBpbmNvcnJlY3RcIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IGU7IC8v0J/RgNC+0LHRgNC+0YEg0L7RiNC40LHQutC4INC90LDRgNGD0LbRg1xuICAgIH1cbiAgfVxufVxuLy8gZXhhbXBsZTMoKVxuXG5cblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAg0J/RgNC+0LHRgNC+0YjQtdC90L3Rg9GOINC+0YjQuNCx0LrRgywg0LzQvtC20L3QviDQvtCx0YDQsNCx0L7RgtCw0YLRjCDQstC90YPRgtGA0Lgg0LLQvdC10YjQvdC10LPQviB0cnkuLmNhdGNoXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAqL1xuXG5cbmZ1bmN0aW9uIGV4YW1wbGU0ICgpIHtcbiAgZnVuY3Rpb24gcmVhZERhdGEoKSB7XG4gICAgdmFyIGRhdGEgPSAneyBcIm5hbWVcIjogXCLQktCw0YHRj1wiLCBcImFnZVwiOiAzMCB9JztcblxuICAgIHRyeSB7XG4gICAgICBibGFibGEoKTsgLy8g0L7RiNC40LHQutCwIVxuXG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgaWYgKGUubmFtZSAhPSAnU3ludGF4RXJyb3InKSB7XG4gICAgICAgIHRocm93IGU7IC8vINC/0YDQvtCx0YDQsNGB0YvQstCw0LXQvFxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRyeSB7XG4gICAgcmVhZERhdGEoKTtcbiAgfSBjYXRjaCAoZSkge1xuICAgIGNvbnNvbGUubG9nKCBcItCf0L7QudC80LDQuyDQstC+INCy0L3QtdGI0L3QtdC8IGNhdGNoOiBcIiArIGUgKTsgLy8g0LvQvtCy0LjQvFxuICB9XG59XG4vLyBleGFtcGxlNCgpXG5cblxuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbtCe0LHQvtGA0LDRh9C40LLQsNC90LjQtSDQuNGB0LrQu9GO0YfQtdC90LjQuVxuXG7QmtCw0LbQtNGL0Lkg0YPRh9Cw0YHRgtC+0Log0YTRg9C60L3RhtC40L7QvdCw0LvQsCDQtNC+0LvQttC10L0g0L/QvtC70YPRh9Cw0YLRjCDQuNC90YTQvtGA0LzQsNGG0LjRjlxu0L3QsCDRgtC+0Lwg0YPRgNC+0LLQvdC1LCDQutC+0YLQvtGA0YvQuSDQtdC80YMg0L3QtdC+0LHRhdC+0LTQuNC8XG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuZnVuY3Rpb24gZXhhbXBsZTUgKCkge1xuXG4gIC8q0L7RiNC40LHQutC4INC90LjQt9C60L7Qs9C+INGD0YDQvtCy0L3RjyDQvtCx0L7RgNCw0YfQuNCy0LDQtdC8INCyIFJlYWRFcnJvciovXG4gIGZ1bmN0aW9uIFJlYWRFcnJvciAobWVzc2FnZSwgY2F1c2UpIHtcbiAgICB0aGlzLm5hbWUgPSBcIlJlYWRFcnJvclwiO1xuICAgIHRoaXMubWVzc2FnZSA9IG1lc3NhZ2U7XG4gICAgdGhpcy5jYXVzZSA9IGNhdXNlOyAvL9GB0L7RhdGA0LDQvdGP0LXQvCDQvtGA0LjQs9C40L3QsNC70YzQvdGD0Y4g0L7RiNC40LHQutGDXG4gICAgdGhpcy5zdGFjayA9IGNhdXNlLnN0YWNrO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVhZERhdGEoKSB7XG4gICAgdmFyIGRhdGEgPSAneyBiYWQgZGF0YSB9JztcblxuICAgIHRyeSB7XG4gICAgICBKU09OLnBhcnNlKGRhdGEpO1xuICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgIGlmIChlLm5hbWUgPT09IFwiVVJJRXJyb3JcIikge1xuICAgICAgICB0aHJvdyBuZXcgUmVhZEVycm9yKFwiUmVxdWVzdGVkIFVSSSBpcyBpbmNvcnJlY3RcIiwgZSlcbiAgICAgIH0gZWxzZSBpZiAoZS5uYW1lID09PSBcIlN5bnRheEVycm9yXCIpIHtcbiAgICAgICAgdGhyb3cgbmV3IFJlYWRFcnJvcihcIkRhdGEgc3ludGF4IGlzIGluY29ycmVjdFwiLCBlKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgZVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHRyeSB7XG4gICAgcmVhZERhdGEoKTtcblxuICB9IGNhdGNoKGUpIHtcbiAgICBpZiAoZS5uYW1lID09PSBcIlJlYWRFcnJvclwiKSB7XG4gICAgICBjb25zb2xlLmxvZyhlLm1lc3NhZ2UpXG4gICAgICBjb25zb2xlLmxvZyhlLmNhdXNlKSAvL9C+0YDQuNCz0LjQvdCw0LvRjNC90LDRjyDQvtGI0LjQsdC60LAt0L/RgNC40YfQuNC90LBcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgZTtcbiAgICB9XG4gIH1cbn1cbi8vIGV4YW1wbGU1KClcblxuXG5cblxuLyotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICDQmtC+0L3RgdGC0YDRg9C60YbQuNGPIGZpbmFsbHlcblxuICBnZW5lcmF0ZUVycm9yIHRydWUgLT4gIHRyeS4uY2F0Y2guLmZpbmFsbHlcbiAgZ2VuZXJhdGVFcnJvciBmYWxzZSAtPiB0cnkuLmZpbmFsbHlcbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuZnVuY3Rpb24gZXhhbXBsZTYoKSB7XG4gIHZhciBnZW5lcmF0ZUVycm9yID0gdHJ1ZTtcblxuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKCd0cnknKTtcbiAgICBpZiAoZ2VuZXJhdGVFcnJvcikge1xuICAgICAgQkFEX0NPREUoKVxuICAgIH07XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICBjb25zb2xlLmxvZygnY2F0Y2gnKTtcbiAgfSBmaW5hbGx5IHtcbiAgICBjb25zb2xlLmxvZygnZmluYWxseScpO1xuICB9XG59XG4vLyBleGFtcGxlNigpXG5cblxuXG4vKlxu0L/RgNC40LzQtdGAOiDQl9C00LXRgdGMINGB0LXQutGG0LjRjyBmaW5hbGx5INCz0LDRgNCw0L3RgtC40YDRg9C10YIsXG7Rh9GC0L4g0LLRgNC10LzRjyDQsdGD0LTQtdGCINC/0L7QtNGB0YfQuNGC0LDQvdC+INCyINC70Y7QsdGL0YUg0YHQuNGC0YPQsNGG0LjRj9GFIOKAlCDQv9GA0Lgg0L7RiNC40LHQutC1INCyIHN1bSDQuNC70Lgg0LHQtdC3INC90LXRkS5cbiovXG5cbmZ1bmN0aW9uIGV4YW1wbGU3KCkge1xuICBmdW5jdGlvbiBzdW0obikge1xuICAgIHJldHVybiBuID8gKG4gKyBzdW0obiAtIDEpKSA6IDA7XG4gIH1cbiAgdmFyIG4gPSArcHJvbXB0KCfQktCy0LXQtNC40YLQtSBuPycsIDEwMCk7XG5cbiAgdmFyIHN0YXJ0ID0gbmV3IERhdGUoKTtcblxuICB0cnkge1xuICAgIHZhciByZXN1bHQgPSBzdW0obik7XG4gIH0gY2F0Y2ggKGUpIHtcbiAgICByZXN1bHQgPSAwO1xuICB9IGZpbmFsbHkge1xuICAgIHZhciBkaWZmID0gbmV3IERhdGUoKSAtIHN0YXJ0O1xuICB9XG5cbiAgYWxlcnQoIHJlc3VsdCA/IHJlc3VsdCA6ICfQsdGL0LvQsCDQvtGI0LjQsdC60LAnICk7XG4gIGFsZXJ0KCBcItCS0YvQv9C+0LvQvdC10L3QuNC1INC30LDQvdGP0LvQviBcIiArIGRpZmYgKTtcbn1cbi8vIGV4YW1wbGU3KClcblxuXG5cblxuLypcbkZpbmFsbHkg0LggcmV0dXJuXG7QkiDQv9GA0LjQvNC10YDQtSDQvdC40LbQtSwg0LjQtyB0cnkg0L/RgNC+0LjRgdGF0L7QtNC40YIgcmV0dXJuLFxu0L3QviBmaW5hbGx5INC/0L7Qu9GD0YfQsNC10YIg0YPQv9GA0LDQstC70LXQvdC40LUg0JTQniDRgtC+0LPQviwg0LrQsNC6INC60L7QvdGC0YDQvtC70Ywg0LLQvtC30LLRgNCw0YnQsNC10YLRgdGPINCy0L4g0LLQvdC10YjQvdC40Lkg0LrQvtC0LlxuKi9cbmZ1bmN0aW9uIGV4YW1wbGU4ICgpIHtcblxuICBmdW5jdGlvbiBmdW5jKCkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gMTsgLy8g0YHRgNCw0LfRgyDQstC10YDQvdGD0YLRjCDQt9C90LDRh9C10L3QuNC1XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgLyogLi4uICovXG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGNvbnNvbGUubG9nKCAnZmluYWxseScgKTtcbiAgICB9XG4gIH1cbiAgY29uc29sZS5sb2coIGZ1bmMoKSApOyAvLyDRgdC90LDRh9Cw0LvQsCBmaW5hbGx5LCDQv9C+0YLQvtC8IDFcbn1cbi8vIGV4YW1wbGU4KClcblxuXG4vKlxu0JXRgdC70Lgg0LLQvdGD0YLRgNC4IHRyeSDQsdGL0LvQuCDQvdCw0YfQsNGC0Ysg0LrQsNC60LjQtS3RgtC+INC/0YDQvtGG0LXRgdGB0YssXG7QutC+0YLQvtGA0YvQtSDQvdGD0LbQvdC+INC30LDQstC10YDRiNC40YLRjCDQv9C+INC+0LrQvtC90YfQsNC90LjQuCDRgNCw0LHQvtGC0YssINGC0L4g0LIgZmluYWxseSDRjdGC0L4g0L7QsdGP0LfQsNGC0LXQu9GM0L3QviDQsdGD0LTQtdGCINGB0LTQtdC70LDQvdC+LlxuXG7QmtGB0YLQsNGC0LgsINC00LvRjyDRgtCw0LrQuNGFINGB0LvRg9GH0LDQtdCyINC40L3QvtCz0LTQsCDQuNGB0L/QvtC70YzQt9GD0Y7RgiB0cnkuLmZpbmFsbHkg0LLQvtC+0LHRidC1INCx0LXQtyBjYXRjaDpcbiovXG5mdW5jdGlvbiBleGFtcGxlOSgpIHtcbiAgZnVuY3Rpb24gZnVuYygpIHtcbiAgICB0cnkge1xuICAgICAgcmV0dXJuIDE7XG4gICAgfSBmaW5hbGx5IHtcbiAgICAgIGNvbnNvbGUubG9nKCAn0JLRi9C30L7QsiDQt9Cw0LLQtdGA0YjRkdC9JyApO1xuICAgIH1cbiAgfVxuXG4gIGNvbnNvbGUubG9nKGZ1bmMoKSk7IC8vINGB0L3QsNGH0LDQu9CwIGZpbmFsbHksINC/0L7RgtC+0LwgMVxufVxuLy8gZXhhbXBsZTkoKVxuXG5cblxuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gIHdpbmRvdy5vbmVycm9yXG4gINCyINGB0LvRg9GH0LDQtSDQu9GO0LHQvtC5INC+0YjQuNCx0LrQuCDQsiDQutC+0LTQtSAtINCy0YvQv9C+0LvQvdC40YIg0YTRg9C90LrRhtC40Y5cbi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5mdW5jdGlvbiBleGFtcGxlMTAoKXtcbiAgd2luZG93Lm9uZXJyb3IgPSBmdW5jdGlvbihtZXNzYWdlLCB1cmwsIGxpbmVOdW1iZXIpIHtcbiAgICBhbGVydChcItCf0L7QudC80LDQvdCwINC+0YjQuNCx0LrQsCwg0LLRi9C/0LDQstGI0LDRjyDQsiDQs9C70L7QsdCw0LvRjNC90YPRjiDQvtCx0LvQsNGB0YLRjCFcXG5cIiArXG4gICAgICBcItCh0L7QvtCx0YnQtdC90LjQtTogXCIgKyBtZXNzYWdlICsgXCJcXG4oXCIgKyB1cmwgKyBcIjpcIiArIGxpbmVOdW1iZXIgKyBcIilcIik7XG4gIH07XG5cbiAgZnVuY3Rpb24gcmVhZERhdGEoKSB7XG4gICAgZXJyb3IoKTsgLy8g0L7QuSwg0YfRgtC+LdGC0L4g0L3QtSDRgtCw0LpcbiAgfVxuXG4gIHJlYWREYXRhKCk7XG59XG4vLyBleGFtcGxlMTAoKVxuXG5cblxuXG4vKi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tKi9cblxuXG5cblxuLyrQl9Cw0LTQsNGH0LAgMTpcbtCd0YPQttC90L4sINGH0YLQvtCx0Ysg0LrQvtC0INGE0LjQvdCw0LvQuNC30LDRhtC40Lgg0LLRgdC10LPQtNCwINCy0YvQv9C+0LvQvdGP0LvRgdGPINC/0YDQuCDQstGL0YXQvtC00LUg0LjQtyDQsdC70L7QutCwIHRyeS4uY2F0Y2gg0LgsXG7RgtCw0LrQuNC8INC+0LHRgNCw0LfQvtC8LCDQt9Cw0LrQsNC90YfQuNCy0LDQuyDQvdCw0YfQsNGC0YPRjiDRgNCw0LHQvtGC0YMuXG7QmNC80LXQtdGCINC70Lgg0LfQtNC10YHRjCBmaW5hbGx5INC60LDQutC+0LUt0YLQviDQv9GA0LXQuNC80YPRidC10YHRgtCy0L4g0LjQu9C4INC+0LHQsCDRhNGA0LDQs9C80LXQvdGC0LAg0YDQsNCx0L7RgtCw0Y7RgiDQvtC00LjQvdCw0LrQvtCy0L4/XG5cbtCV0YHQu9C4INC40LzQtdC10YIsINGC0L4g0LTQsNC50YLQtSDQv9GA0LjQvNC10YAg0LrQvtCz0LTQsCDQutC+0LQg0YEgZmluYWxseSDRgNCw0LHQvtGC0LDQtdGCINCy0LXRgNC90L4sINCwINCx0LXQtyDigJQg0L3QtdCy0LXRgNC90L4uXG4qL1xuZnVuY3Rpb24gZXhlcmNpc2UxKCkge1xuICB0cnl7XG4gICAgR0VOX0VSUk9SKCk7XG4gIH0gY2F0Y2goZSl7XG4gICAgaWYgKGUubmFtZSA9PT0gXCJTeXRheEVycm9yXCIpIHtcbiAgICAgIGNvbnNvbGUubG9nKGUubmFtZSwgZS5tZXNzYWdlKTtcbiAgICB9IGVsc2V7XG4gICAgICB0aHJvdyBlO1xuICAgIH07XG4gIH0gZmluYWxseXtcbiAgICAvL3RoaXMgY29kZSB3aWxsIGJlIGV4ZWN1dGVkXG4gIH1cblxuICAvL3RoaXMgY29kZSBub3BlXG59XG4vLyBleGVyY2lzZTEoKVxuXG5cblxuXG4vKtCX0LDQtNCw0YfQsCAyOlxu0J3QsNC/0LjRiNC40YLQtSDQuNC90YLQtdGA0YTQtdC50YEsINC60L7RgtC+0YDRi9C5INC/0YDQuNC90LjQvNCw0LXRgiDQvNCw0YLQtdC80LDRgtC40YfQtdGB0LrQvtC1INCy0YvRgNCw0LbQtdC90LjQtSAo0LIgcHJvbXB0KSDQuCDRgNC10LfRg9C70YzRgtCw0YIg0LXQs9C+INCy0YvRh9C40YHQu9C10L3QuNGPINGH0LXRgNC10LcgZXZhbC5cbtCf0YDQuCDQvtGI0LjQsdC60LUg0L3Rg9C20L3QviDQstGL0LLQvtC00LjRgtGMINGB0L7QvtCx0YnQtdC90LjQtSDQuCDQv9GA0L7RgdC40YLRjCDQv9C10YDQtdCy0LLQtdGB0YLQuCDQstGL0YDQsNC20LXQvdC40LUuXG4qL1xuZnVuY3Rpb24gZXhlcmNpc2UyICgpe1xuXG4gIGZ1bmN0aW9uIGV2YWxDYWxjdWxhdG9yICgpIHtcbiAgICBmdW5jdGlvbiBnZXRVc2VyUHJvbXB0KCl7XG4gICAgICByZXR1cm4gcHJvbXB0KCdFbnRlciBwaHJhemUgdG8gY2FsYycsIDApXG4gICAgfVxuICAgIHRyeXtcbiAgICAgIHZhciByZXN1bHQgPSBldmFsKGdldFVzZXJQcm9tcHQoKSk7XG4gICAgICBpZiAodHlwZW9mIHJlc3VsdCAhPT0gJ251bWJlcicgfHwgaXNOYU4ocmVzdWx0KSAhPT0gZmFsc2UpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdJbmNvcnJlY3QgZGF0YScpXG4gICAgICB9O1xuICAgICAgY29uc29sZS5sb2cocmVzdWx0KTtcbiAgICAgIHJldHVybiByZXN1bHQ7XG5cbiAgICB9IGNhdGNoKGUpe1xuICAgICAgY29uc29sZS5sb2coXCJTb3JyeSwgdGhlcmUgaXMgYSBcIiArIGUubmFtZSArIFwiXFxuXCIgKyBlLm1lc3NhZ2UpO1xuICAgICAgZXZhbENhbGN1bGF0b3IoKVxuICAgIH1cbiAgfVxuXG4gIGV2YWxDYWxjdWxhdG9yKCk7XG59XG5cbi8vIGV4ZXJjaXNlMigpOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
