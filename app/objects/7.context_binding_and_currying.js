'use strict';

/*Function doesn't remember context itself
  In some cases this context can be lost
  Use function-wrapper define it with clojure
  ... or use bind()

-----------------------------------------------------*/

var user = {
  firstName: "Tom",
  sayHi: function sayHi() {
    return this.firstName;
  }
};

setTimeout(user.sayHi, 1000); //incorrect context (this === undefined)

/*How to deal?
  1. Make a clojure (has a weekness: user can be overwritten while timeout is ticking)
-----------------------------------------------------*/

setTimeout(function () {
  user.sayHi;
}, 1000); //correct context (this === user)

/*2. Use wrapper-function bind
-----------------------------------------------------*/

function bind(func, context) {
  //use clojure for disable context losing
  return function () {
    return func.apply(context);
  };
}

var f = function f() {
  return this;
};
var g = bind(f, 'someContext');
g(); //someContext

setTimeout(bind(user.sayHi, user), 1000); //not call function!!! it will be called by setTimeout

/*3. Use integrated JS bind method
-----------------------------------------------------*/

var g1 = f.bind('bindedContext');
g(); //bindedContext

//bind syntax: pay attention, bind arguments, will be placed before function arguments
//func.bind(context [, arg1, arg2 ...])

/*3. Curriyng: get function variants with differen arguments fixed
-----------------------------------------------------*/
var mul = function mul(a, b) {
  return a * b;
};

var double = mul.bind(null, 2); //
double(10); // 10 * 2 (translated fixed argument)  == 20

var triple = mul.bind(null, 3);
triple(10); // 30

// double() and triple() are PARTIAL FUNCTIONS from CURRIYED function mul()

/*Задача 1: что выведет функция? */

function f() {
  return this;
}

var user = {
  g: f.bind("Hello")
};

user.g();

/*Решение: hello, потому что this === "Hello" через bind*/

/*Задача 2 (двойной bind): что выведет функция? */
function f() {
  return this.name;
}

f = f.bind({ name: "Вася" }).bind({ name: "Петя" });

f();

/*Решение: "Вася" так как bind вызывает функцию а возвращает функцию-обертку, 
второй bind работать не будет*/

/*Задача 3 свойство после bind: */
function sayHi() {
  return this.name;
}
sayHi.test = 5;
var result = sayHi.test; // 5

var bound = sayHi.bind({
  name: "Вася"
});

result = bound.test; // что выведет? почему?

/*Решение: undefined, т.к bound возвращает не sayHi, в которой есть свойство test
а обертку, в которой его не существует. 

Примечание: понять почему не Error, ведь происходит обращение к несуществующей переменной */

/*Задача 4: 
Вызов user.checkPassword() в коде ниже должен, при помощи ask, спрашивать пароль
и вызывать loginOk/loginFail в зависимости от правильности ответа.
Однако, его вызов приводит к ошибке. Почему?

Исправить строку: *  

P.S. Ваше решение должно также срабатывать, если переменная user будет перезаписана, например вместо user.checkPassword() в конце будут строки:

var vasya = user;
user = null;
vasya.checkPassword();
*/

"use strict";

function ask(question, answer, ok, fail) {
  var result = prompt(question, '');
  if (result.toLowerCase() == answer.toLowerCase()) ok();else fail();
}

var user = {
  login: 'Василий',
  password: '12345',

  loginOk: function loginOk() {
    return this.login + ' вошёл в сайт';
  },

  loginFail: function loginFail() {
    return this.login + ': ошибка входа';
  },

  checkPassword: function checkPassword() {
    ask("Ваш пароль?", this.password, this.loginOk, this.loginFail); //* неправильно

    ask("Ваш пароль?", this.password, this.loginOk.bind(this), this.loginFail.bind(this)); //  правильно
  }
};

var vasua = user;
user = null;
vasya.checkPassword();

/*Решение: т.к. внутри loginOk и loginFail this == undefined, поэтому привязываем с помощью bind */

/*Задача 5: 
Сейчас код ниже обладает важным недостатком: 
при записи в user другого значения объект перестанет корректно работать,
вы увидите это, запустив пример ниже (будет ошибка).

Исправьте выделенный фрагмент, чтобы код заработал.
*/

"use strict";

function ask(question, answer, ok, fail) {
  var result = prompt(question, '');
  if (result.toLowerCase() == answer.toLowerCase()) ok();else fail();
}

var user = {
  login: 'Василий',
  password: '12345',

  // метод для вызова из ask
  loginDone: function loginDone(result) {
    return this.login + (result ? ' вошёл в сайт' : ' ошибка входа');
  },

  checkPasswordIncorrect: function checkPasswordIncorrect() {
    // исправить здесь
    ask("Ваш пароль?", this.password, function () {
      user.loginDone(true);
    }, function () {
      user.loginDone(false);
    });
  },

  /*Решение 1: передать правильный контекст через вспомогательную переменную*/
  checkPasswordCorrect1: function checkPasswordCorrect1() {
    var self = this;
    ask("Ваш пароль?", this.password, function () {
      self.loginDone(true);
    }, function () {
      self.loginDone(false);
    });
  },

  /*Решение 2: передать правильный контекст и фиксированные аргументы (карринг)
    ВАЖНО: почему зациклился на том чтобы оставить анонимные функции???
   */
  checkPasswordCorrect2: function checkPasswordCorrect2() {
    ask("Ваш пароль?", this.password, this.loginDone.bind(this, true), this.loginDone.bind(this, false));
  }
};

var vasya = user;
user = null;
vasya.checkPasswordIncorrect();
// vasya.checkPasswordCorrect1();
vasya.checkPasswordCorrect2();

/*Решение*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjcuY29udGV4dF9iaW5kaW5nX2FuZF9jdXJyeWluZy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFPQSxJQUFJLElBQUksR0FBRztBQUNULFdBQVMsRUFBRSxLQUFLO0FBQ2hCLE9BQUssRUFBRSxpQkFBVztBQUNoQixXQUFPLElBQUksQ0FBQyxTQUFTLENBQUM7R0FDdkI7Q0FDRixDQUFBOztBQUVELFVBQVUsQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQzs7Ozs7O0FBQUMsQUFRN0IsVUFBVSxDQUFDLFlBQVU7QUFDbkIsTUFBSSxDQUFDLEtBQUssQ0FBQztDQUNaLEVBQUUsSUFBSSxDQUFDOzs7OztBQUFBLEFBU1IsU0FBUyxJQUFJLENBQUMsSUFBSSxFQUFFLE9BQU8sRUFBQzs7QUFFMUIsU0FBTyxZQUFVO0FBQ2YsV0FBTyxJQUFJLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0dBQzVCLENBQUE7Q0FDRjs7QUFFRCxJQUFJLENBQUMsR0FBRyxhQUFVO0FBQ2hCLFNBQU8sSUFBSSxDQUFDO0NBQ2IsQ0FBQTtBQUNELElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxDQUFDLEVBQUUsYUFBYSxDQUFDLENBQUM7QUFDL0IsQ0FBQyxFQUFFOztBQUFDLEFBR0osVUFBVSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsS0FBSyxFQUFFLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQzs7Ozs7QUFBQSxBQVF4QyxJQUFJLEVBQUUsR0FBRyxDQUFDLENBQUMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFBO0FBQ2hDLENBQUMsRUFBRTs7Ozs7OztBQUFBLEFBc0JILElBQUksR0FBRyxHQUFHLFNBQU4sR0FBRyxDQUFhLENBQUMsRUFBRSxDQUFDLEVBQUU7QUFDeEIsU0FBTyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0NBQ2QsQ0FBQTs7QUFFRCxJQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFD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LEtBQUssQ0FBQyxxQkFBcUIsRUFBRTs7O0FBQUMiLCJmaWxlIjoib2JqZWN0cy83LmNvbnRleHRfYmluZGluZ19hbmRfY3VycnlpbmcuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKkZ1bmN0aW9uIGRvZXNuJ3QgcmVtZW1iZXIgY29udGV4dCBpdHNlbGZcbiAgSW4gc29tZSBjYXNlcyB0aGlzIGNvbnRleHQgY2FuIGJlIGxvc3RcbiAgVXNlIGZ1bmN0aW9uLXdyYXBwZXIgZGVmaW5lIGl0IHdpdGggY2xvanVyZVxuICAuLi4gb3IgdXNlIGJpbmQoKVxuXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbnZhciB1c2VyID0ge1xuICBmaXJzdE5hbWU6IFwiVG9tXCIsXG4gIHNheUhpOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5maXJzdE5hbWU7XG4gIH1cbn1cblxuc2V0VGltZW91dCh1c2VyLnNheUhpLCAxMDAwKTsgLy9pbmNvcnJlY3QgY29udGV4dCAodGhpcyA9PT0gdW5kZWZpbmVkKVxuXG5cblxuLypIb3cgdG8gZGVhbD9cbiAgMS4gTWFrZSBhIGNsb2p1cmUgKGhhcyBhIHdlZWtuZXNzOiB1c2VyIGNhbiBiZSBvdmVyd3JpdHRlbiB3aGlsZSB0aW1lb3V0IGlzIHRpY2tpbmcpXG4tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSovXG5cbnNldFRpbWVvdXQoZnVuY3Rpb24oKXtcbiAgdXNlci5zYXlIaTtcbn0sIDEwMDApIC8vY29ycmVjdCBjb250ZXh0ICh0aGlzID09PSB1c2VyKVxuXG5cblxuXG5cbi8qMi4gVXNlIHdyYXBwZXItZnVuY3Rpb24gYmluZFxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG5mdW5jdGlvbiBiaW5kKGZ1bmMsIGNvbnRleHQpe1xuICAvL3VzZSBjbG9qdXJlIGZvciBkaXNhYmxlIGNvbnRleHQgbG9zaW5nXG4gIHJldHVybiBmdW5jdGlvbigpe1xuICAgIHJldHVybiBmdW5jLmFwcGx5KGNvbnRleHQpO1xuICB9XG59XG5cbnZhciBmID0gZnVuY3Rpb24oKXtcbiAgcmV0dXJuIHRoaXM7XG59XG52YXIgZyA9IGJpbmQoZiwgJ3NvbWVDb250ZXh0Jyk7XG5nKCk7IC8vc29tZUNvbnRleHRcblxuXG5zZXRUaW1lb3V0KGJpbmQodXNlci5zYXlIaSwgdXNlciksIDEwMDApICAvL25vdCBjYWxsIGZ1bmN0aW9uISEhIGl0IHdpbGwgYmUgY2FsbGVkIGJ5IHNldFRpbWVvdXRcblxuXG5cblxuLyozLiBVc2UgaW50ZWdyYXRlZCBKUyBiaW5kIG1ldGhvZFxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xuXG52YXIgZzEgPSBmLmJpbmQoJ2JpbmRlZENvbnRleHQnKVxuZygpIC8vYmluZGVkQ29udGV4dFxuXG5cbi8vYmluZCBzeW50YXg6IHBheSBhdHRlbnRpb24sIGJpbmQgYXJndW1lbnRzLCB3aWxsIGJlIHBsYWNlZCBiZWZvcmUgZnVuY3Rpb24gYXJndW1lbnRzXG4vL2Z1bmMuYmluZChjb250ZXh0IFssIGFyZzEsIGFyZzIgLi4uXSlcblxuXG5cblxuXG5cblxuXG5cblxuXG5cblxuXG5cbi8qMy4gQ3Vycml5bmc6IGdldCBmdW5jdGlvbiB2YXJpYW50cyB3aXRoIGRpZmZlcmVuIGFyZ3VtZW50cyBmaXhlZFxuLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0qL1xudmFyIG11bCA9IGZ1bmN0aW9uIChhLCBiKSB7XG4gIHJldHVybiBhICogYjtcbn1cblxudmFyIGRvdWJsZSA9IG11bC5iaW5kKG51bGwsIDIpLy9cbmRvdWJsZSgxMCkgLy8gMTAgKiAyICh0cmFuc2xhdGVkIGZpeGVkIGFyZ3VtZW50KSAgPT0gMjBcblxudmFyIHRyaXBsZSA9IG11bC5iaW5kKG51bGwsIDMpXG50cmlwbGUoMTApIC8vIDMwXG5cbi8vIGRvdWJsZSgpIGFuZCB0cmlwbGUoKSBhcmUgUEFSVElBTCBGVU5DVElPTlMgZnJvbSBDVVJSSVlFRCBmdW5jdGlvbiBtdWwoKVxuXG5cblxuXG5cbi8q0JfQsNC00LDRh9CwIDE6INGH0YLQviDQstGL0LLQtdC00LXRgiDRhNGD0L3QutGG0LjRjz8gKi9cblxuZnVuY3Rpb24gZigpIHtcbiAgcmV0dXJuIHRoaXM7XG59XG5cbnZhciB1c2VyID0ge1xuICBnOiBmLmJpbmQoXCJIZWxsb1wiKVxufVxuXG51c2VyLmcoKTtcblxuLyrQoNC10YjQtdC90LjQtTogaGVsbG8sINC/0L7RgtC+0LzRgyDRh9GC0L4gdGhpcyA9PT0gXCJIZWxsb1wiINGH0LXRgNC10LcgYmluZCovXG5cblxuXG5cbi8q0JfQsNC00LDRh9CwIDIgKNC00LLQvtC50L3QvtC5IGJpbmQpOiDRh9GC0L4g0LLRi9Cy0LXQtNC10YIg0YTRg9C90LrRhtC40Y8/ICovXG5mdW5jdGlvbiBmKCkge1xuICByZXR1cm4gdGhpcy5uYW1lO1xufVxuXG5mID0gZi5iaW5kKCB7bmFtZTogXCLQktCw0YHRj1wifSApLmJpbmQoIHtuYW1lOiBcItCf0LXRgtGPXCIgfSApO1xuXG5mKCk7XG5cbi8q0KDQtdGI0LXQvdC40LU6IFwi0JLQsNGB0Y9cIiDRgtCw0Log0LrQsNC6IGJpbmQg0LLRi9C30YvQstCw0LXRgiDRhNGD0L3QutGG0LjRjiDQsCDQstC+0LfQstGA0LDRidCw0LXRgiDRhNGD0L3QutGG0LjRji3QvtCx0LXRgNGC0LrRgywgXG7QstGC0L7RgNC+0LkgYmluZCDRgNCw0LHQvtGC0LDRgtGMINC90LUg0LHRg9C00LXRgiovXG5cblxuXG5cbi8q0JfQsNC00LDRh9CwIDMg0YHQstC+0LnRgdGC0LLQviDQv9C+0YHQu9C1IGJpbmQ6ICovXG5mdW5jdGlvbiBzYXlIaSgpIHtcbiAgcmV0dXJuIHRoaXMubmFtZTtcbn1cbnNheUhpLnRlc3QgPSA1O1xudmFyIHJlc3VsdCA9IHNheUhpLnRlc3Q7IC8vIDVcblxudmFyIGJvdW5kID0gc2F5SGkuYmluZCh7XG4gIG5hbWU6IFwi0JLQsNGB0Y9cIlxufSk7XG5cbnJlc3VsdCA9IGJvdW5kLnRlc3Q7IC8vINGH0YLQviDQstGL0LLQtdC00LXRgj8g0L/QvtGH0LXQvNGDP1xuXG5cbi8q0KDQtdGI0LXQvdC40LU6IHVuZGVmaW5lZCwg0YIu0LogYm91bmQg0LLQvtC30LLRgNCw0YnQsNC10YIg0L3QtSBzYXlIaSwg0LIg0LrQvtGC0L7RgNC+0Lkg0LXRgdGC0Ywg0YHQstC+0LnRgdGC0LLQviB0ZXN0XG7QsCDQvtCx0LXRgNGC0LrRgywg0LIg0LrQvtGC0L7RgNC+0Lkg0LXQs9C+INC90LUg0YHRg9GJ0LXRgdGC0LLRg9C10YIuIFxuXG7Qn9GA0LjQvNC10YfQsNC90LjQtTog0L/QvtC90Y/RgtGMINC/0L7Rh9C10LzRgyDQvdC1IEVycm9yLCDQstC10LTRjCDQv9GA0L7QuNGB0YXQvtC00LjRgiDQvtCx0YDQsNGJ0LXQvdC40LUg0Log0L3QtdGB0YPRidC10YHRgtCy0YPRjtGJ0LXQuSDQv9C10YDQtdC80LXQvdC90L7QuSAqL1xuXG5cblxuXG4vKtCX0LDQtNCw0YfQsCA0OiBcbtCS0YvQt9C+0LIgdXNlci5jaGVja1Bhc3N3b3JkKCkg0LIg0LrQvtC00LUg0L3QuNC20LUg0LTQvtC70LbQtdC9LCDQv9GA0Lgg0L/QvtC80L7RidC4IGFzaywg0YHQv9GA0LDRiNC40LLQsNGC0Ywg0L/QsNGA0L7Qu9GMXG7QuCDQstGL0LfRi9Cy0LDRgtGMIGxvZ2luT2svbG9naW5GYWlsINCyINC30LDQstC40YHQuNC80L7RgdGC0Lgg0L7RgiDQv9GA0LDQstC40LvRjNC90L7RgdGC0Lgg0L7RgtCy0LXRgtCwLlxu0J7QtNC90LDQutC+LCDQtdCz0L4g0LLRi9C30L7QsiDQv9GA0LjQstC+0LTQuNGCINC6INC+0YjQuNCx0LrQtS4g0J/QvtGH0LXQvNGDP1xuXG7QmNGB0L/RgNCw0LLQuNGC0Ywg0YHRgtGA0L7QutGDOiAqICBcblxuUC5TLiDQktCw0YjQtSDRgNC10YjQtdC90LjQtSDQtNC+0LvQttC90L4g0YLQsNC60LbQtSDRgdGA0LDQsdCw0YLRi9Cy0LDRgtGMLCDQtdGB0LvQuCDQv9C10YDQtdC80LXQvdC90LDRjyB1c2VyINCx0YPQtNC10YIg0L/QtdGA0LXQt9Cw0L/QuNGB0LDQvdCwLCDQvdCw0L/RgNC40LzQtdGAINCy0LzQtdGB0YLQviB1c2VyLmNoZWNrUGFzc3dvcmQoKSDQsiDQutC+0L3RhtC1INCx0YPQtNGD0YIg0YHRgtGA0L7QutC4OlxuXG52YXIgdmFzeWEgPSB1c2VyO1xudXNlciA9IG51bGw7XG52YXN5YS5jaGVja1Bhc3N3b3JkKCk7XG4qL1xuXG5cblwidXNlIHN0cmljdFwiO1xuXG5mdW5jdGlvbiBhc2socXVlc3Rpb24sIGFuc3dlciwgb2ssIGZhaWwpIHtcbiAgdmFyIHJlc3VsdCA9IHByb21wdChxdWVzdGlvbiwgJycpO1xuICBpZiAocmVzdWx0LnRvTG93ZXJDYXNlKCkgPT0gYW5zd2VyLnRvTG93ZXJDYXNlKCkpIG9rKCk7XG4gIGVsc2UgZmFpbCgpO1xufVxuXG52YXIgdXNlciA9IHtcbiAgbG9naW46ICfQktCw0YHQuNC70LjQuScsXG4gIHBhc3N3b3JkOiAnMTIzNDUnLFxuXG4gIGxvZ2luT2s6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmxvZ2luICsgJyDQstC+0YjRkdC7INCyINGB0LDQudGCJztcbiAgfSxcblxuICBsb2dpbkZhaWw6IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmxvZ2luICsgJzog0L7RiNC40LHQutCwINCy0YXQvtC00LAnO1xuICB9LFxuXG4gIGNoZWNrUGFzc3dvcmQ6IGZ1bmN0aW9uKCkge1xuICAgIGFzayhcItCS0LDRiCDQv9Cw0YDQvtC70Yw/XCIsIHRoaXMucGFzc3dvcmQsIHRoaXMubG9naW5PaywgdGhpcy5sb2dpbkZhaWwpOyAvLyog0L3QtdC/0YDQsNCy0LjQu9GM0L3QvlxuXG4gICAgYXNrKFwi0JLQsNGIINC/0LDRgNC+0LvRjD9cIiwgdGhpcy5wYXNzd29yZCwgdGhpcy5sb2dpbk9rLmJpbmQodGhpcyksIHRoaXMubG9naW5GYWlsLmJpbmQodGhpcykpOyAvLyAg0L/RgNCw0LLQuNC70YzQvdC+XG4gIH1cbn07XG5cbnZhciB2YXN1YSA9IHVzZXI7XG51c2VyID0gbnVsbFxudmFzeWEuY2hlY2tQYXNzd29yZCgpO1xuXG4vKtCg0LXRiNC10L3QuNC1OiDRgi7Qui4g0LLQvdGD0YLRgNC4IGxvZ2luT2sg0LggbG9naW5GYWlsIHRoaXMgPT0gdW5kZWZpbmVkLCDQv9C+0Y3RgtC+0LzRgyDQv9GA0LjQstGP0LfRi9Cy0LDQtdC8INGBINC/0L7QvNC+0YnRjNGOIGJpbmQgKi9cblxuXG5cbi8q0JfQsNC00LDRh9CwIDU6IFxu0KHQtdC50YfQsNGBINC60L7QtCDQvdC40LbQtSDQvtCx0LvQsNC00LDQtdGCINCy0LDQttC90YvQvCDQvdC10LTQvtGB0YLQsNGC0LrQvtC8OiBcbtC/0YDQuCDQt9Cw0L/QuNGB0Lgg0LIgdXNlciDQtNGA0YPQs9C+0LPQviDQt9C90LDRh9C10L3QuNGPINC+0LHRitC10LrRgiDQv9C10YDQtdGB0YLQsNC90LXRgiDQutC+0YDRgNC10LrRgtC90L4g0YDQsNCx0L7RgtCw0YLRjCxcbtCy0Ysg0YPQstC40LTQuNGC0LUg0Y3RgtC+LCDQt9Cw0L/Rg9GB0YLQuNCyINC/0YDQuNC80LXRgCDQvdC40LbQtSAo0LHRg9C00LXRgiDQvtGI0LjQsdC60LApLlxuXG7QmNGB0L/RgNCw0LLRjNGC0LUg0LLRi9C00LXQu9C10L3QvdGL0Lkg0YTRgNCw0LPQvNC10L3Rgiwg0YfRgtC+0LHRiyDQutC+0LQg0LfQsNGA0LDQsdC+0YLQsNC7LlxuKi9cblxuXCJ1c2Ugc3RyaWN0XCI7XG5cbmZ1bmN0aW9uIGFzayhxdWVzdGlvbiwgYW5zd2VyLCBvaywgZmFpbCkge1xuICB2YXIgcmVzdWx0ID0gcHJvbXB0KHF1ZXN0aW9uLCAnJyk7XG4gIGlmIChyZXN1bHQudG9Mb3dlckNhc2UoKSA9PSBhbnN3ZXIudG9Mb3dlckNhc2UoKSkgb2soKTtcbiAgZWxzZSBmYWlsKCk7XG59XG5cbnZhciB1c2VyID0ge1xuICBsb2dpbjogJ9CS0LDRgdC40LvQuNC5JyxcbiAgcGFzc3dvcmQ6ICcxMjM0NScsXG5cbiAgLy8g0LzQtdGC0L7QtCDQtNC70Y8g0LLRi9C30L7QstCwINC40LcgYXNrXG4gIGxvZ2luRG9uZTogZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgcmV0dXJuIHRoaXMubG9naW4gKyAocmVzdWx0ID8gJyDQstC+0YjRkdC7INCyINGB0LDQudGCJyA6ICcg0L7RiNC40LHQutCwINCy0YXQvtC00LAnKTtcbiAgfSxcblxuICBjaGVja1Bhc3N3b3JkSW5jb3JyZWN0OiBmdW5jdGlvbigpIHsgLy8g0LjRgdC/0YDQsNCy0LjRgtGMINC30LTQtdGB0YxcbiAgICBhc2soXCLQktCw0Ygg0L/QsNGA0L7Qu9GMP1wiLCB0aGlzLnBhc3N3b3JkLFxuICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIHVzZXIubG9naW5Eb25lKHRydWUpO1xuICAgICAgfSxcbiAgICAgIGZ1bmN0aW9uKCkge1xuICAgICAgICB1c2VyLmxvZ2luRG9uZShmYWxzZSk7XG4gICAgICB9XG4gICAgKTtcbiAgfSxcblxuICAvKtCg0LXRiNC10L3QuNC1IDE6INC/0LXRgNC10LTQsNGC0Ywg0L/RgNCw0LLQuNC70YzQvdGL0Lkg0LrQvtC90YLQtdC60YHRgiDRh9C10YDQtdC3INCy0YHQv9C+0LzQvtCz0LDRgtC10LvRjNC90YPRjiDQv9C10YDQtdC80LXQvdC90YPRjiovXG4gIGNoZWNrUGFzc3dvcmRDb3JyZWN0MTogZnVuY3Rpb24gKCkge1xuICAgIHZhciBzZWxmID0gdGhpcztcbiAgICBhc2soXCLQktCw0Ygg0L/QsNGA0L7Qu9GMP1wiLCB0aGlzLnBhc3N3b3JkLFxuICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYubG9naW5Eb25lKHRydWUpOyAgXG4gICAgICB9LFxuICAgICAgZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYubG9naW5Eb25lKGZhbHNlKTtcbiAgICAgIH1cbiAgICApO1xuICB9LFxuXG4gIC8q0KDQtdGI0LXQvdC40LUgMjog0L/QtdGA0LXQtNCw0YLRjCDQv9GA0LDQstC40LvRjNC90YvQuSDQutC+0L3RgtC10LrRgdGCINC4INGE0LjQutGB0LjRgNC+0LLQsNC90L3Ri9C1INCw0YDQs9GD0LzQtdC90YLRiyAo0LrQsNGA0YDQuNC90LMpXG4gICAg0JLQkNCW0J3Qnjog0L/QvtGH0LXQvNGDINC30LDRhtC40LrQu9C40LvRgdGPINC90LAg0YLQvtC8INGH0YLQvtCx0Ysg0L7RgdGC0LDQstC40YLRjCDQsNC90L7QvdC40LzQvdGL0LUg0YTRg9C90LrRhtC40Lg/Pz9cbiAgICovXG4gIGNoZWNrUGFzc3dvcmRDb3JyZWN0MjogZnVuY3Rpb24gKCkge1xuICAgIGFzayhcItCS0LDRiCDQv9Cw0YDQvtC70Yw/XCIsXG4gICAgICAgIHRoaXMucGFzc3dvcmQsIFxuICAgICAgICB0aGlzLmxvZ2luRG9uZS5iaW5kKHRoaXMsIHRydWUpLFxuICAgICAgICB0aGlzLmxvZ2luRG9uZS5iaW5kKHRoaXMsIGZhbHNlKVxuICAgICk7XG4gIH1cbn1cblxuXG52YXIgdmFzeWEgPSB1c2VyO1xudXNlciA9IG51bGw7XG52YXN5YS5jaGVja1Bhc3N3b3JkSW5jb3JyZWN0KCk7XG4vLyB2YXN5YS5jaGVja1Bhc3N3b3JkQ29ycmVjdDEoKTsgXG52YXN5YS5jaGVja1Bhc3N3b3JkQ29ycmVjdDIoKTsgXG5cblxuXG5cbi8q0KDQtdGI0LXQvdC40LUqLyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
