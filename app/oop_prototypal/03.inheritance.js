'use strict';

/*
Example 1:
*/

function example1() {

  function Animal(name) {
    this.name = name;
    this.speed = 0;
  }

  Animal.prototype.run = function (speed) {
    this.speed += speed;
    console.log(this.name + ' бежит, скорость ' + this.speed);
  };

  Animal.prototype.stop = function () {
    this.speed = 0;
    console.log(this.name + ' стоит');
  };

  function Rabbit(name) {
    this.name = name;
    this.speed = 0;
  }

  /* set right prototype */

  Rabbit.prototype = Object.create(Animal.prototype);
  Rabbit.prototype.constructor = Rabbit;

  Rabbit.prototype.jump = function () {
    this.speed++;
    console.log(this.name + ' прыгает');
  };

  var rabbit = new Rabbit('Кроль');
}

// example1()

/*
Parent Constructo call

do this if you want to avoid duplications in some kind of Decendants
*/

function example2() {
  function Animal(name) {
    this.name = name;
    this.speed = 0;
  }

  function Rabbit(name) {
    this.name = name;
    this.speed = 0;
  }

  //better
  function Rabbit(argument) {
    Animal.apply(this, arguments);
  }
}
// example2()

/*
Parent Method overriding
*/

function example3() {
  function Animal(name) {
    this.name = name;
    this.speed = 0;
  }

  Animal.prototype.run = function (speed) {
    this.speed += speed;
    console.log(this.name + ' бежит, скорость ' + this.speed);
  };

  function Rabbit(name) {
    this.name = name;
    this.speed = 0;
  }

  Rabbit.prototype = Object.create(Animal.prototype);
  Rabbit.prototype.constructor = Rabbit;

  Rabbit.prototype.jump = function () {
    this.speed++;
    console.log(this.name + ' прыгает');
  };

  //total overriding
  Rabbit.prototype.run = function () {
    this.speed++;
    this.jump();
  };

  // extend parent method
  Rabbit.prototype.run = function () {
    Animal.prototype.run.apply(this, arguments); // don't forget about proper context
    this.jump();
  };

  var rabbit = new Rabbit('Кроль');
}
// example3()

/*Tasks

Find a mistake in inheritance?
How it can affect the code?
*/

function task1() {

  function Animal(name) {
    this.name = name;
  }

  Animal.prototype.walk = function () {
    console.log("ходит " + this.name);
  };

  function Rabbit(name) {
    this.name = name;
  }
  Rabbit.prototype = Animal.prototype;

  Rabbit.prototype.walk = function () {
    console.log("прыгает! и ходит: " + this.name);
  };

  var a = new Animal('a');

  var r = new Rabbit('r');

  a.walk(); // прыгает и ходит????
  r.walk();
}

// task1()

/*Decision: Changes of Rabbit's prototype affect the Animal's one
*/

/*Task 2
Find the mistake. How it can affect the code?
*/

function task2() {

  function Animal(name) {
    this.name = name;

    this.walk = function () {
      console.log("ходит " + this.name);
    };
  }

  function Rabbit(name) {
    Animal.apply(this, arguments);
  }

  Rabbit.prototype = Object.create(Animal.prototype);

  Rabbit.prototype.walk = function () {
    console.log("прыгает " + this.name);
  };

  var rabbit = new Rabbit("Кроль");
  rabbit.walk();
}
// task2()

/*Desicion: method .run() will be fount in Context (from Animal)
not in Prototype (correct, that we need)

Conclusion: define methods in prototype
*/

/*Task 3: rewrite Clock in prototype style

*/

function task3() {
  //
  function Clock(options) {
    var template = options.template;
    var timer;

    function render() {
      var date = new Date();
      var hours = date.getHours();
      if (hours < 10) hours = '0' + hours;
      var min = date.getMinutes();
      if (min < 10) min = '0' + min;
      var sec = date.getSeconds();
      if (sec < 10) sec = '0' + sec;
      var output = template.replace('h', hours).replace('m', min).replace('s', sec);
      console.log(output);
    }
    this.stop = function () {
      clearInterval(timer);
    };
    this.start = function () {
      render();
      timer = setInterval(render, 1000);
    };
  }

  var cf = new Clock({
    template: 'h:m:s'
  });
  // cf.start();

  function ClockP(options) {
    this._template = options.template;
    this._timer = null;
  }

  ClockP.prototype.render = function () {
    var date = new Date();
    var hours = date.getHours();
    if (hours < 10) hours = '0' + hours;
    var min = date.getMinutes();
    if (min < 10) min = '0' + min;
    var sec = date.getSeconds();
    if (sec < 10) sec = '0' + sec;
    var output = this._template.replace('h', hours).replace('m', min).replace('s', sec);
    console.log(output);
  };

  ClockP.prototype.stop = function () {
    clearInterval(this._timer);
  };

  ClockP.prototype.start = function () {
    this.render();
    this._timer = setInterval(this.render.bind(this), 1000);
  };

  var cp = new ClockP({
    template: 'h:m:s'
  });
  cp.start();
}
// task3()

/*Task 4 

extend clock with new descendant, that has precision animation
*/

function task4() {

  function Clock(options) {
    this._template = options.template;
  }

  Clock.prototype.render = function () {
    var date = new Date();
    var hours = date.getHours();
    if (hours < 10) hours = '0' + hours;
    var min = date.getMinutes();
    if (min < 10) min = '0' + min;
    var sec = date.getSeconds();
    if (sec < 10) sec = '0' + sec;
    var output = this._template.replace('h', hours).replace('m', min).replace('s', sec);
    console.log(output);
  };

  Clock.prototype.stop = function () {
    clearInterval(this._timer);
  };

  Clock.prototype.start = function () {
    this.render();
    this._timer = setInterval(this.render.bind(this), 1000);
  };

  // Descendant

  function RelativeClock(options) {
    Clock.apply(this, arguments); // coffee script super() :)
    this._precision = options.precision || 1000;
  };

  RelativeClock.prototype = Object.create(Clock.prototype);
  RelativeClock.prototype.constructor = RelativeClock;

  RelativeClock.prototype.start = function () {
    this.render();
    this._timer = setInterval(this.render.bind(this), this._precision);
  };

  var rc = new RelativeClock({
    template: "h:m:s",
    precision: 10000
  });
  rc.start();
}
// task4()

/*Task 5:

Создайте наследника AnimatingMenu, который добавляет третье состояние STATE_ANIMATING.

При вызове open() состояние меняется на STATE_ANIMATING,
а через 1 секунду, по таймеру, открытие завершается вызовом open() родителя.

Вызов close() при необходимости отменяет таймер анимации
(назначаемый в open) и передаёт вызов родительскому close.

Метод showState для нового состояния выводит "анимация",
для остальных — полагается на родителя.
*/

function task5() {

  function Menu(state) {
    this._state = state || Menu.STATE_CLOSED;
  };

  Menu.STATE_OPEN = 1;
  Menu.STATE_CLOSED = 0;

  Menu.prototype.open = function () {
    this._state = Menu.STATE_OPEN;
  };

  Menu.prototype.close = function () {
    this._state = Menu.STATE_CLOSED;
  };

  Menu.prototype._stateAsString = function () {
    switch (this._state) {
      case Menu.STATE_OPEN:
        return 'открыто';

      case Menu.STATE_CLOSED:
        return 'закрыто';
    }
  };

  Menu.prototype.showState = function () {
    console.log(this._stateAsString());
  };

  // Animating menu

  function AnimatingMenu(state) {
    Menu.apply(this, arguments);
    this._animationDuration = state.animationDuration || 1000;
  }

  AnimatingMenu.STATE_ANIMATING = 'анимация';

  AnimatingMenu.prototype = Object.create(Menu.prototype);
  AnimatingMenu.prototype.constructor = AnimatingMenu;

  AnimatingMenu.prototype.open = function () {
    this._state = AnimatingMenu.STATE_ANIMATING;
    this._timer = setTimeout(Menu.prototype.open.bind(this, arguments), this._animationDuration);
  };

  AnimatingMenu.prototype.close = function () {
    clearTimeout(this._timer);
    Menu.prototype.close.apply(this, arguments);
  };

  AnimatingMenu.prototype.showState = function () {
    if (this._state === AnimatingMenu.STATE_ANIMATING) {
      console.log(this._state);
    } else {
      Menu.prototype.showState.apply(this, arguments);
    }
  };

  var am = new AnimatingMenu(false);
  am.showState(); //closed
  am.open();
  am.showState(); //animation
  setTimeout(am.showState.bind(am), 1001);
  am.showState(); //opened
}
// task5()

/*Task 6: constructor checking
what write console.log?
*/

function task6() {

  function Animal() {}

  function Rabbit() {}
  Rabbit.prototype = Object.create(Animal.prototype);

  var rabbit = new Rabbit();

  console.log(rabbit.constructor == Rabbit);
}
task6();

/*Answer: false, because rabbit.constructor is Animal,
to prevent this - set constructor explicitly
Rabbit.prototype.constructor = Rabbit
*/
//# sourceMappingURL=data:application/json;base64,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QUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ3ZDLElBQUUsQ0FBQyxTQUFTLEVBQUU7QUFBQSxDQUNmOzs7Ozs7O0FBQUEsQUFTRCxTQUFTLEtBQUssR0FBSTs7QUFFaEIsV0FBUyxNQUFNLEdBQUcsRUFBRTs7QUFFcEIsV0FBUyxNQUFNLEdBQUcsRUFBRTtBQUNwQixRQUFNLENBQUMsU0FBUyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDLFNBQVMsQ0FBQyxDQUFDOztBQUVuRCxNQUFJLE1BQU0sR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDOztBQUUxQixTQUFPLENBQUMsR0FBRyxDQUFFLE1BQU0sQ0FBQyxXQUFXLElBQUksTUFBTSxDQUFFLENBQUM7Q0FDN0M7QUFDRCxLQUFLLEVBQUU7Ozs7OztBQUFBIiwiZmlsZSI6Im9vcF9wcm90b3R5cGFsLzAzLmluaGVyaXRhbmNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcbkV4YW1wbGUgMTpcbiovXG5cbmZ1bmN0aW9uIGV4YW1wbGUxICgpIHtcblxuICBmdW5jdGlvbiBBbmltYWwobmFtZSkge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zcGVlZCA9IDA7XG4gIH1cblxuICBBbmltYWwucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uKHNwZWVkKSB7XG4gICAgdGhpcy5zcGVlZCArPSBzcGVlZDtcbiAgICBjb25zb2xlLmxvZyggdGhpcy5uYW1lICsgJyDQsdC10LbQuNGCLCDRgdC60L7RgNC+0YHRgtGMICcgKyB0aGlzLnNwZWVkICk7XG4gIH07XG5cbiAgQW5pbWFsLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zcGVlZCA9IDA7XG4gICAgY29uc29sZS5sb2coIHRoaXMubmFtZSArICcg0YHRgtC+0LjRgicgKTtcbiAgfTtcblxuICBmdW5jdGlvbiBSYWJiaXQobmFtZSkge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zcGVlZCA9IDA7XG4gIH1cblxuICAvKiBzZXQgcmlnaHQgcHJvdG90eXBlICovXG4gIFxuICBSYWJiaXQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShBbmltYWwucHJvdG90eXBlKVxuICBSYWJiaXQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUmFiYml0XG5cblxuXG4gIFJhYmJpdC5wcm90b3R5cGUuanVtcCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc3BlZWQrKztcbiAgICBjb25zb2xlLmxvZyggdGhpcy5uYW1lICsgJyDQv9GA0YvQs9Cw0LXRgicgKTtcbiAgfTtcblxuXG5cblxuICB2YXIgcmFiYml0ID0gbmV3IFJhYmJpdCgn0JrRgNC+0LvRjCcpO1xufVxuXG4vLyBleGFtcGxlMSgpXG5cblxuXG4vKlxuUGFyZW50IENvbnN0cnVjdG8gY2FsbFxuXG5kbyB0aGlzIGlmIHlvdSB3YW50IHRvIGF2b2lkIGR1cGxpY2F0aW9ucyBpbiBzb21lIGtpbmQgb2YgRGVjZW5kYW50c1xuKi9cblxuXG5mdW5jdGlvbiBleGFtcGxlMiAoKSB7XG4gIGZ1bmN0aW9uIEFuaW1hbChuYW1lKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLnNwZWVkID0gMDtcbiAgfVxuXG4gIGZ1bmN0aW9uIFJhYmJpdChuYW1lKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLnNwZWVkID0gMDtcbiAgfVxuXG4gIC8vYmV0dGVyXG4gIGZ1bmN0aW9uIFJhYmJpdCAoYXJndW1lbnQpIHtcbiAgICBBbmltYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuICB9XG59XG4vLyBleGFtcGxlMigpXG5cblxuXG4vKlxuUGFyZW50IE1ldGhvZCBvdmVycmlkaW5nXG4qL1xuXG5mdW5jdGlvbiBleGFtcGxlMyAoKSB7XG4gIGZ1bmN0aW9uIEFuaW1hbChuYW1lKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgICB0aGlzLnNwZWVkID0gMDtcbiAgfVxuXG4gIEFuaW1hbC5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24oc3BlZWQpIHtcbiAgICB0aGlzLnNwZWVkICs9IHNwZWVkO1xuICAgIGNvbnNvbGUubG9nKCB0aGlzLm5hbWUgKyAnINCx0LXQttC40YIsINGB0LrQvtGA0L7RgdGC0YwgJyArIHRoaXMuc3BlZWQgKTtcbiAgfTtcblxuICBmdW5jdGlvbiBSYWJiaXQobmFtZSkge1xuICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgdGhpcy5zcGVlZCA9IDA7XG4gIH1cblxuICBSYWJiaXQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShBbmltYWwucHJvdG90eXBlKVxuICBSYWJiaXQucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUmFiYml0XG5cbiAgUmFiYml0LnByb3RvdHlwZS5qdW1wID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zcGVlZCsrO1xuICAgIGNvbnNvbGUubG9nKCB0aGlzLm5hbWUgKyAnINC/0YDRi9Cz0LDQtdGCJyApO1xuICB9O1xuXG4gIC8vdG90YWwgb3ZlcnJpZGluZ1xuICBSYWJiaXQucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnNwZWVkKytcbiAgICB0aGlzLmp1bXAoKVxuICB9XG5cbiAgLy8gZXh0ZW5kIHBhcmVudCBtZXRob2RcbiAgUmFiYml0LnByb3RvdHlwZS5ydW4gPSBmdW5jdGlvbigpIHtcbiAgICBBbmltYWwucHJvdG90eXBlLnJ1bi5hcHBseSh0aGlzLCBhcmd1bWVudHMpIC8vIGRvbid0IGZvcmdldCBhYm91dCBwcm9wZXIgY29udGV4dFxuICAgIHRoaXMuanVtcCgpXG4gIH07XG5cbiAgdmFyIHJhYmJpdCA9IG5ldyBSYWJiaXQoJ9Ca0YDQvtC70YwnKTtcbn1cbi8vIGV4YW1wbGUzKClcblxuXG5cblxuLypUYXNrc1xuXG5GaW5kIGEgbWlzdGFrZSBpbiBpbmhlcml0YW5jZT9cbkhvdyBpdCBjYW4gYWZmZWN0IHRoZSBjb2RlP1xuKi9cblxuZnVuY3Rpb24gdGFzazEgKCkge1xuICBcbiAgZnVuY3Rpb24gQW5pbWFsKG5hbWUpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuICB9XG5cbiAgQW5pbWFsLnByb3RvdHlwZS53YWxrID0gZnVuY3Rpb24oKSB7XG4gICAgY29uc29sZS5sb2coIFwi0YXQvtC00LjRgiBcIiArIHRoaXMubmFtZSApO1xuICB9O1xuXG4gIGZ1bmN0aW9uIFJhYmJpdChuYW1lKSB7XG4gICAgdGhpcy5uYW1lID0gbmFtZTtcbiAgfVxuICBSYWJiaXQucHJvdG90eXBlID0gQW5pbWFsLnByb3RvdHlwZTtcblxuICBSYWJiaXQucHJvdG90eXBlLndhbGsgPSBmdW5jdGlvbigpIHtcbiAgICBjb25zb2xlLmxvZyggXCLQv9GA0YvQs9Cw0LXRgiEg0Lgg0YXQvtC00LjRgjogXCIgKyB0aGlzLm5hbWUgKTtcbiAgfTtcblxuICB2YXIgYSA9IG5ldyBBbmltYWwoJ2EnKVxuXG4gIHZhciByID0gbmV3IFJhYmJpdCgncicpXG5cbiAgYS53YWxrKCkgLy8g0L/RgNGL0LPQsNC10YIg0Lgg0YXQvtC00LjRgj8/Pz9cbiAgci53YWxrKClcbn1cblxuLy8gdGFzazEoKVxuXG4vKkRlY2lzaW9uOiBDaGFuZ2VzIG9mIFJhYmJpdCdzIHByb3RvdHlwZSBhZmZlY3QgdGhlIEFuaW1hbCdzIG9uZVxuKi9cblxuXG4vKlRhc2sgMlxuRmluZCB0aGUgbWlzdGFrZS4gSG93IGl0IGNhbiBhZmZlY3QgdGhlIGNvZGU/XG4qL1xuXG5mdW5jdGlvbiB0YXNrMiAoKSB7XG5cbiAgZnVuY3Rpb24gQW5pbWFsKG5hbWUpIHtcbiAgICB0aGlzLm5hbWUgPSBuYW1lO1xuXG4gICAgdGhpcy53YWxrID0gZnVuY3Rpb24oKSB7XG4gICAgICBjb25zb2xlLmxvZyggXCLRhdC+0LTQuNGCIFwiICsgdGhpcy5uYW1lICk7XG4gICAgfTtcbiAgfVxuXG5cbiAgZnVuY3Rpb24gUmFiYml0KG5hbWUpIHtcbiAgICBBbmltYWwuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIFJhYmJpdC5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKEFuaW1hbC5wcm90b3R5cGUpO1xuXG4gIFJhYmJpdC5wcm90b3R5cGUud2FsayA9IGZ1bmN0aW9uKCkge1xuICAgIGNvbnNvbGUubG9nKCBcItC/0YDRi9Cz0LDQtdGCIFwiICsgdGhpcy5uYW1lICk7XG4gIH07XG5cbiAgdmFyIHJhYmJpdCA9IG5ldyBSYWJiaXQoXCLQmtGA0L7Qu9GMXCIpO1xuICByYWJiaXQud2FsaygpO1xufVxuLy8gdGFzazIoKVxuXG4vKkRlc2ljaW9uOiBtZXRob2QgLnJ1bigpIHdpbGwgYmUgZm91bnQgaW4gQ29udGV4dCAoZnJvbSBBbmltYWwpXG5ub3QgaW4gUHJvdG90eXBlIChjb3JyZWN0LCB0aGF0IHdlIG5lZWQpXG5cbkNvbmNsdXNpb246IGRlZmluZSBtZXRob2RzIGluIHByb3RvdHlwZVxuKi9cblxuXG4vKlRhc2sgMzogcmV3cml0ZSBDbG9jayBpbiBwcm90b3R5cGUgc3R5bGVcblxuKi9cblxuZnVuY3Rpb24gdGFzazMgKCkge1xuICAvL1xuICBmdW5jdGlvbiBDbG9jayhvcHRpb25zKSB7XG4gICAgdmFyIHRlbXBsYXRlID0gb3B0aW9ucy50ZW1wbGF0ZTtcbiAgICB2YXIgdGltZXI7XG4gIFxuICAgIGZ1bmN0aW9uIHJlbmRlcigpIHtcbiAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICAgIHZhciBob3VycyA9IGRhdGUuZ2V0SG91cnMoKTtcbiAgICAgIGlmIChob3VycyA8IDEwKSBob3VycyA9ICcwJyArIGhvdXJzO1xuICAgICAgdmFyIG1pbiA9IGRhdGUuZ2V0TWludXRlcygpO1xuICAgICAgaWYgKG1pbiA8IDEwKSBtaW4gPSAnMCcgKyBtaW47XG4gICAgICB2YXIgc2VjID0gZGF0ZS5nZXRTZWNvbmRzKCk7XG4gICAgICBpZiAoc2VjIDwgMTApIHNlYyA9ICcwJyArIHNlYztcbiAgICAgIHZhciBvdXRwdXQgPSB0ZW1wbGF0ZS5yZXBsYWNlKCdoJywgaG91cnMpLnJlcGxhY2UoJ20nLCBtaW4pLnJlcGxhY2UoJ3MnLCBzZWMpO1xuICAgICAgY29uc29sZS5sb2cob3V0cHV0KTtcbiAgICB9XG4gICAgdGhpcy5zdG9wID0gZnVuY3Rpb24oKSB7XG4gICAgICBjbGVhckludGVydmFsKHRpbWVyKTtcbiAgICB9O1xuICAgIHRoaXMuc3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJlbmRlcigpO1xuICAgICAgdGltZXIgPSBzZXRJbnRlcnZhbChyZW5kZXIsIDEwMDApO1xuICAgIH1cbiAgfVxuICBcbiAgdmFyIGNmID0gbmV3IENsb2NrKHtcbiAgICB0ZW1wbGF0ZTogJ2g6bTpzJ1xuICB9KTtcbiAgLy8gY2Yuc3RhcnQoKTtcblxuXG4gIGZ1bmN0aW9uIENsb2NrUCAob3B0aW9ucykge1xuICAgIHRoaXMuX3RlbXBsYXRlID0gb3B0aW9ucy50ZW1wbGF0ZVxuICAgIHRoaXMuX3RpbWVyID0gbnVsbFxuICB9XG5cbiAgQ2xvY2tQLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XG4gICAgdmFyIGhvdXJzID0gZGF0ZS5nZXRIb3VycygpO1xuICAgIGlmIChob3VycyA8IDEwKSBob3VycyA9ICcwJyArIGhvdXJzO1xuICAgIHZhciBtaW4gPSBkYXRlLmdldE1pbnV0ZXMoKTtcbiAgICBpZiAobWluIDwgMTApIG1pbiA9ICcwJyArIG1pbjtcbiAgICB2YXIgc2VjID0gZGF0ZS5nZXRTZWNvbmRzKCk7XG4gICAgaWYgKHNlYyA8IDEwKSBzZWMgPSAnMCcgKyBzZWM7XG4gICAgdmFyIG91dHB1dCA9IHRoaXMuX3RlbXBsYXRlLnJlcGxhY2UoJ2gnLCBob3VycylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgnbScsIG1pbilcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAucmVwbGFjZSgncycsIHNlYyk7XG4gICAgY29uc29sZS5sb2cob3V0cHV0KTtcbiAgfTtcblxuICBDbG9ja1AucHJvdG90eXBlLnN0b3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLl90aW1lcilcbiAgfVxuXG4gIENsb2NrUC5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnJlbmRlcigpXG4gICAgdGhpcy5fdGltZXIgPSBzZXRJbnRlcnZhbCh0aGlzLnJlbmRlci5iaW5kKHRoaXMpLCAxMDAwKVxuICB9O1xuXG4gIHZhciBjcCA9IG5ldyBDbG9ja1Aoe1xuICAgIHRlbXBsYXRlOiAnaDptOnMnXG4gIH0pO1xuICBjcC5zdGFydCgpO1xuXG59XG4vLyB0YXNrMygpXG5cblxuXG5cblxuLypUYXNrIDQgXG5cbmV4dGVuZCBjbG9jayB3aXRoIG5ldyBkZXNjZW5kYW50LCB0aGF0IGhhcyBwcmVjaXNpb24gYW5pbWF0aW9uXG4qL1xuXG5mdW5jdGlvbiB0YXNrNCAoKSB7XG5cbiAgZnVuY3Rpb24gQ2xvY2sgKG9wdGlvbnMpIHtcbiAgICB0aGlzLl90ZW1wbGF0ZSA9IG9wdGlvbnMudGVtcGxhdGVcbiAgfVxuICBcbiAgQ2xvY2sucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcbiAgICB2YXIgaG91cnMgPSBkYXRlLmdldEhvdXJzKCk7XG4gICAgaWYgKGhvdXJzIDwgMTApIGhvdXJzID0gJzAnICsgaG91cnM7XG4gICAgdmFyIG1pbiA9IGRhdGUuZ2V0TWludXRlcygpO1xuICAgIGlmIChtaW4gPCAxMCkgbWluID0gJzAnICsgbWluO1xuICAgIHZhciBzZWMgPSBkYXRlLmdldFNlY29uZHMoKTtcbiAgICBpZiAoc2VjIDwgMTApIHNlYyA9ICcwJyArIHNlYztcbiAgICB2YXIgb3V0cHV0ID0gdGhpcy5fdGVtcGxhdGUucmVwbGFjZSgnaCcsIGhvdXJzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCdtJywgbWluKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXBsYWNlKCdzJywgc2VjKTtcbiAgICBjb25zb2xlLmxvZyhvdXRwdXQpO1xuICB9O1xuXG4gIENsb2NrLnByb3RvdHlwZS5zdG9wID0gZnVuY3Rpb24gKCkge1xuICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fdGltZXIpXG4gIH1cblxuICBDbG9jay5wcm90b3R5cGUuc3RhcnQgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnJlbmRlcigpXG4gICAgdGhpcy5fdGltZXIgPSBzZXRJbnRlcnZhbCh0aGlzLnJlbmRlci5iaW5kKHRoaXMpLCAxMDAwKVxuICB9O1xuXG5cblxuICAvLyBEZXNjZW5kYW50XG5cbiAgZnVuY3Rpb24gUmVsYXRpdmVDbG9jayhvcHRpb25zKSB7XG4gICAgQ2xvY2suYXBwbHkodGhpcywgYXJndW1lbnRzKSAvLyBjb2ZmZWUgc2NyaXB0IHN1cGVyKCkgOilcbiAgICB0aGlzLl9wcmVjaXNpb24gPSBvcHRpb25zLnByZWNpc2lvbiB8fCAxMDAwXG4gIH07XG5cbiAgUmVsYXRpdmVDbG9jay5wcm90b3R5cGUgPSBPYmplY3QuY3JlYXRlKENsb2NrLnByb3RvdHlwZSk7XG4gIFJlbGF0aXZlQ2xvY2sucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUmVsYXRpdmVDbG9jaztcblxuICBSZWxhdGl2ZUNsb2NrLnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMucmVuZGVyKClcbiAgICB0aGlzLl90aW1lciA9IHNldEludGVydmFsKHRoaXMucmVuZGVyLmJpbmQodGhpcyksIHRoaXMuX3ByZWNpc2lvbilcbiAgfTtcblxuICB2YXIgcmMgPSBuZXcgUmVsYXRpdmVDbG9jayh7XG4gICAgdGVtcGxhdGU6IFwiaDptOnNcIixcbiAgICBwcmVjaXNpb246IDEwMDAwXG4gIH0pXG4gIHJjLnN0YXJ0KClcbn1cbi8vIHRhc2s0KClcblxuXG5cblxuLypUYXNrIDU6XG5cbtCh0L7Qt9C00LDQudGC0LUg0L3QsNGB0LvQtdC00L3QuNC60LAgQW5pbWF0aW5nTWVudSwg0LrQvtGC0L7RgNGL0Lkg0LTQvtCx0LDQstC70Y/QtdGCINGC0YDQtdGC0YzQtSDRgdC+0YHRgtC+0Y/QvdC40LUgU1RBVEVfQU5JTUFUSU5HLlxuXG7Qn9GA0Lgg0LLRi9C30L7QstC1IG9wZW4oKSDRgdC+0YHRgtC+0Y/QvdC40LUg0LzQtdC90Y/QtdGC0YHRjyDQvdCwIFNUQVRFX0FOSU1BVElORyxcbtCwINGH0LXRgNC10LcgMSDRgdC10LrRg9C90LTRgywg0L/QviDRgtCw0LnQvNC10YDRgywg0L7RgtC60YDRi9GC0LjQtSDQt9Cw0LLQtdGA0YjQsNC10YLRgdGPINCy0YvQt9C+0LLQvtC8IG9wZW4oKSDRgNC+0LTQuNGC0LXQu9GPLlxuXG7QktGL0LfQvtCyIGNsb3NlKCkg0L/RgNC4INC90LXQvtCx0YXQvtC00LjQvNC+0YHRgtC4INC+0YLQvNC10L3Rj9C10YIg0YLQsNC50LzQtdGAINCw0L3QuNC80LDRhtC40LhcbijQvdCw0LfQvdCw0YfQsNC10LzRi9C5INCyIG9wZW4pINC4INC/0LXRgNC10LTQsNGR0YIg0LLRi9C30L7QsiDRgNC+0LTQuNGC0LXQu9GM0YHQutC+0LzRgyBjbG9zZS5cblxu0JzQtdGC0L7QtCBzaG93U3RhdGUg0LTQu9GPINC90L7QstC+0LPQviDRgdC+0YHRgtC+0Y/QvdC40Y8g0LLRi9Cy0L7QtNC40YIgXCLQsNC90LjQvNCw0YbQuNGPXCIsXG7QtNC70Y8g0L7RgdGC0LDQu9GM0L3Ri9GFIOKAlCDQv9C+0LvQsNCz0LDQtdGC0YHRjyDQvdCwINGA0L7QtNC40YLQtdC70Y8uXG4qL1xuXG5cbmZ1bmN0aW9uIHRhc2s1ICgpIHtcbiAgXG4gIGZ1bmN0aW9uIE1lbnUoc3RhdGUpIHtcbiAgICB0aGlzLl9zdGF0ZSA9IHN0YXRlIHx8IE1lbnUuU1RBVEVfQ0xPU0VEO1xuICB9O1xuXG4gIE1lbnUuU1RBVEVfT1BFTiA9IDE7XG4gIE1lbnUuU1RBVEVfQ0xPU0VEID0gMDtcblxuICBNZW51LnByb3RvdHlwZS5vcGVuID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5fc3RhdGUgPSBNZW51LlNUQVRFX09QRU47XG4gIH07XG5cbiAgTWVudS5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLl9zdGF0ZSA9IE1lbnUuU1RBVEVfQ0xPU0VEO1xuICB9O1xuXG4gIE1lbnUucHJvdG90eXBlLl9zdGF0ZUFzU3RyaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgc3dpdGNoICh0aGlzLl9zdGF0ZSkge1xuICAgICAgY2FzZSBNZW51LlNUQVRFX09QRU46XG4gICAgICAgIHJldHVybiAn0L7RgtC60YDRi9GC0L4nO1xuXG4gICAgICBjYXNlIE1lbnUuU1RBVEVfQ0xPU0VEOlxuICAgICAgICByZXR1cm4gJ9C30LDQutGA0YvRgtC+JztcbiAgICB9XG4gIH07XG5cbiAgTWVudS5wcm90b3R5cGUuc2hvd1N0YXRlID0gZnVuY3Rpb24oKSB7XG4gICAgY29uc29sZS5sb2codGhpcy5fc3RhdGVBc1N0cmluZygpKTtcbiAgfTtcblxuXG4gIFxuICAvLyBBbmltYXRpbmcgbWVudVxuXG4gIGZ1bmN0aW9uIEFuaW1hdGluZ01lbnUgKHN0YXRlKSB7XG4gICAgTWVudS5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gICAgdGhpcy5fYW5pbWF0aW9uRHVyYXRpb24gPSBzdGF0ZS5hbmltYXRpb25EdXJhdGlvbiB8fCAxMDAwXG4gIH1cblxuICBBbmltYXRpbmdNZW51LlNUQVRFX0FOSU1BVElORyA9ICfQsNC90LjQvNCw0YbQuNGPJ1xuXG4gIEFuaW1hdGluZ01lbnUucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShNZW51LnByb3RvdHlwZSlcbiAgQW5pbWF0aW5nTWVudS5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBBbmltYXRpbmdNZW51XG5cbiAgQW5pbWF0aW5nTWVudS5wcm90b3R5cGUub3BlbiA9IGZ1bmN0aW9uKCl7XG4gICAgdGhpcy5fc3RhdGUgPSBBbmltYXRpbmdNZW51LlNUQVRFX0FOSU1BVElOR1xuICAgIHRoaXMuX3RpbWVyID0gc2V0VGltZW91dChNZW51LnByb3RvdHlwZS5vcGVuLmJpbmQodGhpcywgYXJndW1lbnRzKSwgdGhpcy5fYW5pbWF0aW9uRHVyYXRpb24pXG4gIH07XG5cbiAgQW5pbWF0aW5nTWVudS5wcm90b3R5cGUuY2xvc2UgPSBmdW5jdGlvbigpe1xuICAgIGNsZWFyVGltZW91dCh0aGlzLl90aW1lcilcbiAgICBNZW51LnByb3RvdHlwZS5jbG9zZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG4gIH07XG5cbiAgQW5pbWF0aW5nTWVudS5wcm90b3R5cGUuc2hvd1N0YXRlID0gZnVuY3Rpb24gKCkge1xuICAgIGlmICh0aGlzLl9zdGF0ZSA9PT0gQW5pbWF0aW5nTWVudS5TVEFURV9BTklNQVRJTkcpIHtcbiAgICAgIGNvbnNvbGUubG9nKHRoaXMuX3N0YXRlKTtcbiAgICB9IGVsc2Uge1xuICAgICAgTWVudS5wcm90b3R5cGUuc2hvd1N0YXRlLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcbiAgICB9XG4gIH1cblxuICB2YXIgYW0gPSBuZXcgQW5pbWF0aW5nTWVudShmYWxzZSlcbiAgYW0uc2hvd1N0YXRlKCkgLy9jbG9zZWRcbiAgYW0ub3BlbigpXG4gIGFtLnNob3dTdGF0ZSgpIC8vYW5pbWF0aW9uXG4gIHNldFRpbWVvdXQoYW0uc2hvd1N0YXRlLmJpbmQoYW0pLCAxMDAxKVxuICBhbS5zaG93U3RhdGUoKSAvL29wZW5lZFxufVxuLy8gdGFzazUoKVxuXG5cblxuLypUYXNrIDY6IGNvbnN0cnVjdG9yIGNoZWNraW5nXG53aGF0IHdyaXRlIGNvbnNvbGUubG9nP1xuKi9cblxuZnVuY3Rpb24gdGFzazYgKCkge1xuICBcbiAgZnVuY3Rpb24gQW5pbWFsKCkge31cblxuICBmdW5jdGlvbiBSYWJiaXQoKSB7fVxuICBSYWJiaXQucHJvdG90eXBlID0gT2JqZWN0LmNyZWF0ZShBbmltYWwucHJvdG90eXBlKTtcblxuICB2YXIgcmFiYml0ID0gbmV3IFJhYmJpdCgpO1xuXG4gIGNvbnNvbGUubG9nKCByYWJiaXQuY29uc3RydWN0b3IgPT0gUmFiYml0ICk7XG59XG50YXNrNigpXG5cbi8qQW5zd2VyOiBmYWxzZSwgYmVjYXVzZSByYWJiaXQuY29uc3RydWN0b3IgaXMgQW5pbWFsLFxudG8gcHJldmVudCB0aGlzIC0gc2V0IGNvbnN0cnVjdG9yIGV4cGxpY2l0bHlcblJhYmJpdC5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBSYWJiaXRcbiovXG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
