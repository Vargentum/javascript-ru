'use strict';

/*

Widget: 
  
  - object that controls excisting DOM, or create its own one
  - only ONE element inside Widget Constructor
  - no ID inside markup
  - Delegation for handlers
  
  - Handlers call following methods, avoid `hard` logic in handlers
    - better readability
    - possibility to add public methods
  
  - Lazy DOM generation:
    - render if really need
    - increase performance at `Init loading stage`

    example: don't render Dropdown inside Menu, do it when user try to open it!


  - separate Public & Private methods

*/

function example1() {

  function Menu(options) {

    var elem = null;

    function getElem() {
      if (!elem) render();
      return elem;
    }

    function render() {
      elem = document.createElement('div');
      elem.classList.add('menu');
      document.body.appendChild(elem);

      var title = document.createElement('span');
      title.classList.add('menu-title');
      title.textContent = options.title;
      elem.appendChild(title);

      elem.addEventListener('click', function (e) {
        if (!event.target.closest('.menu-title')) return;
        toggle();
      });
    }

    function renderItems() {
      var list = document.createElement('ul');
      list.classList.add('menu-list');
      options.items.forEach(function (item) {
        var li = document.createElement('li');
        li.textContent = item;
        list.appendChild(li);
      });
      elem.appendChild(list);
    }

    function open() {
      var list = elem.querySelector('ul');
      if (!list) renderItems();
      elem.classList.add('is-open');
    }

    function close() {
      elem.classList.remove('is-open');
    }

    function toggle() {
      if (elem.classList.contains('is-open')) close();else open();
    }

    this.open = open;
    this.close = close;
    this.toggle = toggle;
    this.getElem = getElem;
  }

  // создать объект меню с данным заголовком и опциями
  var menu = new Menu({
    title: "Сладости",
    items: ["Торт", "Пончик", "Пирожное", "Шоколадка", "Мороженое"]
  });

  // получить сгенерированный DOM-элемент меню
  var elem = menu.getElem();

  // вставить меню в нужное место страницы
  document.body.appendChild(elem);
}
// example1()

/* Task 1

Создайте компонент «Часы» (Clock).
Интерфейс:

var clock = new Clock({
  elem: элемент
});

clock.start(); // старт
clock.stop(); // стоп
Остальные методы, если нужны, должны быть приватными.

При нажатии на alert часы должны приостанавливаться, а затем продолжать идти с правильным временем.
*/

function task1() {

  function Clock(options) {
    var elem = options.elem;
    var timerId = null;
    var stringifyTime = function stringifyTime(time) {
      return time < 10 ? '0' + time : time;
    };

    function createSgmt(type) {
      var sgmt = document.createElement('span');
      sgmt.classList.add('clock-' + type);
      elem.appendChild(sgmt);
      return sgmt;
    }

    function update(date) {
      var dateTpl = [{
        name: 'hour',
        time: date.getHours()
      }, {
        name: 'minute',
        time: date.getMinutes()
      }, {
        name: 'second',
        time: date.getSeconds()
      }];

      dateTpl.forEach(function (tpl) {
        var name = tpl.name;
        var time = tpl.time;

        var sgmt = elem.querySelector('.clock-' + name);

        if (!sgmt) sgmt = createSgmt(name);
        sgmt.textContent = stringifyTime(time);
      });
    }

    function start() {
      timerId = setTimeout(function () {
        update(new Date());
        start();
      }, 100);
    }

    function stop() {
      if (timerId) clearTimeout(timerId);
    }

    this.start = start;
    this.stop = stop;
    start();
  }

  var clock = new Clock({
    elem: document.getElementById('clock')
  });

  var start = document.getElementById('clock-start');
  start.onclick = clock.start;

  var stop = document.getElementById('clock-stop');
  stop.onclick = clock.stop;
}
task1();

/* Task 2
Напишите функцию-конструктор new Voter(options) для голосовалки. Она должна получать элемент в options.elem, в следующей разметке:
  По клику на + и — число должно увеличиваться или уменьшаться.
  Публичный метод voter.setVote(vote) должен устанавливать текущее число – значение голоса.
  Все остальные методы и свойства пусть будут приватными.
*/

function task2() {

  function Voter(options) {
    var elem = options.elem;
    var elemId = elem.id;
    var $vote = null;
    var vote = 0;
    var html = '<div id="' + elemId + '" class="voter">\n                 <span class="down">—</span>\n                 <span class="vote">' + vote + '</span>\n                 <span class="up">+</span>\n               </div>';

    function init() {
      elem.insertAdjacentHTML('beforeBegin', html);
      elem.parentElement.removeChild(elem);
      elem = document.getElementById(elemId);

      $vote = elem.querySelector('.vote');
      elem.addEventListener('click', function (e) {
        handleClick(e);
      });
    }

    function handleClick(e) {
      var vote = parseInt($vote.textContent);
      var isTarget = function isTarget(type) {
        return e.target.classList.contains(type);
      };

      if (isTarget('down')) setVote(--vote);else if (isTarget('up')) setVote(++vote);else return;
    }

    function setVote(vote) {
      $vote.textContent = vote;
    }

    this.setVote = setVote;
    init();
  }

  new Voter({
    elem: document.getElementById('voter')
  }).setVote(15);
}
// task2()

/*Task 3

Поменяйте стиль ООП в голосовалке, созданной в задаче Голосовалка на прототипный.
Внешний код, использующий класс Voter, не должен измениться.

*/

function task3() {

  var Voter = stampit().props({
    elem: '',
    id: _.uniqueId('voter-')
  }).methods({
    _replaceHTML: function _replaceHTML(elem) {
      elem.insertAdjacentHTML('beforeBegin', this.html);
      elem.parentElement.removeChild(this.elem);
      elem = document.getElementById(this.id);
      return elem;
    },
    _handleClick: function _handleClick(e) {
      var vote = parseInt(this.$vote.textContent);
      var isTarget = function isTarget(type) {
        return e.target.classList.contains(type);
      };
      if (isTarget('down')) this.setVote(--vote);else if (isTarget('up')) this.setVote(++vote);else return;
    },
    setVote: function setVote(vote) {
      this.$vote.textContent = vote;
    }
  }).init(function () {
    var _this = this;

    this.html = '<div id="' + this.id + '" class="voter">\n                     <span class="down">—</span>\n                     <span class="vote">0</span>\n                     <span class="up">+</span>\n                   </div>';
    var elem = this._replaceHTML(this.elem);
    this.$vote = elem.querySelector('.vote');

    elem.addEventListener('click', function (e) {
      _this._handleClick(e);
    });

    return this;
  });

  var voter = Voter({
    elem: document.getElementById('voter')
  });
  voter.setVote(15);

  /*
  Task 4:
  
  Создайте функцию-конструктор StepVoter, 
  которая наследует от голосовалки, созданной в задаче Голосовалка в прототипном стиле ООП
  и добавляет голосовалке опцию options.step, которая задаёт «шаг» голоса.
  */

  var StepVoter = stampit().props({
    step: 1
  }).methods({
    _handleClick: function _handleClick() {
      var vote = parseInt(this.$vote.textContent);
      var isTarget = function isTarget(type) {
        return e.target.classList.contains(type);
      };
      debugger;
      if (isTarget('down')) this.setVote(vote + step);else if (isTarget('up')) this.setVote(vote - step);else return;
    }
  }).compose(Voter);

  var stepVoter = StepVoter({
    elem: document.getElementById('step-voter'),
    step: 25
  });
}
task3();
//# sourceMappingURL=data:application/json;base64,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QUMsQ0FBQTtBQUMzQyxVQUFJLFFBQVEsR0FBRyxTQUFYLFFBQVEsQ0FBRyxJQUFJO2VBQUksQ0FBQyxDQUFDLE1BQU0sQ0FBQyxTQUFTLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQztPQUFBLENBQUE7QUFDeEQsZUFBUTtBQUNSLFVBQUksUUFBUSxDQUFDLE1BQU0sQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFBLEtBQzFDLElBQUksUUFBUSxDQUFDLElBQUksQ0FBQyxFQUFFLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxHQUFHLElBQUksQ0FBQyxDQUFBLEtBQzdDLE9BQU07S0FDWjtHQUNGLENBQUMsQ0FDRCxPQUFPLENBQUMsS0FBSyxDQUFDLENBQUE7O0FBR2pCLE1BQUksU0FBUyxHQUFHLFNBQVMsQ0FBQztBQUN4QixRQUFJLEVBQUUsUUFBUSxDQUFDLGNBQWMsQ0FBQyxZQUFZLENBQUM7QUFDM0MsUUFBSSxFQUFFLEVBQUU7R0FDVCxDQUFDLENBQUE7Q0FFSDtBQUNELEtBQUssRUFBRSxDQUFBIiwiZmlsZSI6InBhcnQyL2NvbXBvbmVudHMvMDEuc3RydWN0dXJlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLypcblxuV2lkZ2V0OiBcbiAgXG4gIC0gb2JqZWN0IHRoYXQgY29udHJvbHMgZXhjaXN0aW5nIERPTSwgb3IgY3JlYXRlIGl0cyBvd24gb25lXG4gIC0gb25seSBPTkUgZWxlbWVudCBpbnNpZGUgV2lkZ2V0IENvbnN0cnVjdG9yXG4gIC0gbm8gSUQgaW5zaWRlIG1hcmt1cFxuICAtIERlbGVnYXRpb24gZm9yIGhhbmRsZXJzXG4gIFxuICAtIEhhbmRsZXJzIGNhbGwgZm9sbG93aW5nIG1ldGhvZHMsIGF2b2lkIGBoYXJkYCBsb2dpYyBpbiBoYW5kbGVyc1xuICAgIC0gYmV0dGVyIHJlYWRhYmlsaXR5XG4gICAgLSBwb3NzaWJpbGl0eSB0byBhZGQgcHVibGljIG1ldGhvZHNcbiAgXG4gIC0gTGF6eSBET00gZ2VuZXJhdGlvbjpcbiAgICAtIHJlbmRlciBpZiByZWFsbHkgbmVlZFxuICAgIC0gaW5jcmVhc2UgcGVyZm9ybWFuY2UgYXQgYEluaXQgbG9hZGluZyBzdGFnZWBcblxuICAgIGV4YW1wbGU6IGRvbid0IHJlbmRlciBEcm9wZG93biBpbnNpZGUgTWVudSwgZG8gaXQgd2hlbiB1c2VyIHRyeSB0byBvcGVuIGl0IVxuXG5cbiAgLSBzZXBhcmF0ZSBQdWJsaWMgJiBQcml2YXRlIG1ldGhvZHNcblxuKi9cblxuZnVuY3Rpb24gZXhhbXBsZTEgKCkge1xuICBcbiAgZnVuY3Rpb24gTWVudSAob3B0aW9ucykge1xuICAgIFxuICAgIGxldCBlbGVtID0gbnVsbDtcblxuICAgIGZ1bmN0aW9uIGdldEVsZW0oKSB7XG4gICAgICBpZiAoIWVsZW0pIHJlbmRlcigpXG4gICAgICByZXR1cm4gZWxlbVxuICAgIH1cblxuXG4gICAgZnVuY3Rpb24gcmVuZGVyKCkge1xuICAgICAgZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ21lbnUnKVxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtKVxuXG4gICAgICBsZXQgdGl0bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcbiAgICAgIHRpdGxlLmNsYXNzTGlzdC5hZGQoJ21lbnUtdGl0bGUnKVxuICAgICAgdGl0bGUudGV4dENvbnRlbnQgPSBvcHRpb25zLnRpdGxlXG4gICAgICBlbGVtLmFwcGVuZENoaWxkKHRpdGxlKVxuXG5cbiAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgICBpZiAoIWV2ZW50LnRhcmdldC5jbG9zZXN0KCcubWVudS10aXRsZScpKSByZXR1cm5cbiAgICAgICAgdG9nZ2xlKClcbiAgICAgIH0pXG4gICAgfVxuXG5cbiAgICBmdW5jdGlvbiByZW5kZXJJdGVtcygpIHtcbiAgICAgIGxldCBsaXN0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndWwnKVxuICAgICAgbGlzdC5jbGFzc0xpc3QuYWRkKCdtZW51LWxpc3QnKVxuICAgICAgb3B0aW9ucy5pdGVtcy5mb3JFYWNoKGl0ZW0gPT4ge1xuICAgICAgICBsZXQgbGkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdsaScpXG4gICAgICAgIGxpLnRleHRDb250ZW50ID0gaXRlbVxuICAgICAgICBsaXN0LmFwcGVuZENoaWxkKGxpKVxuICAgICAgfSlcbiAgICAgIGVsZW0uYXBwZW5kQ2hpbGQobGlzdClcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIG9wZW4oKSB7XG4gICAgICBsZXQgbGlzdCA9IGVsZW0ucXVlcnlTZWxlY3RvcigndWwnKVxuICAgICAgaWYgKCFsaXN0KSByZW5kZXJJdGVtcygpXG4gICAgICBlbGVtLmNsYXNzTGlzdC5hZGQoJ2lzLW9wZW4nKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGNsb3NlKCkge1xuICAgICAgZWxlbS5jbGFzc0xpc3QucmVtb3ZlKCdpcy1vcGVuJylcbiAgICB9XG5cblxuICAgIGZ1bmN0aW9uIHRvZ2dsZSgpIHtcbiAgICAgIGlmIChlbGVtLmNsYXNzTGlzdC5jb250YWlucygnaXMtb3BlbicpKSBjbG9zZSgpXG4gICAgICBlbHNlIG9wZW4oKVxuICAgIH1cblxuXG4gICAgdGhpcy5vcGVuID0gb3BlblxuICAgIHRoaXMuY2xvc2UgPSBjbG9zZVxuICAgIHRoaXMudG9nZ2xlID0gdG9nZ2xlXG4gICAgdGhpcy5nZXRFbGVtID0gZ2V0RWxlbVxuICB9XG5cblxuXG5cbiAgLy8g0YHQvtC30LTQsNGC0Ywg0L7QsdGK0LXQutGCINC80LXQvdGOINGBINC00LDQvdC90YvQvCDQt9Cw0LPQvtC70L7QstC60L7QvCDQuCDQvtC/0YbQuNGP0LzQuFxuICBsZXQgbWVudSA9IG5ldyBNZW51KHtcbiAgICB0aXRsZTogXCLQodC70LDQtNC+0YHRgtC4XCIsXG4gICAgaXRlbXM6IFtcbiAgICAgIFwi0KLQvtGA0YJcIixcbiAgICAgIFwi0J/QvtC90YfQuNC6XCIsXG4gICAgICBcItCf0LjRgNC+0LbQvdC+0LVcIixcbiAgICAgIFwi0KjQvtC60L7Qu9Cw0LTQutCwXCIsXG4gICAgICBcItCc0L7RgNC+0LbQtdC90L7QtVwiXG4gICAgXVxuICB9KTtcblxuICAvLyDQv9C+0LvRg9GH0LjRgtGMINGB0LPQtdC90LXRgNC40YDQvtCy0LDQvdC90YvQuSBET00t0Y3Qu9C10LzQtdC90YIg0LzQtdC90Y5cbiAgbGV0IGVsZW0gPSBtZW51LmdldEVsZW0oKTtcblxuICAvLyDQstGB0YLQsNCy0LjRgtGMINC80LXQvdGOINCyINC90YPQttC90L7QtSDQvNC10YHRgtC+INGB0YLRgNCw0L3QuNGG0YtcbiAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChlbGVtKTtcbn1cbi8vIGV4YW1wbGUxKClcblxuXG5cblxuXG5cblxuXG5cbi8qIFRhc2sgMVxuXG7QodC+0LfQtNCw0LnRgtC1INC60L7QvNC/0L7QvdC10L3RgiDCq9Cn0LDRgdGLwrsgKENsb2NrKS5cbtCY0L3RgtC10YDRhNC10LnRgTpcblxudmFyIGNsb2NrID0gbmV3IENsb2NrKHtcbiAgZWxlbTog0Y3Qu9C10LzQtdC90YJcbn0pO1xuXG5jbG9jay5zdGFydCgpOyAvLyDRgdGC0LDRgNGCXG5jbG9jay5zdG9wKCk7IC8vINGB0YLQvtC/XG7QntGB0YLQsNC70YzQvdGL0LUg0LzQtdGC0L7QtNGLLCDQtdGB0LvQuCDQvdGD0LbQvdGLLCDQtNC+0LvQttC90Ysg0LHRi9GC0Ywg0L/RgNC40LLQsNGC0L3Ri9C80LguXG5cbtCf0YDQuCDQvdCw0LbQsNGC0LjQuCDQvdCwIGFsZXJ0INGH0LDRgdGLINC00L7Qu9C20L3RiyDQv9GA0LjQvtGB0YLQsNC90LDQstC70LjQstCw0YLRjNGB0Y8sINCwINC30LDRgtC10Lwg0L/RgNC+0LTQvtC70LbQsNGC0Ywg0LjQtNGC0Lgg0YEg0L/RgNCw0LLQuNC70YzQvdGL0Lwg0LLRgNC10LzQtdC90LXQvC5cbiovXG5cblxuXG5mdW5jdGlvbiB0YXNrMSAoKSB7XG4gIFxuXG4gIGZ1bmN0aW9uIENsb2NrIChvcHRpb25zKSB7XG4gICAgbGV0IGVsZW0gPSBvcHRpb25zLmVsZW1cbiAgICBsZXQgdGltZXJJZCA9IG51bGxcbiAgICBsZXQgc3RyaW5naWZ5VGltZSA9IHRpbWUgPT4gdGltZSA8IDEwID8gYDAke3RpbWV9YCA6IHRpbWVcblxuICAgIGZ1bmN0aW9uIGNyZWF0ZVNnbXQodHlwZSkge1xuICAgICAgbGV0IHNnbXQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcbiAgICAgIHNnbXQuY2xhc3NMaXN0LmFkZChgY2xvY2stJHt0eXBlfWApXG4gICAgICBlbGVtLmFwcGVuZENoaWxkKHNnbXQpXG4gICAgICByZXR1cm4gc2dtdFxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHVwZGF0ZShkYXRlKSB7XG4gICAgICBsZXQgZGF0ZVRwbCA9IFt7XG4gICAgICAgIG5hbWU6ICdob3VyJyxcbiAgICAgICAgdGltZTogZGF0ZS5nZXRIb3VycygpXG4gICAgICB9LHtcbiAgICAgICAgbmFtZTogJ21pbnV0ZScsXG4gICAgICAgIHRpbWU6IGRhdGUuZ2V0TWludXRlcygpXG4gICAgICB9LHtcbiAgICAgICAgbmFtZTogJ3NlY29uZCcsXG4gICAgICAgIHRpbWU6IGRhdGUuZ2V0U2Vjb25kcygpXG4gICAgICB9XVxuXG4gICAgICBkYXRlVHBsLmZvckVhY2godHBsID0+IHtcbiAgICAgICAgbGV0IHtuYW1lLCB0aW1lfSA9IHRwbFxuICAgICAgICBsZXQgc2dtdCA9IGVsZW0ucXVlcnlTZWxlY3RvcihgLmNsb2NrLSR7bmFtZX1gKVxuXG4gICAgICAgIGlmICghc2dtdCkgc2dtdCA9IGNyZWF0ZVNnbXQobmFtZSlcbiAgICAgICAgc2dtdC50ZXh0Q29udGVudCA9IHN0cmluZ2lmeVRpbWUodGltZSlcbiAgICAgIH0pXG4gICAgfVxuICAgIFxuICAgIGZ1bmN0aW9uIHN0YXJ0KCkge1xuICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQoKCkgPT4ge1xuICAgICAgICB1cGRhdGUobmV3IERhdGUoKSlcbiAgICAgICAgc3RhcnQoKVxuICAgICAgfSwgMTAwKVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIHN0b3AoKSB7XG4gICAgICBpZiAodGltZXJJZCkgY2xlYXJUaW1lb3V0KHRpbWVySWQpXG4gICAgfSAgICBcblxuICAgIHRoaXMuc3RhcnQgPSBzdGFydFxuICAgIHRoaXMuc3RvcCA9IHN0b3BcbiAgICBzdGFydCgpXG4gIH1cblxuXG5cbiAgbGV0IGNsb2NrID0gbmV3IENsb2NrKHtcbiAgICBlbGVtOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2xvY2snKVxuICB9KVxuXG4gIGxldCBzdGFydCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjbG9jay1zdGFydCcpXG4gIHN0YXJ0Lm9uY2xpY2sgPSBjbG9jay5zdGFydFxuXG4gIGxldCBzdG9wID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Nsb2NrLXN0b3AnKVxuICBzdG9wLm9uY2xpY2sgPSBjbG9jay5zdG9wXG5cbn1cbnRhc2sxKClcblxuXG5cblxuXG5cblxuLyogVGFzayAyXG7QndCw0L/QuNGI0LjRgtC1INGE0YPQvdC60YbQuNGOLdC60L7QvdGB0YLRgNGD0LrRgtC+0YAgbmV3IFZvdGVyKG9wdGlvbnMpINC00LvRjyDQs9C+0LvQvtGB0L7QstCw0LvQutC4LiDQntC90LAg0LTQvtC70LbQvdCwINC/0L7Qu9GD0YfQsNGC0Ywg0Y3Qu9C10LzQtdC90YIg0LIgb3B0aW9ucy5lbGVtLCDQsiDRgdC70LXQtNGD0Y7RidC10Lkg0YDQsNC30LzQtdGC0LrQtTpcbiAg0J/QviDQutC70LjQutGDINC90LAgKyDQuCDigJQg0YfQuNGB0LvQviDQtNC+0LvQttC90L4g0YPQstC10LvQuNGH0LjQstCw0YLRjNGB0Y8g0LjQu9C4INGD0LzQtdC90YzRiNCw0YLRjNGB0Y8uXG4gINCf0YPQsdC70LjRh9C90YvQuSDQvNC10YLQvtC0IHZvdGVyLnNldFZvdGUodm90ZSkg0LTQvtC70LbQtdC9INGD0YHRgtCw0L3QsNCy0LvQuNCy0LDRgtGMINGC0LXQutGD0YnQtdC1INGH0LjRgdC70L4g4oCTINC30L3QsNGH0LXQvdC40LUg0LPQvtC70L7RgdCwLlxuICDQktGB0LUg0L7RgdGC0LDQu9GM0L3Ri9C1INC80LXRgtC+0LTRiyDQuCDRgdCy0L7QudGB0YLQstCwINC/0YPRgdGC0Ywg0LHRg9C00YPRgiDQv9GA0LjQstCw0YLQvdGL0LzQuC5cbiovXG5cbmZ1bmN0aW9uIHRhc2syICgpIHtcbiAgXG4gIGZ1bmN0aW9uIFZvdGVyKG9wdGlvbnMpIHtcbiAgICBsZXQgZWxlbSA9IG9wdGlvbnMuZWxlbVxuICAgIGxldCBlbGVtSWQgPSBlbGVtLmlkXG4gICAgbGV0ICR2b3RlID0gbnVsbFxuICAgIGxldCB2b3RlID0gMFxuICAgIGxldCBodG1sID0gYDxkaXYgaWQ9XCIke2VsZW1JZH1cIiBjbGFzcz1cInZvdGVyXCI+XG4gICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZG93blwiPuKAlDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ2b3RlXCI+JHt2b3RlfTwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJ1cFwiPis8L3NwYW4+XG4gICAgICAgICAgICAgICA8L2Rpdj5gXG5cbiAgICBmdW5jdGlvbiBpbml0KCkge1xuICAgICAgZWxlbS5pbnNlcnRBZGphY2VudEhUTUwoJ2JlZm9yZUJlZ2luJywgaHRtbClcbiAgICAgIGVsZW0ucGFyZW50RWxlbWVudC5yZW1vdmVDaGlsZChlbGVtKVxuICAgICAgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGVsZW1JZClcblxuICAgICAgJHZvdGUgPSBlbGVtLnF1ZXJ5U2VsZWN0b3IoJy52b3RlJylcbiAgICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGhhbmRsZUNsaWNrKGUpXG4gICAgICB9KVxuICAgIH1cblxuICAgIGZ1bmN0aW9uIGhhbmRsZUNsaWNrIChlKSB7XG4gICAgICBsZXQgdm90ZSA9IHBhcnNlSW50KCR2b3RlLnRleHRDb250ZW50KVxuICAgICAgbGV0IGlzVGFyZ2V0ID0gdHlwZSA9PiBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnModHlwZSlcblxuICAgICAgaWYgKGlzVGFyZ2V0KCdkb3duJykpIHNldFZvdGUoLS12b3RlKVxuICAgICAgZWxzZSBpZiAoaXNUYXJnZXQoJ3VwJykpIHNldFZvdGUoKyt2b3RlKVxuICAgICAgZWxzZSByZXR1cm5cbiAgICB9XG5cbiAgICBmdW5jdGlvbiBzZXRWb3RlKHZvdGUpIHtcbiAgICAgICR2b3RlLnRleHRDb250ZW50ID0gdm90ZVxuICAgIH1cblxuXG4gICAgdGhpcy5zZXRWb3RlID0gc2V0Vm90ZVxuICAgIGluaXQoKVxuICB9XG5cbiAgbmV3IFZvdGVyKHtcbiAgICBlbGVtOiBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndm90ZXInKVxuICB9KS5zZXRWb3RlKDE1KVxuXG5cblxuXG59XG4vLyB0YXNrMigpXG5cblxuXG5cblxuXG5cbi8qVGFzayAzXG5cbtCf0L7QvNC10L3Rj9C50YLQtSDRgdGC0LjQu9GMINCe0J7QnyDQsiDQs9C+0LvQvtGB0L7QstCw0LvQutC1LCDRgdC+0LfQtNCw0L3QvdC+0Lkg0LIg0LfQsNC00LDRh9C1INCT0L7Qu9C+0YHQvtCy0LDQu9C60LAg0L3QsCDQv9GA0L7RgtC+0YLQuNC/0L3Ri9C5Llxu0JLQvdC10YjQvdC40Lkg0LrQvtC0LCDQuNGB0L/QvtC70YzQt9GD0Y7RidC40Lkg0LrQu9Cw0YHRgSBWb3Rlciwg0L3QtSDQtNC+0LvQttC10L0g0LjQt9C80LXQvdC40YLRjNGB0Y8uXG5cbiovXG5cbmZ1bmN0aW9uIHRhc2szICgpIHtcblxuICBjb25zdCBWb3RlciA9IHN0YW1waXQoKVxuICAgIC5wcm9wcyh7XG4gICAgICBlbGVtOiAnJyxcbiAgICAgIGlkOiBfLnVuaXF1ZUlkKCd2b3Rlci0nKVxuICAgIH0pXG4gICAgLm1ldGhvZHMoe1xuICAgICAgX3JlcGxhY2VIVE1MOiBmdW5jdGlvbihlbGVtKSB7XG4gICAgICAgIGVsZW0uaW5zZXJ0QWRqYWNlbnRIVE1MKCdiZWZvcmVCZWdpbicsIHRoaXMuaHRtbClcbiAgICAgICAgZWxlbS5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbSlcbiAgICAgICAgZWxlbSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMuaWQpXG4gICAgICAgIHJldHVybiBlbGVtXG4gICAgICB9LFxuICAgICAgX2hhbmRsZUNsaWNrOiBmdW5jdGlvbihlKSB7XG4gICAgICAgIGxldCB2b3RlID0gcGFyc2VJbnQodGhpcy4kdm90ZS50ZXh0Q29udGVudClcbiAgICAgICAgbGV0IGlzVGFyZ2V0ID0gdHlwZSA9PiBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnModHlwZSlcbiAgICAgICAgaWYgKGlzVGFyZ2V0KCdkb3duJykpIHRoaXMuc2V0Vm90ZSgtLXZvdGUpXG4gICAgICAgIGVsc2UgaWYgKGlzVGFyZ2V0KCd1cCcpKSB0aGlzLnNldFZvdGUoKyt2b3RlKVxuICAgICAgICBlbHNlIHJldHVyblxuICAgICAgfSxcbiAgICAgIHNldFZvdGU6IGZ1bmN0aW9uKHZvdGUpIHtcbiAgICAgICAgdGhpcy4kdm90ZS50ZXh0Q29udGVudCA9IHZvdGVcbiAgICAgIH1cbiAgICB9KVxuICAgIC5pbml0KGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuaHRtbCA9IGA8ZGl2IGlkPVwiJHt0aGlzLmlkfVwiIGNsYXNzPVwidm90ZXJcIj5cbiAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwiZG93blwiPuKAlDwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzPVwidm90ZVwiPjA8L3NwYW4+XG4gICAgICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzcz1cInVwXCI+Kzwvc3Bhbj5cbiAgICAgICAgICAgICAgICAgICA8L2Rpdj5gXG4gICAgICBsZXQgZWxlbSA9IHRoaXMuX3JlcGxhY2VIVE1MKHRoaXMuZWxlbSlcbiAgICAgIHRoaXMuJHZvdGUgPSBlbGVtLnF1ZXJ5U2VsZWN0b3IoJy52b3RlJylcbiAgICAgIFxuICAgICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGUgPT4ge1xuICAgICAgICB0aGlzLl9oYW5kbGVDbGljayhlKVxuICAgICAgfSlcblxuICAgICAgcmV0dXJuIHRoaXNcbiAgICB9KVxuICBcblxuICBsZXQgdm90ZXIgPSBWb3Rlcih7XG4gICAgZWxlbTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZvdGVyJylcbiAgfSlcbiAgdm90ZXIuc2V0Vm90ZSgxNSlcbiAgXG5cbiAgLypcbiAgVGFzayA0OlxuICBcbiAg0KHQvtC30LTQsNC50YLQtSDRhNGD0L3QutGG0LjRji3QutC+0L3RgdGC0YDRg9C60YLQvtGAIFN0ZXBWb3RlciwgXG4gINC60L7RgtC+0YDQsNGPINC90LDRgdC70LXQtNGD0LXRgiDQvtGCINCz0L7Qu9C+0YHQvtCy0LDQu9C60LgsINGB0L7Qt9C00LDQvdC90L7QuSDQsiDQt9Cw0LTQsNGH0LUg0JPQvtC70L7RgdC+0LLQsNC70LrQsCDQsiDQv9GA0L7RgtC+0YLQuNC/0L3QvtC8INGB0YLQuNC70LUg0J7QntCfXG4gINC4INC00L7QsdCw0LLQu9GP0LXRgiDQs9C+0LvQvtGB0L7QstCw0LvQutC1INC+0L/RhtC40Y4gb3B0aW9ucy5zdGVwLCDQutC+0YLQvtGA0LDRjyDQt9Cw0LTQsNGR0YIgwqvRiNCw0LPCuyDQs9C+0LvQvtGB0LAuXG4gICovXG5cbiAgY29uc3QgU3RlcFZvdGVyID0gc3RhbXBpdCgpXG4gICAgLnByb3BzKHtcbiAgICAgIHN0ZXA6IDFcbiAgICB9KVxuICAgIC5tZXRob2RzKHtcbiAgICAgIF9oYW5kbGVDbGljazogZnVuY3Rpb24oKSB7XG4gICAgICAgIGxldCB2b3RlID0gcGFyc2VJbnQodGhpcy4kdm90ZS50ZXh0Q29udGVudClcbiAgICAgICAgbGV0IGlzVGFyZ2V0ID0gdHlwZSA9PiBlLnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnModHlwZSlcbiAgICAgICAgZGVidWdnZXJcbiAgICAgICAgaWYgKGlzVGFyZ2V0KCdkb3duJykpIHRoaXMuc2V0Vm90ZSh2b3RlICsgc3RlcClcbiAgICAgICAgZWxzZSBpZiAoaXNUYXJnZXQoJ3VwJykpIHRoaXMuc2V0Vm90ZSh2b3RlIC0gc3RlcClcbiAgICAgICAgZWxzZSByZXR1cm5cbiAgICAgIH1cbiAgICB9KVxuICAgIC5jb21wb3NlKFZvdGVyKVxuXG5cbiAgbGV0IHN0ZXBWb3RlciA9IFN0ZXBWb3Rlcih7XG4gICAgZWxlbTogZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3N0ZXAtdm90ZXInKSxcbiAgICBzdGVwOiAyNVxuICB9KVxuXG59XG50YXNrMygpIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
