'use strict';

/*
  Events

    focus - when user focuses on input / textarea /selectbox
    blur - when focus lost

    no bubbling, but can be triggered on Capturing phase
   
    focusin / focusout - same, but bubbles
      no FF support :(


  tabIndex

    control focus with `tab` order: number value
    ! any elem with tabIndex has blur / focus events !
    
    some values:
      0 - make element focused last
      -1 - ignore tab on element


*/

function example1() {

  age.onblur = function (e) {

    if (isNaN(age.value)) {
      age.classList.add('error');
      age.focus();
    } else {
      age.classList.remove('error');
    }
  };
}
example1();

/*Task 1

Реализуйте более удобный плейсхолдер-подсказку на JavaScript через атрибут data-placeholder.

Правила работы плейсхолдера:
  Элемент изначально содержит плейсхолдер. Специальный класс placeholder придает ему синий цвет.
  При фокусировке плейсхолдер показывается уже над полем, становясь «подсказкой».
  При снятии фокуса, подсказка убирается, если поле пустое – плейсхолдер возвращается в него.
*/

function task1() {
  var form = document.getElementById('placeholderWrap');
  var tip = null;
  var isContainsPlaceholder = function isContainsPlaceholder(input) {
    return input.dataset.placeholder;
  };
  var createTip = function createTip(value) {
    var tip = document.createElement('span');
    tip.classList.add('placeholder-tooltip');
    tip.innerHTML = value;
    document.body.appendChild(tip);
    return tip;
  };

  var setPlaceholderFor = function setPlaceholderFor(input) {
    input.value = input.dataset.placeholder;
  };

  document.addEventListener('DOMContentLoaded', function (e) {
    $('input[data-placeholder]').forEach(function (input) {
      setPlaceholderFor(input);
    });
  });

  form.addEventListener('focus', function (e) {
    var input = e.target;

    if (!isContainsPlaceholder(input)) return false;
    input.value = '';
    tip = createTip(input.dataset.placeholder);
    tip.style.top = input.offsetTop - tip.offsetHeight + 'px';
    tip.style.left = input.offsetLeft + 'px';
  }, true);

  form.addEventListener('blur', function (e) {
    var input = e.target;
    if (!isContainsPlaceholder(input)) return false;
    setPlaceholderFor(input);
    tip.parentElement.removeChild(tip);
  }, true);
}
task1();

/*Enlightment:
  instead of clojure `tip` you can use element.tip (custom dom property)
  useful, if you need to show 2 or more `tips`
*/

/*Task 2
 Кликните по мышонку. Затем нажимайте клавиши со стрелками, и он будет двигаться.
В этой задаче запрещается ставить обработчики куда-либо, кроме элемента #mouse.
Можно изменять атрибуты и классы в HTML.

http://plnkr.co/edit/kLh0yqbi6ircDNH4MSdW?p=preview
*/

function task2() {
  var mouse = document.getElementById('mouse');
  var directions = ['left', 'top', 'right', 'bottom'];
  var isArrow = function isArrow(type, code) {
    switch (type) {
      case 'left':
        return code === 37;
      case 'top':
        return code === 38;
      case 'right':
        return code === 39;
      case 'bottom':
        return code === 40;
      default:
        return false;
    }
  };
  var shift = function shift(elem, dir) {
    var step = arguments.length <= 2 || arguments[2] === undefined ? 25 : arguments[2];

    switch (dir) {
      case 'left':
        elem.style.left = (parseInt(elem.style.left) || 0) - step + 'px';break;
      case 'right':
        elem.style.left = (parseInt(elem.style.left) || 0) + step + 'px';break;
      case 'top':
        elem.style.top = (parseInt(elem.style.top) || 0) - step + 'px';break;
      case 'bottom':
        elem.style.top = (parseInt(elem.style.top) || 0) + step + 'px';break;
      default:
        return false;
    }
  };

  mouse.addEventListener('keydown', function (e) {
    var _this = this;

    directions.forEach(function (dir) {
      if (!isArrow(dir, e.keyCode)) return;
      shift(_this, dir);
    });
  });
}
task2();

/*Task 3

Создайте <div>, который при нажатии Ctrl+E превращается в <textarea>.
Изменения, внесенные в поле, можно сохранить обратно в <div> сочетанием клавиш Ctrl+S, при этом 
<div> получит в виде HTML содержимое <textarea>.

Если же нажать Esc, то <textarea> снова превращается в <div>, изменения не сохраняются.
*/

function task3() {
  var types = {
    static: 'div',
    editable: 'textarea'
  };
  var checkHotkey = function checkHotkey(e, key) {
    return e.keyCode === key.toUpperCase().charCodeAt(0) && e.ctrlKey;
  };
  var checkEscapeKey = function checkEscapeKey(e) {
    return e.keyCode === 27;
  };
  var cloneAs = function cloneAs(src, type) {
    var clone = document.createElement(type);
    $$(src.attributes).forEach(function (attr) {
      clone.setAttribute(attr.name, attr);
    });
    return clone;
  };

  var Editable = function Editable(content, keydownHandler, src) {
    var elem = cloneAs(src, 'textarea');
    elem.addEventListener('keydown', keydownHandler);
    elem.value = content;
    return elem;
  };

  var Static = function Static(content, keydownHandler, src) {
    var elem = cloneAs(src, 'div');
    elem.addEventListener('keydown', keydownHandler);
    elem.textContent = content;
    return elem;
  };

  $('[data-editable]').forEach(function (elem) {
    var lastSavedTxt = '';

    var handler = function handler(e) {
      var replacer = null;
      // editing static
      if (checkHotkey(e, "E") && this.tagName.toLowerCase() === types.static) {
        replacer = new Editable(this.textContent, handler, this);
      }
      // saving
      else if (checkHotkey(e, "S")) {
          lastSavedTxt = this.value;
          replacer = new Static(this.value, handler, this);
        }
        // unsaved
        else if (checkEscapeKey(e)) {
            replacer = new Static(lastSavedTxt, handler, this);
          }
          // ignore other keys
          else {
              return;
            }

      this.parentElement.replaceChild(replacer, this);
      replacer.focus();
    };

    elem.addEventListener('keydown', handler);
  });
}
task3();

/*Task 4
Сделать ячейки таблицы td редактируемыми по клику.

При клике – ячейка <td> превращается в редактируемую, можно менять HTML.

Размеры ячеек при этом не должны меняться.
В один момент может редактироваться одна ячейка.

При редактировании под ячейкой появляются кнопки для приема и отмена редактирования,
только клик на них заканчивает редактирование.

*/

function task4() {
  var Editable = function Editable(origin) {
    this.parent = origin;
    this.area = document.createElement('textarea');
    this.area.classList.add('cell-editable');
    this.area.value = origin.innerHTML;
  };
  Editable.prototype.destroy = function () {
    this.parent.removeChild(this.area);
    this.parent.removeChild(this.controls);
    return this;
  };
  Editable.prototype.init = function () {
    this.parent.appendChild(this.area);
    this.parent.appendChild(this.controls);
    this.area.focus();
    return this;
  };
  Editable.prototype.createControls = function (controlsTemplate) {
    var _this2 = this;

    this.controls = document.createElement('div');
    this.controls.classList.add('editable-control-wrap');

    controlsTemplate.forEach(function (control) {
      var btn = document.createElement('button');
      btn.classList.add('editable-control');
      btn.textContent = control.name;
      btn.onclick = control.handler;
      _this2.controls.appendChild(btn);
    });
    return this;
  };

  var isEditing = false;
  var table = document.getElementById('bagua-table');

  table.addEventListener('click', function (e) {
    var cell = e.target;

    if (isEditing || cell.tagName !== 'TD') return;

    isEditing = true;
    var lastSavedContent = cell.innerHTML;
    var editable = new Editable(cell);

    editable.createControls([{
      name: 'Save',
      handler: function handler(e) {
        editable.destroy();
        isEditing = false;
        cell.innerHTML = editable.area.value;
      }
    }, {
      name: 'Cancel',
      handler: function handler(e) {
        editable.destroy();
        isEditing = false;
        cell.innerHTML = lastSavedContent;
      }
    }]).init();
  });
}
task4();

/*Task 5
  Создайте для <input type="password"> красивый, стилизованный плейсхолдер, например (кликните на тексте):
  
  Пропустил: task1 аналогичный, только сложнее
*/

/*Task 6
  Создайте поле, которое будет предупреждать пользователя, если включен CapsLock. Выключение CapsLock уберёт предупреждение.

*/

function task6() {
  var Alert = function Alert(text) {
    var alert = document.createElement('span');
    alert.classList.add('error-alert');
    alert.textContent = text;
    return alert;
  };
  var capsLockCode = 20;

  $('[data-capslock-detect]').forEach(function (input) {
    var alert = null;

    input.onkeydown = function (e) {
      if (e.keyCode !== capsLockCode) return;
      alert = new Alert('Capslock enabled!');
      this.parentElement.appendChild(alert);
    };

    input.onkeyup = function (e) {
      if (e.keyCode !== capsLockCode || !alert) return;
      this.parentElement.removeChild(alert);
    };

    input.onblur = function (e) {
      if (!alert) return;
      this.parentElement.removeChild(alert);
    };

    input.onfocus = function (e) {
      var kv = new KeyboardEvent('keydown', {
        keyCode: capsLockCode
      });
      var ku = new KeyboardEvent('keyup');

      this.dispatchEvent(kv);
      this.dispatchEvent(ku);
    };
  });
}
task6();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAyLmZvY3VzX2JsdXJfZXZlbnRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0JBLFNBQVMsUUFBUSxHQUFJOztBQUVuQixLQUFHLENBQUMsTUFBTSxHQUFHLFVBQUMsQ0FBQyxFQUFLOztBQUVsQixRQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDcEIsU0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUE7QUFDMUIsU0FBRyxDQUFDLEtBQUssRUFBRSxDQUFBO0tBQ1osTUFDSTtBQUNKLFNBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0tBQzdCO0dBQ0YsQ0FBQTtDQUdGO0FBQ0QsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7QUFBQSxBQWNWLFNBQVMsS0FBSyxHQUFJO0FBQ2hCLE1BQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtBQUNyRCxNQUFJLEdBQUcsR0FBRyxJQUFJLENBQUE7QUFDZCxNQUFJLHFCQUFxQixHQUFHLFNBQXhCLHFCQUFxQixDQUFHLEtBQUs7V0FBSSxLQUFLLENBQUMsT0FBTyxDQUFDLFdBQVc7R0FBQSxDQUFBO0FBQzlELE1BQUksU0FBUyxHQUFHLFNBQVosU0FBUyxDQUFJLEtBQUssRUFBSztBQUN6QixRQUFJLEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQ3hDLE9BQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUE7QUFDeEMsT0FBRyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUE7QUFDckIsWUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDOUIsV0FBTyxHQUFHLENBQUE7R0FDWCxDQUFBOztBQUVELE1BQUksaUJBQWlCLEdBQUcsU0FBcEIs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LFNBQUssQ0FBQyxNQUFNLEdBQUcsVUFBUyxDQUFDLEVBQUU7QUFDekIsVUFBSSxDQUFDLEtBQUssRUFBRSxPQUFNO0FBQ2xCLFVBQUksQ0FBQyxhQUFhLENBQUMsV0FBVyxDQUFDLEtBQUssQ0FBQyxDQUFBO0tBQ3RDLENBQUE7O0FBRUQsU0FBSyxDQUFDLE9BQU8sR0FBRyxVQUFTLENBQUMsRUFBRTtBQUMxQixVQUFJLEVBQUUsR0FBRyxJQUFJLGFBQWEsQ0FBQyxTQUFTLEVBQUU7QUFDcEMsZUFBTyxFQUFFLFlBQVk7T0FDdEIsQ0FBQyxDQUFBO0FBQ0YsVUFBSSxFQUFFLEdBQUcsSUFBSSxhQUFhLENBQUMsT0FBTyxDQUFDLENBQUE7O0FBRW5DLFVBQUksQ0FBQyxhQUFhLENBQUMsRUFBRSxDQUFDLENBQUE7QUFDdEIsVUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQTtLQUN2QixDQUFBO0dBQ0YsQ0FBQyxDQUFBO0NBRUg7QUFDRCxLQUFLLEVBQUUsQ0FBQSIsImZpbGUiOiJwYXJ0Mi9mb3Jtcy8wMi5mb2N1c19ibHVyX2V2ZW50cy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gIEV2ZW50c1xuXG4gICAgZm9jdXMgLSB3aGVuIHVzZXIgZm9jdXNlcyBvbiBpbnB1dCAvIHRleHRhcmVhIC9zZWxlY3Rib3hcbiAgICBibHVyIC0gd2hlbiBmb2N1cyBsb3N0XG5cbiAgICBubyBidWJibGluZywgYnV0IGNhbiBiZSB0cmlnZ2VyZWQgb24gQ2FwdHVyaW5nIHBoYXNlXG4gICBcbiAgICBmb2N1c2luIC8gZm9jdXNvdXQgLSBzYW1lLCBidXQgYnViYmxlc1xuICAgICAgbm8gRkYgc3VwcG9ydCA6KFxuXG5cbiAgdGFiSW5kZXhcblxuICAgIGNvbnRyb2wgZm9jdXMgd2l0aCBgdGFiYCBvcmRlcjogbnVtYmVyIHZhbHVlXG4gICAgISBhbnkgZWxlbSB3aXRoIHRhYkluZGV4IGhhcyBibHVyIC8gZm9jdXMgZXZlbnRzICFcbiAgICBcbiAgICBzb21lIHZhbHVlczpcbiAgICAgIDAgLSBtYWtlIGVsZW1lbnQgZm9jdXNlZCBsYXN0XG4gICAgICAtMSAtIGlnbm9yZSB0YWIgb24gZWxlbWVudFxuXG5cbiovXG5cbmZ1bmN0aW9uIGV4YW1wbGUxICgpIHtcbiAgXG4gIGFnZS5vbmJsdXIgPSAoZSkgPT4ge1xuXG4gICAgaWYgKGlzTmFOKGFnZS52YWx1ZSkpIHtcbiAgICAgIGFnZS5jbGFzc0xpc3QuYWRkKCdlcnJvcicpXG4gICAgICBhZ2UuZm9jdXMoKVxuICAgIH0gXG4gICAgZWxzZSB7XG4gICAgIGFnZS5jbGFzc0xpc3QucmVtb3ZlKCdlcnJvcicpXG4gICAgfVxuICB9XG5cblxufVxuZXhhbXBsZTEoKVxuXG5cblxuLypUYXNrIDFcblxu0KDQtdCw0LvQuNC30YPQudGC0LUg0LHQvtC70LXQtSDRg9C00L7QsdC90YvQuSDQv9C70LXQudGB0YXQvtC70LTQtdGALdC/0L7QtNGB0LrQsNC30LrRgyDQvdCwIEphdmFTY3JpcHQg0YfQtdGA0LXQtyDQsNGC0YDQuNCx0YPRgiBkYXRhLXBsYWNlaG9sZGVyLlxuXG7Qn9GA0LDQstC40LvQsCDRgNCw0LHQvtGC0Ysg0L/Qu9C10LnRgdGF0L7Qu9C00LXRgNCwOlxuICDQrdC70LXQvNC10L3RgiDQuNC30L3QsNGH0LDQu9GM0L3QviDRgdC+0LTQtdGA0LbQuNGCINC/0LvQtdC50YHRhdC+0LvQtNC10YAuINCh0L/QtdGG0LjQsNC70YzQvdGL0Lkg0LrQu9Cw0YHRgSBwbGFjZWhvbGRlciDQv9GA0LjQtNCw0LXRgiDQtdC80YMg0YHQuNC90LjQuSDRhtCy0LXRgi5cbiAg0J/RgNC4INGE0L7QutGD0YHQuNGA0L7QstC60LUg0L/Qu9C10LnRgdGF0L7Qu9C00LXRgCDQv9C+0LrQsNC30YvQstCw0LXRgtGB0Y8g0YPQttC1INC90LDQtCDQv9C+0LvQtdC8LCDRgdGC0LDQvdC+0LLRj9GB0YwgwqvQv9C+0LTRgdC60LDQt9C60L7QucK7LlxuICDQn9GA0Lgg0YHQvdGP0YLQuNC4INGE0L7QutGD0YHQsCwg0L/QvtC00YHQutCw0LfQutCwINGD0LHQuNGA0LDQtdGC0YHRjywg0LXRgdC70Lgg0L/QvtC70LUg0L/Rg9GB0YLQvtC1IOKAkyDQv9C70LXQudGB0YXQvtC70LTQtdGAINCy0L7Qt9Cy0YDQsNGJ0LDQtdGC0YHRjyDQsiDQvdC10LPQvi5cbiovXG5cbmZ1bmN0aW9uIHRhc2sxICgpIHtcbiAgbGV0IGZvcm0gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxhY2Vob2xkZXJXcmFwJylcbiAgbGV0IHRpcCA9IG51bGxcbiAgbGV0IGlzQ29udGFpbnNQbGFjZWhvbGRlciA9IGlucHV0ID0+IGlucHV0LmRhdGFzZXQucGxhY2Vob2xkZXJcbiAgbGV0IGNyZWF0ZVRpcCA9ICh2YWx1ZSkgPT4ge1xuICAgIGxldCB0aXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzcGFuJylcbiAgICB0aXAuY2xhc3NMaXN0LmFkZCgncGxhY2Vob2xkZXItdG9vbHRpcCcpXG4gICAgdGlwLmlubmVySFRNTCA9IHZhbHVlXG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aXApXG4gICAgcmV0dXJuIHRpcFxuICB9XG5cbiAgbGV0IHNldFBsYWNlaG9sZGVyRm9yID0gaW5wdXQgPT4ge1xuICAgIGlucHV0LnZhbHVlID0gaW5wdXQuZGF0YXNldC5wbGFjZWhvbGRlclxuICB9XG4gIFxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgKGUpID0+IHtcbiAgICAkKCdpbnB1dFtkYXRhLXBsYWNlaG9sZGVyXScpLmZvckVhY2goaW5wdXQgPT4ge1xuICAgICAgc2V0UGxhY2Vob2xkZXJGb3IoaW5wdXQpXG4gICAgfSlcbiAgfSlcblxuICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ2ZvY3VzJywgZSA9PiB7XG4gICAgbGV0IGlucHV0ID0gZS50YXJnZXRcblxuICAgIGlmICghaXNDb250YWluc1BsYWNlaG9sZGVyKGlucHV0KSkgcmV0dXJuIGZhbHNlXG4gICAgaW5wdXQudmFsdWUgPSAnJ1xuICAgIHRpcCA9IGNyZWF0ZVRpcChpbnB1dC5kYXRhc2V0LnBsYWNlaG9sZGVyKVxuICAgIHRpcC5zdHlsZS50b3AgPSBpbnB1dC5vZmZzZXRUb3AgLSB0aXAub2Zmc2V0SGVpZ2h0ICsgJ3B4J1xuICAgIHRpcC5zdHlsZS5sZWZ0ID0gaW5wdXQub2Zmc2V0TGVmdCArICdweCdcbiAgfSwgdHJ1ZSlcblxuICBmb3JtLmFkZEV2ZW50TGlzdGVuZXIoJ2JsdXInLCBlID0+IHtcbiAgICBsZXQgaW5wdXQgPSBlLnRhcmdldFxuICAgIGlmICghaXNDb250YWluc1BsYWNlaG9sZGVyKGlucHV0KSkgcmV0dXJuIGZhbHNlXG4gICAgc2V0UGxhY2Vob2xkZXJGb3IoaW5wdXQpXG4gICAgdGlwLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQodGlwKVxuICB9LCB0cnVlKVxufVxudGFzazEoKVxuXG4vKkVubGlnaHRtZW50OlxuICBpbnN0ZWFkIG9mIGNsb2p1cmUgYHRpcGAgeW91IGNhbiB1c2UgZWxlbWVudC50aXAgKGN1c3RvbSBkb20gcHJvcGVydHkpXG4gIHVzZWZ1bCwgaWYgeW91IG5lZWQgdG8gc2hvdyAyIG9yIG1vcmUgYHRpcHNgXG4qL1xuXG5cblxuXG4vKlRhc2sgMlxuINCa0LvQuNC60L3QuNGC0LUg0L/QviDQvNGL0YjQvtC90LrRgy4g0JfQsNGC0LXQvCDQvdCw0LbQuNC80LDQudGC0LUg0LrQu9Cw0LLQuNGI0Lgg0YHQviDRgdGC0YDQtdC70LrQsNC80LgsINC4INC+0L0g0LHRg9C00LXRgiDQtNCy0LjQs9Cw0YLRjNGB0Y8uXG7QkiDRjdGC0L7QuSDQt9Cw0LTQsNGH0LUg0LfQsNC/0YDQtdGJ0LDQtdGC0YHRjyDRgdGC0LDQstC40YLRjCDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INC60YPQtNCwLdC70LjQsdC+LCDQutGA0L7QvNC1INGN0LvQtdC80LXQvdGC0LAgI21vdXNlLlxu0JzQvtC20L3QviDQuNC30LzQtdC90Y/RgtGMINCw0YLRgNC40LHRg9GC0Ysg0Lgg0LrQu9Cw0YHRgdGLINCyIEhUTUwuXG5cbmh0dHA6Ly9wbG5rci5jby9lZGl0L2tMaDB5cWJpNmlyY0ROSDRNU2RXP3A9cHJldmlld1xuKi9cblxuZnVuY3Rpb24gdGFzazIgKCkge1xuICBjb25zdCBtb3VzZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb3VzZScpXG4gIGNvbnN0IGRpcmVjdGlvbnMgPSBbJ2xlZnQnLCAndG9wJywgJ3JpZ2h0JywgJ2JvdHRvbSddXG4gIGNvbnN0IGlzQXJyb3cgPSAodHlwZSwgY29kZSkgPT4ge1xuICAgIHN3aXRjaCh0eXBlKXtcbiAgICAgIGNhc2UgJ2xlZnQnICAgOiByZXR1cm4gY29kZSA9PT0gMzdcbiAgICAgIGNhc2UgJ3RvcCcgICAgOiByZXR1cm4gY29kZSA9PT0gMzhcbiAgICAgIGNhc2UgJ3JpZ2h0JyAgOiByZXR1cm4gY29kZSA9PT0gMzlcbiAgICAgIGNhc2UgJ2JvdHRvbScgOiByZXR1cm4gY29kZSA9PT0gNDBcbiAgICAgIGRlZmF1bHQgICAgICAgOiByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cbiAgY29uc3Qgc2hpZnQgPSAoZWxlbSwgZGlyLCBzdGVwPTI1KSA9PiB7XG4gICAgc3dpdGNoKGRpcil7XG4gICAgICBjYXNlICdsZWZ0JyAgIDogZWxlbS5zdHlsZS5sZWZ0ID0gKHBhcnNlSW50KGVsZW0uc3R5bGUubGVmdCkgfHwgMCkgLSBzdGVwICsgJ3B4JzsgYnJlYWtcbiAgICAgIGNhc2UgJ3JpZ2h0JyAgOiBlbGVtLnN0eWxlLmxlZnQgPSAocGFyc2VJbnQoZWxlbS5zdHlsZS5sZWZ0KSB8fCAwKSArIHN0ZXAgKyAncHgnOyBicmVha1xuICAgICAgY2FzZSAndG9wJyAgICA6IGVsZW0uc3R5bGUudG9wID0gKHBhcnNlSW50KGVsZW0uc3R5bGUudG9wKSB8fCAwKSAtIHN0ZXAgKyAncHgnOyBicmVha1xuICAgICAgY2FzZSAnYm90dG9tJyA6IGVsZW0uc3R5bGUudG9wID0gKHBhcnNlSW50KGVsZW0uc3R5bGUudG9wKSB8fCAwKSArIHN0ZXAgKyAncHgnOyBicmVha1xuICAgICAgZGVmYXVsdCAgICAgICA6IHJldHVybiBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIG1vdXNlLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBmdW5jdGlvbiAoZSkge1xuICAgIGRpcmVjdGlvbnMuZm9yRWFjaChkaXIgPT4ge1xuICAgICAgaWYgKCFpc0Fycm93KGRpciwgZS5rZXlDb2RlKSkgcmV0dXJuXG4gICAgICBzaGlmdCh0aGlzLCBkaXIpXG4gICAgfSlcbiAgfSlcbn1cbnRhc2syKClcblxuXG5cblxuLypUYXNrIDNcblxu0KHQvtC30LTQsNC50YLQtSA8ZGl2Piwg0LrQvtGC0L7RgNGL0Lkg0L/RgNC4INC90LDQttCw0YLQuNC4IEN0cmwrRSDQv9GA0LXQstGA0LDRidCw0LXRgtGB0Y8g0LIgPHRleHRhcmVhPi5cbtCY0LfQvNC10L3QtdC90LjRjywg0LLQvdC10YHQtdC90L3Ri9C1INCyINC/0L7Qu9C1LCDQvNC+0LbQvdC+INGB0L7RhdGA0LDQvdC40YLRjCDQvtCx0YDQsNGC0L3QviDQsiA8ZGl2PiDRgdC+0YfQtdGC0LDQvdC40LXQvCDQutC70LDQstC40YggQ3RybCtTLCDQv9GA0Lgg0Y3RgtC+0LwgXG48ZGl2PiDQv9C+0LvRg9GH0LjRgiDQsiDQstC40LTQtSBIVE1MINGB0L7QtNC10YDQttC40LzQvtC1IDx0ZXh0YXJlYT4uXG5cbtCV0YHQu9C4INC20LUg0L3QsNC20LDRgtGMIEVzYywg0YLQviA8dGV4dGFyZWE+INGB0L3QvtCy0LAg0L/RgNC10LLRgNCw0YnQsNC10YLRgdGPINCyIDxkaXY+LCDQuNC30LzQtdC90LXQvdC40Y8g0L3QtSDRgdC+0YXRgNCw0L3Rj9GO0YLRgdGPLlxuKi9cblxuZnVuY3Rpb24gdGFzazMgKCkge1xuICBjb25zdCB0eXBlcyA9IHtcbiAgICBzdGF0aWM6ICdkaXYnLFxuICAgIGVkaXRhYmxlOiAndGV4dGFyZWEnXG4gIH1cbiAgY29uc3QgY2hlY2tIb3RrZXkgPSAoZSwga2V5KSA9PiBlLmtleUNvZGUgPT09IGtleS50b1VwcGVyQ2FzZSgpLmNoYXJDb2RlQXQoMCkgJiYgZS5jdHJsS2V5XG4gIGNvbnN0IGNoZWNrRXNjYXBlS2V5ID0gKGUpID0+IGUua2V5Q29kZSA9PT0gMjdcbiAgY29uc3QgY2xvbmVBcyA9IChzcmMsIHR5cGUpID0+IHtcbiAgICBsZXQgY2xvbmUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHR5cGUpXG4gICAgJCQoc3JjLmF0dHJpYnV0ZXMpLmZvckVhY2goYXR0ciA9PiB7XG4gICAgICBjbG9uZS5zZXRBdHRyaWJ1dGUoYXR0ci5uYW1lLCBhdHRyKVxuICAgIH0pXG4gICAgcmV0dXJuIGNsb25lXG4gIH1cblxuICBjb25zdCBFZGl0YWJsZSA9IGZ1bmN0aW9uKGNvbnRlbnQsIGtleWRvd25IYW5kbGVyLCBzcmMpIHtcbiAgICBsZXQgZWxlbSA9IGNsb25lQXMoc3JjLCAndGV4dGFyZWEnKVxuICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGtleWRvd25IYW5kbGVyKVxuICAgIGVsZW0udmFsdWUgPSBjb250ZW50XG4gICAgcmV0dXJuIGVsZW1cbiAgfVxuXG4gIGNvbnN0IFN0YXRpYyA9IGZ1bmN0aW9uIChjb250ZW50LCBrZXlkb3duSGFuZGxlciwgc3JjKSB7XG4gICAgbGV0IGVsZW0gPSBjbG9uZUFzKHNyYywgJ2RpdicpXG4gICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywga2V5ZG93bkhhbmRsZXIpXG4gICAgZWxlbS50ZXh0Q29udGVudCA9IGNvbnRlbnRcbiAgICByZXR1cm4gZWxlbVxuICB9XG5cblxuICAkKCdbZGF0YS1lZGl0YWJsZV0nKS5mb3JFYWNoKGVsZW0gPT4ge1xuICAgIGxldCBsYXN0U2F2ZWRUeHQgPSAnJ1xuXG4gICAgbGV0IGhhbmRsZXIgPSBmdW5jdGlvbiAoZSkge1xuICAgICAgbGV0IHJlcGxhY2VyID0gbnVsbFxuICAgICAgLy8gZWRpdGluZyBzdGF0aWNcbiAgICAgIGlmIChjaGVja0hvdGtleShlLCBcIkVcIikgJiYgdGhpcy50YWdOYW1lLnRvTG93ZXJDYXNlKCkgPT09IHR5cGVzLnN0YXRpYykge1xuICAgICAgICByZXBsYWNlciA9IG5ldyBFZGl0YWJsZSh0aGlzLnRleHRDb250ZW50LCBoYW5kbGVyLCB0aGlzKVxuICAgICAgfVxuICAgICAgLy8gc2F2aW5nXG4gICAgICBlbHNlIGlmIChjaGVja0hvdGtleShlLCBcIlNcIikpIHtcbiAgICAgICAgbGFzdFNhdmVkVHh0ID0gdGhpcy52YWx1ZVxuICAgICAgICByZXBsYWNlciA9IG5ldyBTdGF0aWModGhpcy52YWx1ZSwgaGFuZGxlciwgdGhpcylcbiAgICAgIH1cbiAgICAgIC8vIHVuc2F2ZWRcbiAgICAgIGVsc2UgaWYgKGNoZWNrRXNjYXBlS2V5KGUpKSB7XG4gICAgICAgIHJlcGxhY2VyID0gbmV3IFN0YXRpYyhsYXN0U2F2ZWRUeHQsIGhhbmRsZXIsIHRoaXMpXG4gICAgICB9XG4gICAgICAvLyBpZ25vcmUgb3RoZXIga2V5c1xuICAgICAgZWxzZSB7cmV0dXJufVxuXG4gICAgICB0aGlzLnBhcmVudEVsZW1lbnQucmVwbGFjZUNoaWxkKHJlcGxhY2VyLCB0aGlzKVxuICAgICAgcmVwbGFjZXIuZm9jdXMoKVxuICAgIH1cblxuICAgIGVsZW0uYWRkRXZlbnRMaXN0ZW5lcigna2V5ZG93bicsIGhhbmRsZXIpXG4gIH0pXG5cbn1cbnRhc2szKClcblxuXG5cblxuLypUYXNrIDRcbtCh0LTQtdC70LDRgtGMINGP0YfQtdC50LrQuCDRgtCw0LHQu9C40YbRiyB0ZCDRgNC10LTQsNC60YLQuNGA0YPQtdC80YvQvNC4INC/0L4g0LrQu9C40LrRgy5cblxu0J/RgNC4INC60LvQuNC60LUg4oCTINGP0YfQtdC50LrQsCA8dGQ+INC/0YDQtdCy0YDQsNGJ0LDQtdGC0YHRjyDQsiDRgNC10LTQsNC60YLQuNGA0YPQtdC80YPRjiwg0LzQvtC20L3QviDQvNC10L3Rj9GC0YwgSFRNTC5cblxu0KDQsNC30LzQtdGA0Ysg0Y/Rh9C10LXQuiDQv9GA0Lgg0Y3RgtC+0Lwg0L3QtSDQtNC+0LvQttC90Ysg0LzQtdC90Y/RgtGM0YHRjy5cbtCSINC+0LTQuNC9INC80L7QvNC10L3RgiDQvNC+0LbQtdGCINGA0LXQtNCw0LrRgtC40YDQvtCy0LDRgtGM0YHRjyDQvtC00L3QsCDRj9GH0LXQudC60LAuXG5cbtCf0YDQuCDRgNC10LTQsNC60YLQuNGA0L7QstCw0L3QuNC4INC/0L7QtCDRj9GH0LXQudC60L7QuSDQv9C+0Y/QstC70Y/RjtGC0YHRjyDQutC90L7Qv9C60Lgg0LTQu9GPINC/0YDQuNC10LzQsCDQuCDQvtGC0LzQtdC90LAg0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjRjyxcbtGC0L7Qu9GM0LrQviDQutC70LjQuiDQvdCwINC90LjRhSDQt9Cw0LrQsNC90YfQuNCy0LDQtdGCINGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40LUuXG5cbiovXG5cbmZ1bmN0aW9uIHRhc2s0ICgpIHtcbiAgY29uc3QgRWRpdGFibGUgPSBmdW5jdGlvbihvcmlnaW4pIHtcbiAgICB0aGlzLnBhcmVudCA9IG9yaWdpblxuICAgIHRoaXMuYXJlYSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RleHRhcmVhJylcbiAgICB0aGlzLmFyZWEuY2xhc3NMaXN0LmFkZCgnY2VsbC1lZGl0YWJsZScpXG4gICAgdGhpcy5hcmVhLnZhbHVlID0gb3JpZ2luLmlubmVySFRNTFxuICB9XG4gIEVkaXRhYmxlLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xuICAgIHRoaXMucGFyZW50LnJlbW92ZUNoaWxkKHRoaXMuYXJlYSlcbiAgICB0aGlzLnBhcmVudC5yZW1vdmVDaGlsZCh0aGlzLmNvbnRyb2xzKVxuICAgIHJldHVybiB0aGlzXG4gIH1cbiAgRWRpdGFibGUucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5wYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5hcmVhKVxuICAgIHRoaXMucGFyZW50LmFwcGVuZENoaWxkKHRoaXMuY29udHJvbHMpXG4gICAgdGhpcy5hcmVhLmZvY3VzKClcbiAgICByZXR1cm4gdGhpc1xuICB9XG4gIEVkaXRhYmxlLnByb3RvdHlwZS5jcmVhdGVDb250cm9scyA9IGZ1bmN0aW9uKGNvbnRyb2xzVGVtcGxhdGUpIHtcbiAgICB0aGlzLmNvbnRyb2xzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2JylcbiAgICB0aGlzLmNvbnRyb2xzLmNsYXNzTGlzdC5hZGQoJ2VkaXRhYmxlLWNvbnRyb2wtd3JhcCcpXG4gICAgXG4gICAgY29udHJvbHNUZW1wbGF0ZS5mb3JFYWNoKGNvbnRyb2wgPT4ge1xuICAgICAgbGV0IGJ0biA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2J1dHRvbicpXG4gICAgICBidG4uY2xhc3NMaXN0LmFkZCgnZWRpdGFibGUtY29udHJvbCcpXG4gICAgICBidG4udGV4dENvbnRlbnQgPSBjb250cm9sLm5hbWVcbiAgICAgIGJ0bi5vbmNsaWNrID0gY29udHJvbC5oYW5kbGVyXG4gICAgICB0aGlzLmNvbnRyb2xzLmFwcGVuZENoaWxkKGJ0bilcbiAgICB9KVxuICAgIHJldHVybiB0aGlzXG4gIH1cblxuICBsZXQgaXNFZGl0aW5nID0gZmFsc2VcbiAgY29uc3QgdGFibGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYmFndWEtdGFibGUnKVxuXG4gIHRhYmxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZSA9PiB7XG4gICAgbGV0IGNlbGwgPSBlLnRhcmdldFxuXG4gICAgaWYgKGlzRWRpdGluZyB8fCBjZWxsLnRhZ05hbWUgIT09ICdURCcpIHJldHVybjtcblxuICAgIGlzRWRpdGluZyA9IHRydWVcbiAgICBsZXQgbGFzdFNhdmVkQ29udGVudCA9IGNlbGwuaW5uZXJIVE1MXG4gICAgbGV0IGVkaXRhYmxlID0gbmV3IEVkaXRhYmxlKGNlbGwpXG5cbiAgICBlZGl0YWJsZVxuICAgICAgLmNyZWF0ZUNvbnRyb2xzKFtcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdTYXZlJyxcbiAgICAgICAgICBoYW5kbGVyOiBlID0+IHtcbiAgICAgICAgICAgIGVkaXRhYmxlLmRlc3Ryb3koKVxuICAgICAgICAgICAgaXNFZGl0aW5nID0gZmFsc2VcbiAgICAgICAgICAgIGNlbGwuaW5uZXJIVE1MID0gZWRpdGFibGUuYXJlYS52YWx1ZVxuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIG5hbWU6ICdDYW5jZWwnLFxuICAgICAgICAgIGhhbmRsZXI6IGUgPT4ge1xuICAgICAgICAgICAgZWRpdGFibGUuZGVzdHJveSgpXG4gICAgICAgICAgICBpc0VkaXRpbmcgPSBmYWxzZVxuICAgICAgICAgICAgY2VsbC5pbm5lckhUTUwgPSBsYXN0U2F2ZWRDb250ZW50XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICBdKVxuICAgICAgLmluaXQoKVxuICB9KVxuICAgIFxufVxudGFzazQoKVxuXG5cblxuLypUYXNrIDVcbiAg0KHQvtC30LTQsNC50YLQtSDQtNC70Y8gPGlucHV0IHR5cGU9XCJwYXNzd29yZFwiPiDQutGA0LDRgdC40LLRi9C5LCDRgdGC0LjQu9C40LfQvtCy0LDQvdC90YvQuSDQv9C70LXQudGB0YXQvtC70LTQtdGALCDQvdCw0L/RgNC40LzQtdGAICjQutC70LjQutC90LjRgtC1INC90LAg0YLQtdC60YHRgtC1KTpcbiAgXG4gINCf0YDQvtC/0YPRgdGC0LjQuzogdGFzazEg0LDQvdCw0LvQvtCz0LjRh9C90YvQuSwg0YLQvtC70YzQutC+INGB0LvQvtC20L3QtdC1XG4qL1xuXG5cblxuXG4vKlRhc2sgNlxuICDQodC+0LfQtNCw0LnRgtC1INC/0L7Qu9C1LCDQutC+0YLQvtGA0L7QtSDQsdGD0LTQtdGCINC/0YDQtdC00YPQv9GA0LXQttC00LDRgtGMINC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjywg0LXRgdC70Lgg0LLQutC70Y7Rh9C10L0gQ2Fwc0xvY2suINCS0YvQutC70Y7Rh9C10L3QuNC1IENhcHNMb2NrINGD0LHQtdGA0ZHRgiDQv9GA0LXQtNGD0L/RgNC10LbQtNC10L3QuNC1LlxuXG4qL1xuXG5mdW5jdGlvbiB0YXNrNiAoKSB7XG4gIGxldCBBbGVydCA9IGZ1bmN0aW9uICh0ZXh0KSB7XG4gICAgbGV0IGFsZXJ0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpXG4gICAgYWxlcnQuY2xhc3NMaXN0LmFkZCgnZXJyb3ItYWxlcnQnKVxuICAgIGFsZXJ0LnRleHRDb250ZW50ID0gdGV4dFxuICAgIHJldHVybiBhbGVydFxuICB9XG4gIGNvbnN0IGNhcHNMb2NrQ29kZSA9IDIwXG4gIFxuICAkKCdbZGF0YS1jYXBzbG9jay1kZXRlY3RdJykuZm9yRWFjaChpbnB1dCA9PiB7XG4gICAgbGV0IGFsZXJ0ID0gbnVsbFxuICAgIFxuICAgIGlucHV0Lm9ua2V5ZG93biA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBpZiAoZS5rZXlDb2RlICE9PSBjYXBzTG9ja0NvZGUpIHJldHVyblxuICAgICAgYWxlcnQgPSBuZXcgQWxlcnQoJ0NhcHNsb2NrIGVuYWJsZWQhJylcbiAgICAgIHRoaXMucGFyZW50RWxlbWVudC5hcHBlbmRDaGlsZChhbGVydClcbiAgICB9XG5cbiAgICBpbnB1dC5vbmtleXVwID0gZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKGUua2V5Q29kZSAhPT0gY2Fwc0xvY2tDb2RlIHx8ICFhbGVydCkgcmV0dXJuXG4gICAgICB0aGlzLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoYWxlcnQpXG4gICAgfVxuXG4gICAgaW5wdXQub25ibHVyID0gZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKCFhbGVydCkgcmV0dXJuXG4gICAgICB0aGlzLnBhcmVudEVsZW1lbnQucmVtb3ZlQ2hpbGQoYWxlcnQpXG4gICAgfVxuXG4gICAgaW5wdXQub25mb2N1cyA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgIGxldCBrdiA9IG5ldyBLZXlib2FyZEV2ZW50KCdrZXlkb3duJywge1xuICAgICAgICBrZXlDb2RlOiBjYXBzTG9ja0NvZGVcbiAgICAgIH0pXG4gICAgICBsZXQga3UgPSBuZXcgS2V5Ym9hcmRFdmVudCgna2V5dXAnKVxuICAgICAgXG4gICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoa3YpXG4gICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoa3UpXG4gICAgfVxuICB9KVxuXG59XG50YXNrNigpXG5cblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
