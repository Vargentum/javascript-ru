'use strict';

/*
  Events

    focus - when user focuses on input / textarea /selectbox
    blur - when focus lost

    no bubbling, but can be triggered on Capturing phase
   
    focusin / focusout - same, but bubbles
      no FF support :(


  tabIndex

    control focus with `tab` order: number value
    ! any elem with tabIndex has blur / focus events !
    
    some values:
      0 - make element focused last
      -1 - ignore tab on element


*/

function example1() {

  age.onblur = function (e) {

    if (isNaN(age.value)) {
      age.classList.add('error');
      age.focus();
    } else {
      age.classList.remove('error');
    }
  };
}
example1();

/*Task 1

Реализуйте более удобный плейсхолдер-подсказку на JavaScript через атрибут data-placeholder.

Правила работы плейсхолдера:
  Элемент изначально содержит плейсхолдер. Специальный класс placeholder придает ему синий цвет.
  При фокусировке плейсхолдер показывается уже над полем, становясь «подсказкой».
  При снятии фокуса, подсказка убирается, если поле пустое – плейсхолдер возвращается в него.
*/

function task1() {
  var form = document.getElementById('placeholderWrap');
  var tip = null;
  var isContainsPlaceholder = function isContainsPlaceholder(input) {
    return input.dataset.placeholder;
  };
  var createTip = function createTip(value) {
    var tip = document.createElement('span');
    tip.classList.add('placeholder-tooltip');
    tip.innerHTML = value;
    document.body.appendChild(tip);
    return tip;
  };

  var setPlaceholderFor = function setPlaceholderFor(input) {
    input.value = input.dataset.placeholder;
  };

  document.addEventListener('DOMContentLoaded', function (e) {
    $('input[data-placeholder]').forEach(function (input) {
      setPlaceholderFor(input);
    });
  });

  form.addEventListener('focus', function (e) {
    var input = e.target;

    if (!isContainsPlaceholder(input)) return false;
    input.value = '';
    tip = createTip(input.dataset.placeholder);
    tip.style.top = input.offsetTop - tip.offsetHeight + 'px';
    tip.style.left = input.offsetLeft + 'px';
  }, true);

  form.addEventListener('blur', function (e) {
    var input = e.target;
    if (!isContainsPlaceholder(input)) return false;
    setPlaceholderFor(input);
    tip.parentElement.removeChild(tip);
  }, true);
}
task1();

/*Enlightment:
  instead of clojure `tip` you can use element.tip (custom dom property)
  useful, if you need to show 2 or more `tips`
*/

/*Task 2
 Кликните по мышонку. Затем нажимайте клавиши со стрелками, и он будет двигаться.
В этой задаче запрещается ставить обработчики куда-либо, кроме элемента #mouse.
Можно изменять атрибуты и классы в HTML.

http://plnkr.co/edit/kLh0yqbi6ircDNH4MSdW?p=preview
*/

function task2() {
  var mouse = document.getElementById('mouse');
  var directions = ['left', 'top', 'right', 'bottom'];
  var isArrow = function isArrow(type, code) {
    switch (type) {
      case 'left':
        return code === 37;
      case 'top':
        return code === 38;
      case 'right':
        return code === 39;
      case 'bottom':
        return code === 40;
      default:
        return false;
    }
  };
  var shift = function shift(elem, dir) {
    var step = arguments.length <= 2 || arguments[2] === undefined ? 25 : arguments[2];

    switch (dir) {
      case 'left':
        elem.style.left = (parseInt(elem.style.left) || 0) - step + 'px';break;
      case 'right':
        elem.style.left = (parseInt(elem.style.left) || 0) + step + 'px';break;
      case 'top':
        elem.style.top = (parseInt(elem.style.top) || 0) - step + 'px';break;
      case 'bottom':
        elem.style.top = (parseInt(elem.style.top) || 0) + step + 'px';break;
      default:
        return false;
    }
  };

  mouse.addEventListener('keydown', function (e) {
    var _this = this;

    directions.forEach(function (dir) {
      if (!isArrow(dir, e.keyCode)) return;
      shift(_this, dir);
    });
  });
}
task2();

/*Task 3

Создайте <div>, который при нажатии Ctrl+E превращается в <textarea>.
Изменения, внесенные в поле, можно сохранить обратно в <div> сочетанием клавиш Ctrl+S, при этом 
<div> получит в виде HTML содержимое <textarea>.

Если же нажать Esc, то <textarea> снова превращается в <div>, изменения не сохраняются.
*/

function task3() {

  var checkHotkey = function checkHotkey(e, key) {
    return e.keyCode === key.toUpperCase().charCodeAt(0) && e.ctrlKey;
  };
  var checkEscapeKey = function checkEscapeKey(e) {
    return e.keyCode === 27;
  };

  var Editable = function Editable(type, content, keydownHandler, origin) {
    var elem = document.createElement(type);

    for (var key in origin.attributes) {
      elem.attributes[key] = origin.attributes[key];
      debugger;
    }

    if (content) {
      elem.value ? elem.value = content : elem.textContent = content;
    }
    elem.addEventListener('keydown', keydownHandler);
    return elem;
  };

  $('[data-editable]').forEach(function (elem) {

    var handler = function handler(e) {
      var editable = null;
      // editing
      if (checkHotkey(e, "E")) {
        editable = new Editable('textarea', this.textContent, handler, this);
      }
      // saving
      else if (checkHotkey(e, "S")) {
          editable = new Editable('div', this.value, handler, this);
        }
        // unsaved
        else if (checkEscapeKey(e)) {
            editable = new Editable('div', null, handler, this);
          } else {
            return;
          }
      this.parentElement.replaceChild(editable, this);
    };

    elem.addEventListener('keydown', handler);
  });
}
task3();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAyLmZvY3VzX2JsdXJfZXZlbnRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0JBLFNBQVMsUUFBUSxHQUFJOztBQUVuQixLQUFHLENBQUMsTUFBTSxHQUFHLFVBQUMsQ0FBQyxFQUFLOztBQUVsQixRQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDcEIsU0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUE7QUFDMUIsU0FBRyxDQUFDLEtBQUssRUFBRSxDQUFBO0tBQ1osTUFDSTtBQUNKLFNBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0tBQzdCO0dBQ0YsQ0FBQTtDQUdGO0FBQ0QsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7QUFBQSxBQWNWLFNBQVMsS0FBSyxHQUFJO0FBQ2hCLE1BQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtBQUNyRCxNQUFJLEdBQUcsR0FBRyxJQUFJLENBQUE7QUFDZCxNQUFJLHFCQUFxQixHQUFHLFNBQXhCLHFCQUFxQixDQUFHLEtBQUs7V0FBSSxLQUFLLENBQUMsT0FBTyxDQUFDLFdBQVc7R0FBQSxDQUFBO0FBQzlELE1BQUksU0FBUyxHQUFHLFNBQVosU0FBUyxDQUFJLEtBQUssRUFBSztBQUN6QixRQUFJLEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQ3hDLE9BQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUE7QUFDeEMsT0FBRyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUE7QUFDckIsWUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDOUIsV0FBTyxHQUFHLENBQUE7R0FDWCxDQUFBOztBQUVELE1BQUksaUJBQWlCLEdBQUcsU0FBcEIs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OztBQUMxRCxhQUVJLElBQUksY0FBYyxDQUFDLENBQUMsQ0FBQyxFQUFFO0FBQzFCLG9CQUFRLEdBQUcsSUFBSSxRQUFRLENBQUMsS0FBSyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsSUFBSSxDQUFDLENBQUE7V0FDcEQsTUFDSTtBQUFDLG1CQUFNO1dBQUM7QUFDYixVQUFJLENBQUMsYUFBYSxDQUFDLFlBQVksQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDLENBQUE7S0FDaEQsQ0FBQTs7QUFFRCxRQUFJLENBQUMsZ0JBQWdCLENBQUMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxDQUFBO0dBQzFDLENBQUMsQ0FBQTtDQUVIO0FBQ0QsS0FBSyxFQUFFLENBQUEiLCJmaWxlIjoicGFydDIvZm9ybXMvMDIuZm9jdXNfYmx1cl9ldmVudHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICBFdmVudHNcblxuICAgIGZvY3VzIC0gd2hlbiB1c2VyIGZvY3VzZXMgb24gaW5wdXQgLyB0ZXh0YXJlYSAvc2VsZWN0Ym94XG4gICAgYmx1ciAtIHdoZW4gZm9jdXMgbG9zdFxuXG4gICAgbm8gYnViYmxpbmcsIGJ1dCBjYW4gYmUgdHJpZ2dlcmVkIG9uIENhcHR1cmluZyBwaGFzZVxuICAgXG4gICAgZm9jdXNpbiAvIGZvY3Vzb3V0IC0gc2FtZSwgYnV0IGJ1YmJsZXNcbiAgICAgIG5vIEZGIHN1cHBvcnQgOihcblxuXG4gIHRhYkluZGV4XG5cbiAgICBjb250cm9sIGZvY3VzIHdpdGggYHRhYmAgb3JkZXI6IG51bWJlciB2YWx1ZVxuICAgICEgYW55IGVsZW0gd2l0aCB0YWJJbmRleCBoYXMgYmx1ciAvIGZvY3VzIGV2ZW50cyAhXG4gICAgXG4gICAgc29tZSB2YWx1ZXM6XG4gICAgICAwIC0gbWFrZSBlbGVtZW50IGZvY3VzZWQgbGFzdFxuICAgICAgLTEgLSBpZ25vcmUgdGFiIG9uIGVsZW1lbnRcblxuXG4qL1xuXG5mdW5jdGlvbiBleGFtcGxlMSAoKSB7XG4gIFxuICBhZ2Uub25ibHVyID0gKGUpID0+IHtcblxuICAgIGlmIChpc05hTihhZ2UudmFsdWUpKSB7XG4gICAgICBhZ2UuY2xhc3NMaXN0LmFkZCgnZXJyb3InKVxuICAgICAgYWdlLmZvY3VzKClcbiAgICB9IFxuICAgIGVsc2Uge1xuICAgICBhZ2UuY2xhc3NMaXN0LnJlbW92ZSgnZXJyb3InKVxuICAgIH1cbiAgfVxuXG5cbn1cbmV4YW1wbGUxKClcblxuXG5cbi8qVGFzayAxXG5cbtCg0LXQsNC70LjQt9GD0LnRgtC1INCx0L7Qu9C10LUg0YPQtNC+0LHQvdGL0Lkg0L/Qu9C10LnRgdGF0L7Qu9C00LXRgC3Qv9C+0LTRgdC60LDQt9C60YMg0L3QsCBKYXZhU2NyaXB0INGH0LXRgNC10Lcg0LDRgtGA0LjQsdGD0YIgZGF0YS1wbGFjZWhvbGRlci5cblxu0J/RgNCw0LLQuNC70LAg0YDQsNCx0L7RgtGLINC/0LvQtdC50YHRhdC+0LvQtNC10YDQsDpcbiAg0K3Qu9C10LzQtdC90YIg0LjQt9C90LDRh9Cw0LvRjNC90L4g0YHQvtC00LXRgNC20LjRgiDQv9C70LXQudGB0YXQvtC70LTQtdGALiDQodC/0LXRhtC40LDQu9GM0L3Ri9C5INC60LvQsNGB0YEgcGxhY2Vob2xkZXIg0L/RgNC40LTQsNC10YIg0LXQvNGDINGB0LjQvdC40Lkg0YbQstC10YIuXG4gINCf0YDQuCDRhNC+0LrRg9GB0LjRgNC+0LLQutC1INC/0LvQtdC50YHRhdC+0LvQtNC10YAg0L/QvtC60LDQt9GL0LLQsNC10YLRgdGPINGD0LbQtSDQvdCw0LQg0L/QvtC70LXQvCwg0YHRgtCw0L3QvtCy0Y/RgdGMIMKr0L/QvtC00YHQutCw0LfQutC+0LnCuy5cbiAg0J/RgNC4INGB0L3Rj9GC0LjQuCDRhNC+0LrRg9GB0LAsINC/0L7QtNGB0LrQsNC30LrQsCDRg9Cx0LjRgNCw0LXRgtGB0Y8sINC10YHQu9C4INC/0L7Qu9C1INC/0YPRgdGC0L7QtSDigJMg0L/Qu9C10LnRgdGF0L7Qu9C00LXRgCDQstC+0LfQstGA0LDRidCw0LXRgtGB0Y8g0LIg0L3QtdCz0L4uXG4qL1xuXG5mdW5jdGlvbiB0YXNrMSAoKSB7XG4gIGxldCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYWNlaG9sZGVyV3JhcCcpXG4gIGxldCB0aXAgPSBudWxsXG4gIGxldCBpc0NvbnRhaW5zUGxhY2Vob2xkZXIgPSBpbnB1dCA9PiBpbnB1dC5kYXRhc2V0LnBsYWNlaG9sZGVyXG4gIGxldCBjcmVhdGVUaXAgPSAodmFsdWUpID0+IHtcbiAgICBsZXQgdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpXG4gICAgdGlwLmNsYXNzTGlzdC5hZGQoJ3BsYWNlaG9sZGVyLXRvb2x0aXAnKVxuICAgIHRpcC5pbm5lckhUTUwgPSB2YWx1ZVxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGlwKVxuICAgIHJldHVybiB0aXBcbiAgfVxuXG4gIGxldCBzZXRQbGFjZWhvbGRlckZvciA9IGlucHV0ID0+IHtcbiAgICBpbnB1dC52YWx1ZSA9IGlucHV0LmRhdGFzZXQucGxhY2Vob2xkZXJcbiAgfVxuICBcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChlKSA9PiB7XG4gICAgJCgnaW5wdXRbZGF0YS1wbGFjZWhvbGRlcl0nKS5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgIHNldFBsYWNlaG9sZGVyRm9yKGlucHV0KVxuICAgIH0pXG4gIH0pXG5cbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIGUgPT4ge1xuICAgIGxldCBpbnB1dCA9IGUudGFyZ2V0XG5cbiAgICBpZiAoIWlzQ29udGFpbnNQbGFjZWhvbGRlcihpbnB1dCkpIHJldHVybiBmYWxzZVxuICAgIGlucHV0LnZhbHVlID0gJydcbiAgICB0aXAgPSBjcmVhdGVUaXAoaW5wdXQuZGF0YXNldC5wbGFjZWhvbGRlcilcbiAgICB0aXAuc3R5bGUudG9wID0gaW5wdXQub2Zmc2V0VG9wIC0gdGlwLm9mZnNldEhlaWdodCArICdweCdcbiAgICB0aXAuc3R5bGUubGVmdCA9IGlucHV0Lm9mZnNldExlZnQgKyAncHgnXG4gIH0sIHRydWUpXG5cbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZSA9PiB7XG4gICAgbGV0IGlucHV0ID0gZS50YXJnZXRcbiAgICBpZiAoIWlzQ29udGFpbnNQbGFjZWhvbGRlcihpbnB1dCkpIHJldHVybiBmYWxzZVxuICAgIHNldFBsYWNlaG9sZGVyRm9yKGlucHV0KVxuICAgIHRpcC5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRpcClcbiAgfSwgdHJ1ZSlcbn1cbnRhc2sxKClcblxuLypFbmxpZ2h0bWVudDpcbiAgaW5zdGVhZCBvZiBjbG9qdXJlIGB0aXBgIHlvdSBjYW4gdXNlIGVsZW1lbnQudGlwIChjdXN0b20gZG9tIHByb3BlcnR5KVxuICB1c2VmdWwsIGlmIHlvdSBuZWVkIHRvIHNob3cgMiBvciBtb3JlIGB0aXBzYFxuKi9cblxuXG5cblxuLypUYXNrIDJcbiDQmtC70LjQutC90LjRgtC1INC/0L4g0LzRi9GI0L7QvdC60YMuINCX0LDRgtC10Lwg0L3QsNC20LjQvNCw0LnRgtC1INC60LvQsNCy0LjRiNC4INGB0L4g0YHRgtGA0LXQu9C60LDQvNC4LCDQuCDQvtC9INCx0YPQtNC10YIg0LTQstC40LPQsNGC0YzRgdGPLlxu0JIg0Y3RgtC+0Lkg0LfQsNC00LDRh9C1INC30LDQv9GA0LXRidCw0LXRgtGB0Y8g0YHRgtCw0LLQuNGC0Ywg0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDQutGD0LTQsC3Qu9C40LHQviwg0LrRgNC+0LzQtSDRjdC70LXQvNC10L3RgtCwICNtb3VzZS5cbtCc0L7QttC90L4g0LjQt9C80LXQvdGP0YLRjCDQsNGC0YDQuNCx0YPRgtGLINC4INC60LvQsNGB0YHRiyDQsiBIVE1MLlxuXG5odHRwOi8vcGxua3IuY28vZWRpdC9rTGgweXFiaTZpcmNETkg0TVNkVz9wPXByZXZpZXdcbiovXG5cbmZ1bmN0aW9uIHRhc2syICgpIHtcbiAgY29uc3QgbW91c2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW91c2UnKVxuICBjb25zdCBkaXJlY3Rpb25zID0gWydsZWZ0JywgJ3RvcCcsICdyaWdodCcsICdib3R0b20nXVxuICBjb25zdCBpc0Fycm93ID0gKHR5cGUsIGNvZGUpID0+IHtcbiAgICBzd2l0Y2godHlwZSl7XG4gICAgICBjYXNlICdsZWZ0JyAgIDogcmV0dXJuIGNvZGUgPT09IDM3XG4gICAgICBjYXNlICd0b3AnICAgIDogcmV0dXJuIGNvZGUgPT09IDM4XG4gICAgICBjYXNlICdyaWdodCcgIDogcmV0dXJuIGNvZGUgPT09IDM5XG4gICAgICBjYXNlICdib3R0b20nIDogcmV0dXJuIGNvZGUgPT09IDQwXG4gICAgICBkZWZhdWx0ICAgICAgIDogcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9XG4gIGNvbnN0IHNoaWZ0ID0gKGVsZW0sIGRpciwgc3RlcD0yNSkgPT4ge1xuICAgIHN3aXRjaChkaXIpe1xuICAgICAgY2FzZSAnbGVmdCcgICA6IGVsZW0uc3R5bGUubGVmdCA9IChwYXJzZUludChlbGVtLnN0eWxlLmxlZnQpIHx8IDApIC0gc3RlcCArICdweCc7IGJyZWFrXG4gICAgICBjYXNlICdyaWdodCcgIDogZWxlbS5zdHlsZS5sZWZ0ID0gKHBhcnNlSW50KGVsZW0uc3R5bGUubGVmdCkgfHwgMCkgKyBzdGVwICsgJ3B4JzsgYnJlYWtcbiAgICAgIGNhc2UgJ3RvcCcgICAgOiBlbGVtLnN0eWxlLnRvcCA9IChwYXJzZUludChlbGVtLnN0eWxlLnRvcCkgfHwgMCkgLSBzdGVwICsgJ3B4JzsgYnJlYWtcbiAgICAgIGNhc2UgJ2JvdHRvbScgOiBlbGVtLnN0eWxlLnRvcCA9IChwYXJzZUludChlbGVtLnN0eWxlLnRvcCkgfHwgMCkgKyBzdGVwICsgJ3B4JzsgYnJlYWtcbiAgICAgIGRlZmF1bHQgICAgICAgOiByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cblxuICBtb3VzZS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICBkaXJlY3Rpb25zLmZvckVhY2goZGlyID0+IHtcbiAgICAgIGlmICghaXNBcnJvdyhkaXIsIGUua2V5Q29kZSkpIHJldHVyblxuICAgICAgc2hpZnQodGhpcywgZGlyKVxuICAgIH0pXG4gIH0pXG59XG50YXNrMigpXG5cblxuXG5cbi8qVGFzayAzXG5cbtCh0L7Qt9C00LDQudGC0LUgPGRpdj4sINC60L7RgtC+0YDRi9C5INC/0YDQuCDQvdCw0LbQsNGC0LjQuCBDdHJsK0Ug0L/RgNC10LLRgNCw0YnQsNC10YLRgdGPINCyIDx0ZXh0YXJlYT4uXG7QmNC30LzQtdC90LXQvdC40Y8sINCy0L3QtdGB0LXQvdC90YvQtSDQsiDQv9C+0LvQtSwg0LzQvtC20L3QviDRgdC+0YXRgNCw0L3QuNGC0Ywg0L7QsdGA0LDRgtC90L4g0LIgPGRpdj4g0YHQvtGH0LXRgtCw0L3QuNC10Lwg0LrQu9Cw0LLQuNGIIEN0cmwrUywg0L/RgNC4INGN0YLQvtC8IFxuPGRpdj4g0L/QvtC70YPRh9C40YIg0LIg0LLQuNC00LUgSFRNTCDRgdC+0LTQtdGA0LbQuNC80L7QtSA8dGV4dGFyZWE+LlxuXG7QldGB0LvQuCDQttC1INC90LDQttCw0YLRjCBFc2MsINGC0L4gPHRleHRhcmVhPiDRgdC90L7QstCwINC/0YDQtdCy0YDQsNGJ0LDQtdGC0YHRjyDQsiA8ZGl2Piwg0LjQt9C80LXQvdC10L3QuNGPINC90LUg0YHQvtGF0YDQsNC90Y/RjtGC0YHRjy5cbiovXG5cbmZ1bmN0aW9uIHRhc2szICgpIHtcblxuICBjb25zdCBjaGVja0hvdGtleSA9IChlLCBrZXkpID0+IGUua2V5Q29kZSA9PT0ga2V5LnRvVXBwZXJDYXNlKCkuY2hhckNvZGVBdCgwKSAmJiBlLmN0cmxLZXlcbiAgY29uc3QgY2hlY2tFc2NhcGVLZXkgPSAoZSkgPT4gZS5rZXlDb2RlID09PSAyN1xuXG4gIGNvbnN0IEVkaXRhYmxlID0gZnVuY3Rpb24odHlwZSwgY29udGVudCwga2V5ZG93bkhhbmRsZXIsIG9yaWdpbikge1xuICAgIGxldCBlbGVtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCh0eXBlKVxuXG4gICAgZm9yIChsZXQga2V5IGluIG9yaWdpbi5hdHRyaWJ1dGVzKSB7XG4gICAgICBlbGVtLmF0dHJpYnV0ZXNba2V5XSA9IG9yaWdpbi5hdHRyaWJ1dGVzW2tleV1cbiAgICAgIGRlYnVnZ2VyXG4gICAgfVxuXG4gICAgaWYgKGNvbnRlbnQpIHtcbiAgICAgIGVsZW0udmFsdWUgPyBlbGVtLnZhbHVlID0gY29udGVudCA6IGVsZW0udGV4dENvbnRlbnQgPSBjb250ZW50ICBcbiAgICB9XG4gICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywga2V5ZG93bkhhbmRsZXIpXG4gICAgcmV0dXJuIGVsZW1cbiAgfVxuXG4gICQoJ1tkYXRhLWVkaXRhYmxlXScpLmZvckVhY2goZWxlbSA9PiB7XG5cbiAgICBsZXQgaGFuZGxlciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBsZXQgZWRpdGFibGUgPSBudWxsXG4gICAgICAvLyBlZGl0aW5nXG4gICAgICBpZiAoY2hlY2tIb3RrZXkoZSwgXCJFXCIpKSB7XG4gICAgICAgIGVkaXRhYmxlID0gbmV3IEVkaXRhYmxlKCd0ZXh0YXJlYScsIHRoaXMudGV4dENvbnRlbnQsIGhhbmRsZXIsIHRoaXMpXG4gICAgICB9IFxuICAgICAgLy8gc2F2aW5nXG4gICAgICBlbHNlIGlmIChjaGVja0hvdGtleShlLCBcIlNcIikpIHtcbiAgICAgICAgZWRpdGFibGUgPSBuZXcgRWRpdGFibGUoJ2RpdicsIHRoaXMudmFsdWUsIGhhbmRsZXIsIHRoaXMpXG4gICAgICB9XG4gICAgICAvLyB1bnNhdmVkXG4gICAgICBlbHNlIGlmIChjaGVja0VzY2FwZUtleShlKSkge1xuICAgICAgICBlZGl0YWJsZSA9IG5ldyBFZGl0YWJsZSgnZGl2JywgbnVsbCwgaGFuZGxlciwgdGhpcylcbiAgICAgIH1cbiAgICAgIGVsc2Uge3JldHVybn1cbiAgICAgIHRoaXMucGFyZW50RWxlbWVudC5yZXBsYWNlQ2hpbGQoZWRpdGFibGUsIHRoaXMpXG4gICAgfVxuXG4gICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlcilcbiAgfSlcblxufVxudGFzazMoKVxuXG5cblxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
