'use strict';

/*
  Events

    focus - when user focuses on input / textarea /selectbox
    blur - when focus lost

    no bubbling, but can be triggered on Capturing phase
   
    focusin / focusout - same, but bubbles
      no FF support :(


  tabIndex

    control focus with `tab` order: number value
    ! any elem with tabIndex has blur / focus events !
    
    some values:
      0 - make element focused last
      -1 - ignore tab on element


*/

function example1() {

  age.onblur = function (e) {

    if (isNaN(age.value)) {
      age.classList.add('error');
      age.focus();
    } else {
      age.classList.remove('error');
    }
  };
}
example1();

/*Task 1

Реализуйте более удобный плейсхолдер-подсказку на JavaScript через атрибут data-placeholder.

Правила работы плейсхолдера:
  Элемент изначально содержит плейсхолдер. Специальный класс placeholder придает ему синий цвет.
  При фокусировке плейсхолдер показывается уже над полем, становясь «подсказкой».
  При снятии фокуса, подсказка убирается, если поле пустое – плейсхолдер возвращается в него.
*/

function task1() {
  var form = document.getElementById('placeholderWrap');
  var tip = null;
  var isContainsPlaceholder = function isContainsPlaceholder(input) {
    return input.dataset.placeholder;
  };
  var createTip = function createTip(value) {
    var tip = document.createElement('span');
    tip.classList.add('placeholder-tooltip');
    tip.innerHTML = value;
    document.body.appendChild(tip);
    return tip;
  };

  var setPlaceholderFor = function setPlaceholderFor(input) {
    input.value = input.dataset.placeholder;
  };

  document.addEventListener('DOMContentLoaded', function (e) {
    $('input[data-placeholder]').forEach(function (input) {
      setPlaceholderFor(input);
    });
  });

  form.addEventListener('focus', function (e) {
    var input = e.target;

    if (!isContainsPlaceholder(input)) return false;
    input.value = '';
    tip = createTip(input.dataset.placeholder);
    tip.style.top = input.offsetTop - tip.offsetHeight + 'px';
    tip.style.left = input.offsetLeft + 'px';
  }, true);

  form.addEventListener('blur', function (e) {
    var input = e.target;
    if (!isContainsPlaceholder(input)) return false;
    setPlaceholderFor(input);
    tip.parentElement.removeChild(tip);
  }, true);
}
task1();

/*Enlightment:
  instead of clojure `tip` you can use element.tip (custom dom property)
  useful, if you need to show 2 or more `tips`
*/

/*Task 2
 Кликните по мышонку. Затем нажимайте клавиши со стрелками, и он будет двигаться.
В этой задаче запрещается ставить обработчики куда-либо, кроме элемента #mouse.
Можно изменять атрибуты и классы в HTML.

http://plnkr.co/edit/kLh0yqbi6ircDNH4MSdW?p=preview
*/

function task2() {
  var mouse = document.getElementById('mouse');
  var directions = ['left', 'top', 'right', 'bottom'];
  var isArrow = function isArrow(type, code) {
    switch (type) {
      case 'left':
        return code === 37;
      case 'top':
        return code === 38;
      case 'right':
        return code === 39;
      case 'bottom':
        return code === 40;
      default:
        return false;
    }
  };
  var shift = function shift(elem, dir) {
    var step = arguments.length <= 2 || arguments[2] === undefined ? 25 : arguments[2];

    switch (dir) {
      case 'left':
        elem.style.left = (parseInt(elem.style.left) || 0) - step + 'px';break;
      case 'right':
        elem.style.left = (parseInt(elem.style.left) || 0) + step + 'px';break;
      case 'top':
        elem.style.top = (parseInt(elem.style.top) || 0) - step + 'px';break;
      case 'bottom':
        elem.style.top = (parseInt(elem.style.top) || 0) + step + 'px';break;
      default:
        return false;
    }
  };

  mouse.addEventListener('keydown', function (e) {
    var _this = this;

    directions.forEach(function (dir) {
      if (!isArrow(dir, e.keyCode)) return;
      shift(_this, dir);
    });
  });
}
task2();

/*Task 3

Создайте <div>, который при нажатии Ctrl+E превращается в <textarea>.
Изменения, внесенные в поле, можно сохранить обратно в <div> сочетанием клавиш Ctrl+S, при этом 
<div> получит в виде HTML содержимое <textarea>.

Если же нажать Esc, то <textarea> снова превращается в <div>, изменения не сохраняются.
*/

function task3() {
  var types = {
    static: 'div',
    editable: 'textarea'
  };

  var checkHotkey = function checkHotkey(e, key) {
    return e.keyCode === key.toUpperCase().charCodeAt(0) && e.ctrlKey;
  };
  var checkEscapeKey = function checkEscapeKey(e) {
    return e.keyCode === 27;
  };

  var Editable = function Editable(content, keydownHandler) {
    var elem = document.createElement(types.editable);

    elem.setAttribute('data-editable', '');
    elem.setAttribute('tabIndex', -1);
    elem.addEventListener('keydown', keydownHandler);
    elem.value = content;
    return elem;
  };

  var Static = function Static(content, keydownHandler) {
    var elem = document.createElement(types.static);

    elem.setAttribute('data-editable', '');
    elem.setAttribute('tabIndex', -1);
    elem.addEventListener('keydown', keydownHandler);
    elem.textContent = content;
    return elem;
  };

  $('[data-editable]').forEach(function (elem) {
    var lastSavedTxt = '';

    var handler = function handler(e) {
      var replacer = null;
      // editing static
      if (checkHotkey(e, "E") && this.tagName.toLowerCase() === types.static) {
        replacer = new Editable(this.textContent, handler);
      }
      // saving
      else if (checkHotkey(e, "S")) {
          lastSavedTxt = this.value;
          replacer = new Static(this.value, handler);
        }
        // unsaved
        else if (checkEscapeKey(e)) {
            replacer = new Static(lastSavedTxt, handler);
          }
          // ignore other keys
          else {
              return;
            }

      this.parentElement.replaceChild(replacer, this);
      replacer.focus();
    };

    elem.addEventListener('keydown', handler);
  });
}
task3();

/*Task 4
Сделать ячейки таблицы td редактируемыми по клику.

При клике – ячейка <td> превращается в редактируемую, можно менять HTML.

Размеры ячеек при этом не должны меняться.
В один момент может редактироваться одна ячейка.

При редактировании под ячейкой появляются кнопки для приема и отмена редактирования,
только клик на них заканчивает редактирование.

*/

function task4() {
  var Editable = function Editable(origin) {
    this.parent = origin;
    this.area = document.createElement('textarea');
    this.area.classList.add('cell-editable');
    this.area.value = origin.innerHTML;
  };
  Editable.prototype.destroy = function () {
    this.parent.removeChild(this.area);
    this.parent.removeChild(this.controls);
    return this;
  };
  Editable.prototype.init = function () {
    this.parent.appendChild(this.area);
    this.parent.appendChild(this.controls);
    this.area.focus();
    return this;
  };
  Editable.prototype.createControls = function (controlsTemplate) {
    var _this2 = this;

    this.controls = document.createElement('div');
    this.controls.classList.add('editable-control-wrap');

    controlsTemplate.forEach(function (control) {
      var btn = document.createElement('button');
      btn.classList.add('editable-control');
      btn.textContent = control.name;
      btn.onclick = control.handler;
      _this2.controls.appendChild(btn);
    });
    return this;
  };

  var isEditing = false;
  var table = document.getElementById('bagua-table');

  table.addEventListener('click', function (e) {
    var cell = e.target;

    if (isEditing || cell.tagName !== 'TD') return;

    isEditing = true;
    var lastSavedContent = cell.innerHTML;
    var editable = new Editable(cell);

    editable.createControls([{
      name: 'Save',
      handler: function handler(e) {
        editable.destroy();
        isEditing = false;
        cell.innerHTML = editable.area.value;
      }
    }, {
      name: 'Cancel',
      handler: function handler(e) {
        editable.destroy();
        isEditing = false;
        cell.innerHTML = lastSavedContent;
      }
    }]).init();
  });
}
task4();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAyLmZvY3VzX2JsdXJfZXZlbnRzLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBd0JBLFNBQVMsUUFBUSxHQUFJOztBQUVuQixLQUFHLENBQUMsTUFBTSxHQUFHLFVBQUMsQ0FBQyxFQUFLOztBQUVsQixRQUFJLEtBQUssQ0FBQyxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUU7QUFDcEIsU0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLENBQUE7QUFDMUIsU0FBRyxDQUFDLEtBQUssRUFBRSxDQUFBO0tBQ1osTUFDSTtBQUNKLFNBQUcsQ0FBQyxTQUFTLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0tBQzdCO0dBQ0YsQ0FBQTtDQUdGO0FBQ0QsUUFBUSxFQUFFOzs7Ozs7Ozs7Ozs7QUFBQSxBQWNWLFNBQVMsS0FBSyxHQUFJO0FBQ2hCLE1BQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxjQUFjLENBQUMsaUJBQWlCLENBQUMsQ0FBQTtBQUNyRCxNQUFJLEdBQUcsR0FBRyxJQUFJLENBQUE7QUFDZCxNQUFJLHFCQUFxQixHQUFHLFNBQXhCLHFCQUFxQixDQUFHLEtBQUs7V0FBSSxLQUFLLENBQUMsT0FBTyxDQUFDLFdBQVc7R0FBQSxDQUFBO0FBQzlELE1BQUksU0FBUyxHQUFHLFNBQVosU0FBUyxDQUFJLEtBQUssRUFBSztBQUN6QixRQUFJLEdBQUcsR0FBRyxRQUFRLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxDQUFBO0FBQ3hDLE9BQUcsQ0FBQyxTQUFTLENBQUMsR0FBRyxDQUFDLHFCQUFxQixDQUFDLENBQUE7QUFDeEMsT0FBRyxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUE7QUFDckIsWUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsR0FBRyxDQUFDLENBQUE7QUFDOUIsV0FBTyxHQUFHLENBQUE7R0FDWCxDQUFBOztBQUVELE1BQUksaUJBQWlCLEdBQUcsU0FBcEIs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QUMsQ0FDRCxJQUFJLEVBQUUsQ0FBQTtHQUNWLENBQUMsQ0FBQTtDQUVIO0FBQ0QsS0FBSyxFQUFFLENBQUEiLCJmaWxlIjoicGFydDIvZm9ybXMvMDIuZm9jdXNfYmx1cl9ldmVudHMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuICBFdmVudHNcblxuICAgIGZvY3VzIC0gd2hlbiB1c2VyIGZvY3VzZXMgb24gaW5wdXQgLyB0ZXh0YXJlYSAvc2VsZWN0Ym94XG4gICAgYmx1ciAtIHdoZW4gZm9jdXMgbG9zdFxuXG4gICAgbm8gYnViYmxpbmcsIGJ1dCBjYW4gYmUgdHJpZ2dlcmVkIG9uIENhcHR1cmluZyBwaGFzZVxuICAgXG4gICAgZm9jdXNpbiAvIGZvY3Vzb3V0IC0gc2FtZSwgYnV0IGJ1YmJsZXNcbiAgICAgIG5vIEZGIHN1cHBvcnQgOihcblxuXG4gIHRhYkluZGV4XG5cbiAgICBjb250cm9sIGZvY3VzIHdpdGggYHRhYmAgb3JkZXI6IG51bWJlciB2YWx1ZVxuICAgICEgYW55IGVsZW0gd2l0aCB0YWJJbmRleCBoYXMgYmx1ciAvIGZvY3VzIGV2ZW50cyAhXG4gICAgXG4gICAgc29tZSB2YWx1ZXM6XG4gICAgICAwIC0gbWFrZSBlbGVtZW50IGZvY3VzZWQgbGFzdFxuICAgICAgLTEgLSBpZ25vcmUgdGFiIG9uIGVsZW1lbnRcblxuXG4qL1xuXG5mdW5jdGlvbiBleGFtcGxlMSAoKSB7XG4gIFxuICBhZ2Uub25ibHVyID0gKGUpID0+IHtcblxuICAgIGlmIChpc05hTihhZ2UudmFsdWUpKSB7XG4gICAgICBhZ2UuY2xhc3NMaXN0LmFkZCgnZXJyb3InKVxuICAgICAgYWdlLmZvY3VzKClcbiAgICB9IFxuICAgIGVsc2Uge1xuICAgICBhZ2UuY2xhc3NMaXN0LnJlbW92ZSgnZXJyb3InKVxuICAgIH1cbiAgfVxuXG5cbn1cbmV4YW1wbGUxKClcblxuXG5cbi8qVGFzayAxXG5cbtCg0LXQsNC70LjQt9GD0LnRgtC1INCx0L7Qu9C10LUg0YPQtNC+0LHQvdGL0Lkg0L/Qu9C10LnRgdGF0L7Qu9C00LXRgC3Qv9C+0LTRgdC60LDQt9C60YMg0L3QsCBKYXZhU2NyaXB0INGH0LXRgNC10Lcg0LDRgtGA0LjQsdGD0YIgZGF0YS1wbGFjZWhvbGRlci5cblxu0J/RgNCw0LLQuNC70LAg0YDQsNCx0L7RgtGLINC/0LvQtdC50YHRhdC+0LvQtNC10YDQsDpcbiAg0K3Qu9C10LzQtdC90YIg0LjQt9C90LDRh9Cw0LvRjNC90L4g0YHQvtC00LXRgNC20LjRgiDQv9C70LXQudGB0YXQvtC70LTQtdGALiDQodC/0LXRhtC40LDQu9GM0L3Ri9C5INC60LvQsNGB0YEgcGxhY2Vob2xkZXIg0L/RgNC40LTQsNC10YIg0LXQvNGDINGB0LjQvdC40Lkg0YbQstC10YIuXG4gINCf0YDQuCDRhNC+0LrRg9GB0LjRgNC+0LLQutC1INC/0LvQtdC50YHRhdC+0LvQtNC10YAg0L/QvtC60LDQt9GL0LLQsNC10YLRgdGPINGD0LbQtSDQvdCw0LQg0L/QvtC70LXQvCwg0YHRgtCw0L3QvtCy0Y/RgdGMIMKr0L/QvtC00YHQutCw0LfQutC+0LnCuy5cbiAg0J/RgNC4INGB0L3Rj9GC0LjQuCDRhNC+0LrRg9GB0LAsINC/0L7QtNGB0LrQsNC30LrQsCDRg9Cx0LjRgNCw0LXRgtGB0Y8sINC10YHQu9C4INC/0L7Qu9C1INC/0YPRgdGC0L7QtSDigJMg0L/Qu9C10LnRgdGF0L7Qu9C00LXRgCDQstC+0LfQstGA0LDRidCw0LXRgtGB0Y8g0LIg0L3QtdCz0L4uXG4qL1xuXG5mdW5jdGlvbiB0YXNrMSAoKSB7XG4gIGxldCBmb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYWNlaG9sZGVyV3JhcCcpXG4gIGxldCB0aXAgPSBudWxsXG4gIGxldCBpc0NvbnRhaW5zUGxhY2Vob2xkZXIgPSBpbnB1dCA9PiBpbnB1dC5kYXRhc2V0LnBsYWNlaG9sZGVyXG4gIGxldCBjcmVhdGVUaXAgPSAodmFsdWUpID0+IHtcbiAgICBsZXQgdGlwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3BhbicpXG4gICAgdGlwLmNsYXNzTGlzdC5hZGQoJ3BsYWNlaG9sZGVyLXRvb2x0aXAnKVxuICAgIHRpcC5pbm5lckhUTUwgPSB2YWx1ZVxuICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQodGlwKVxuICAgIHJldHVybiB0aXBcbiAgfVxuXG4gIGxldCBzZXRQbGFjZWhvbGRlckZvciA9IGlucHV0ID0+IHtcbiAgICBpbnB1dC52YWx1ZSA9IGlucHV0LmRhdGFzZXQucGxhY2Vob2xkZXJcbiAgfVxuICBcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsIChlKSA9PiB7XG4gICAgJCgnaW5wdXRbZGF0YS1wbGFjZWhvbGRlcl0nKS5mb3JFYWNoKGlucHV0ID0+IHtcbiAgICAgIHNldFBsYWNlaG9sZGVyRm9yKGlucHV0KVxuICAgIH0pXG4gIH0pXG5cbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdmb2N1cycsIGUgPT4ge1xuICAgIGxldCBpbnB1dCA9IGUudGFyZ2V0XG5cbiAgICBpZiAoIWlzQ29udGFpbnNQbGFjZWhvbGRlcihpbnB1dCkpIHJldHVybiBmYWxzZVxuICAgIGlucHV0LnZhbHVlID0gJydcbiAgICB0aXAgPSBjcmVhdGVUaXAoaW5wdXQuZGF0YXNldC5wbGFjZWhvbGRlcilcbiAgICB0aXAuc3R5bGUudG9wID0gaW5wdXQub2Zmc2V0VG9wIC0gdGlwLm9mZnNldEhlaWdodCArICdweCdcbiAgICB0aXAuc3R5bGUubGVmdCA9IGlucHV0Lm9mZnNldExlZnQgKyAncHgnXG4gIH0sIHRydWUpXG5cbiAgZm9ybS5hZGRFdmVudExpc3RlbmVyKCdibHVyJywgZSA9PiB7XG4gICAgbGV0IGlucHV0ID0gZS50YXJnZXRcbiAgICBpZiAoIWlzQ29udGFpbnNQbGFjZWhvbGRlcihpbnB1dCkpIHJldHVybiBmYWxzZVxuICAgIHNldFBsYWNlaG9sZGVyRm9yKGlucHV0KVxuICAgIHRpcC5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRpcClcbiAgfSwgdHJ1ZSlcbn1cbnRhc2sxKClcblxuLypFbmxpZ2h0bWVudDpcbiAgaW5zdGVhZCBvZiBjbG9qdXJlIGB0aXBgIHlvdSBjYW4gdXNlIGVsZW1lbnQudGlwIChjdXN0b20gZG9tIHByb3BlcnR5KVxuICB1c2VmdWwsIGlmIHlvdSBuZWVkIHRvIHNob3cgMiBvciBtb3JlIGB0aXBzYFxuKi9cblxuXG5cblxuLypUYXNrIDJcbiDQmtC70LjQutC90LjRgtC1INC/0L4g0LzRi9GI0L7QvdC60YMuINCX0LDRgtC10Lwg0L3QsNC20LjQvNCw0LnRgtC1INC60LvQsNCy0LjRiNC4INGB0L4g0YHRgtGA0LXQu9C60LDQvNC4LCDQuCDQvtC9INCx0YPQtNC10YIg0LTQstC40LPQsNGC0YzRgdGPLlxu0JIg0Y3RgtC+0Lkg0LfQsNC00LDRh9C1INC30LDQv9GA0LXRidCw0LXRgtGB0Y8g0YHRgtCw0LLQuNGC0Ywg0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDQutGD0LTQsC3Qu9C40LHQviwg0LrRgNC+0LzQtSDRjdC70LXQvNC10L3RgtCwICNtb3VzZS5cbtCc0L7QttC90L4g0LjQt9C80LXQvdGP0YLRjCDQsNGC0YDQuNCx0YPRgtGLINC4INC60LvQsNGB0YHRiyDQsiBIVE1MLlxuXG5odHRwOi8vcGxua3IuY28vZWRpdC9rTGgweXFiaTZpcmNETkg0TVNkVz9wPXByZXZpZXdcbiovXG5cbmZ1bmN0aW9uIHRhc2syICgpIHtcbiAgY29uc3QgbW91c2UgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbW91c2UnKVxuICBjb25zdCBkaXJlY3Rpb25zID0gWydsZWZ0JywgJ3RvcCcsICdyaWdodCcsICdib3R0b20nXVxuICBjb25zdCBpc0Fycm93ID0gKHR5cGUsIGNvZGUpID0+IHtcbiAgICBzd2l0Y2godHlwZSl7XG4gICAgICBjYXNlICdsZWZ0JyAgIDogcmV0dXJuIGNvZGUgPT09IDM3XG4gICAgICBjYXNlICd0b3AnICAgIDogcmV0dXJuIGNvZGUgPT09IDM4XG4gICAgICBjYXNlICdyaWdodCcgIDogcmV0dXJuIGNvZGUgPT09IDM5XG4gICAgICBjYXNlICdib3R0b20nIDogcmV0dXJuIGNvZGUgPT09IDQwXG4gICAgICBkZWZhdWx0ICAgICAgIDogcmV0dXJuIGZhbHNlXG4gICAgfVxuICB9XG4gIGNvbnN0IHNoaWZ0ID0gKGVsZW0sIGRpciwgc3RlcD0yNSkgPT4ge1xuICAgIHN3aXRjaChkaXIpe1xuICAgICAgY2FzZSAnbGVmdCcgICA6IGVsZW0uc3R5bGUubGVmdCA9IChwYXJzZUludChlbGVtLnN0eWxlLmxlZnQpIHx8IDApIC0gc3RlcCArICdweCc7IGJyZWFrXG4gICAgICBjYXNlICdyaWdodCcgIDogZWxlbS5zdHlsZS5sZWZ0ID0gKHBhcnNlSW50KGVsZW0uc3R5bGUubGVmdCkgfHwgMCkgKyBzdGVwICsgJ3B4JzsgYnJlYWtcbiAgICAgIGNhc2UgJ3RvcCcgICAgOiBlbGVtLnN0eWxlLnRvcCA9IChwYXJzZUludChlbGVtLnN0eWxlLnRvcCkgfHwgMCkgLSBzdGVwICsgJ3B4JzsgYnJlYWtcbiAgICAgIGNhc2UgJ2JvdHRvbScgOiBlbGVtLnN0eWxlLnRvcCA9IChwYXJzZUludChlbGVtLnN0eWxlLnRvcCkgfHwgMCkgKyBzdGVwICsgJ3B4JzsgYnJlYWtcbiAgICAgIGRlZmF1bHQgICAgICAgOiByZXR1cm4gZmFsc2VcbiAgICB9XG4gIH1cblxuICBtb3VzZS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgZnVuY3Rpb24gKGUpIHtcbiAgICBkaXJlY3Rpb25zLmZvckVhY2goZGlyID0+IHtcbiAgICAgIGlmICghaXNBcnJvdyhkaXIsIGUua2V5Q29kZSkpIHJldHVyblxuICAgICAgc2hpZnQodGhpcywgZGlyKVxuICAgIH0pXG4gIH0pXG59XG50YXNrMigpXG5cblxuXG5cbi8qVGFzayAzXG5cbtCh0L7Qt9C00LDQudGC0LUgPGRpdj4sINC60L7RgtC+0YDRi9C5INC/0YDQuCDQvdCw0LbQsNGC0LjQuCBDdHJsK0Ug0L/RgNC10LLRgNCw0YnQsNC10YLRgdGPINCyIDx0ZXh0YXJlYT4uXG7QmNC30LzQtdC90LXQvdC40Y8sINCy0L3QtdGB0LXQvdC90YvQtSDQsiDQv9C+0LvQtSwg0LzQvtC20L3QviDRgdC+0YXRgNCw0L3QuNGC0Ywg0L7QsdGA0LDRgtC90L4g0LIgPGRpdj4g0YHQvtGH0LXRgtCw0L3QuNC10Lwg0LrQu9Cw0LLQuNGIIEN0cmwrUywg0L/RgNC4INGN0YLQvtC8IFxuPGRpdj4g0L/QvtC70YPRh9C40YIg0LIg0LLQuNC00LUgSFRNTCDRgdC+0LTQtdGA0LbQuNC80L7QtSA8dGV4dGFyZWE+LlxuXG7QldGB0LvQuCDQttC1INC90LDQttCw0YLRjCBFc2MsINGC0L4gPHRleHRhcmVhPiDRgdC90L7QstCwINC/0YDQtdCy0YDQsNGJ0LDQtdGC0YHRjyDQsiA8ZGl2Piwg0LjQt9C80LXQvdC10L3QuNGPINC90LUg0YHQvtGF0YDQsNC90Y/RjtGC0YHRjy5cbiovXG5cbmZ1bmN0aW9uIHRhc2szICgpIHtcbiAgY29uc3QgdHlwZXMgPSB7XG4gICAgc3RhdGljOiAnZGl2JyxcbiAgICBlZGl0YWJsZTogJ3RleHRhcmVhJ1xuICB9XG5cbiAgY29uc3QgY2hlY2tIb3RrZXkgPSAoZSwga2V5KSA9PiBlLmtleUNvZGUgPT09IGtleS50b1VwcGVyQ2FzZSgpLmNoYXJDb2RlQXQoMCkgJiYgZS5jdHJsS2V5XG4gIGNvbnN0IGNoZWNrRXNjYXBlS2V5ID0gKGUpID0+IGUua2V5Q29kZSA9PT0gMjdcblxuICBjb25zdCBFZGl0YWJsZSA9IGZ1bmN0aW9uKGNvbnRlbnQsIGtleWRvd25IYW5kbGVyKSB7XG4gICAgbGV0IGVsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KHR5cGVzLmVkaXRhYmxlKVxuXG4gICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtZWRpdGFibGUnLCAnJylcbiAgICBlbGVtLnNldEF0dHJpYnV0ZSgndGFiSW5kZXgnLCAtMSlcbiAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBrZXlkb3duSGFuZGxlcilcbiAgICBlbGVtLnZhbHVlID0gY29udGVudFxuICAgIHJldHVybiBlbGVtXG4gIH1cblxuICBjb25zdCBTdGF0aWMgPSBmdW5jdGlvbiAoY29udGVudCwga2V5ZG93bkhhbmRsZXIpIHtcbiAgICBsZXQgZWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQodHlwZXMuc3RhdGljKVxuXG4gICAgZWxlbS5zZXRBdHRyaWJ1dGUoJ2RhdGEtZWRpdGFibGUnLCAnJylcbiAgICBlbGVtLnNldEF0dHJpYnV0ZSgndGFiSW5kZXgnLCAtMSlcbiAgICBlbGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBrZXlkb3duSGFuZGxlcilcbiAgICBlbGVtLnRleHRDb250ZW50ID0gY29udGVudFxuICAgIHJldHVybiBlbGVtXG4gIH1cblxuXG4gICQoJ1tkYXRhLWVkaXRhYmxlXScpLmZvckVhY2goZWxlbSA9PiB7XG4gICAgbGV0IGxhc3RTYXZlZFR4dCA9ICcnXG5cbiAgICBsZXQgaGFuZGxlciA9IGZ1bmN0aW9uIChlKSB7XG4gICAgICBsZXQgcmVwbGFjZXIgPSBudWxsXG4gICAgICAvLyBlZGl0aW5nIHN0YXRpY1xuICAgICAgaWYgKGNoZWNrSG90a2V5KGUsIFwiRVwiKSAmJiB0aGlzLnRhZ05hbWUudG9Mb3dlckNhc2UoKSA9PT0gdHlwZXMuc3RhdGljKSB7XG4gICAgICAgIHJlcGxhY2VyID0gbmV3IEVkaXRhYmxlKHRoaXMudGV4dENvbnRlbnQsIGhhbmRsZXIpXG4gICAgICB9XG4gICAgICAvLyBzYXZpbmdcbiAgICAgIGVsc2UgaWYgKGNoZWNrSG90a2V5KGUsIFwiU1wiKSkge1xuICAgICAgICBsYXN0U2F2ZWRUeHQgPSB0aGlzLnZhbHVlXG4gICAgICAgIHJlcGxhY2VyID0gbmV3IFN0YXRpYyh0aGlzLnZhbHVlLCBoYW5kbGVyKVxuICAgICAgfVxuICAgICAgLy8gdW5zYXZlZFxuICAgICAgZWxzZSBpZiAoY2hlY2tFc2NhcGVLZXkoZSkpIHtcbiAgICAgICAgcmVwbGFjZXIgPSBuZXcgU3RhdGljKGxhc3RTYXZlZFR4dCwgaGFuZGxlcilcbiAgICAgIH1cbiAgICAgIC8vIGlnbm9yZSBvdGhlciBrZXlzXG4gICAgICBlbHNlIHtyZXR1cm59XG5cbiAgICAgIHRoaXMucGFyZW50RWxlbWVudC5yZXBsYWNlQ2hpbGQocmVwbGFjZXIsIHRoaXMpXG4gICAgICByZXBsYWNlci5mb2N1cygpXG4gICAgfVxuXG4gICAgZWxlbS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgaGFuZGxlcilcbiAgfSlcblxufVxudGFzazMoKVxuXG5cblxuXG4vKlRhc2sgNFxu0KHQtNC10LvQsNGC0Ywg0Y/Rh9C10LnQutC4INGC0LDQsdC70LjRhtGLIHRkINGA0LXQtNCw0LrRgtC40YDRg9C10LzRi9C80Lgg0L/QviDQutC70LjQutGDLlxuXG7Qn9GA0Lgg0LrQu9C40LrQtSDigJMg0Y/Rh9C10LnQutCwIDx0ZD4g0L/RgNC10LLRgNCw0YnQsNC10YLRgdGPINCyINGA0LXQtNCw0LrRgtC40YDRg9C10LzRg9GOLCDQvNC+0LbQvdC+INC80LXQvdGP0YLRjCBIVE1MLlxuXG7QoNCw0LfQvNC10YDRiyDRj9GH0LXQtdC6INC/0YDQuCDRjdGC0L7QvCDQvdC1INC00L7Qu9C20L3RiyDQvNC10L3Rj9GC0YzRgdGPLlxu0JIg0L7QtNC40L0g0LzQvtC80LXQvdGCINC80L7QttC10YIg0YDQtdC00LDQutGC0LjRgNC+0LLQsNGC0YzRgdGPINC+0LTQvdCwINGP0YfQtdC50LrQsC5cblxu0J/RgNC4INGA0LXQtNCw0LrRgtC40YDQvtCy0LDQvdC40Lgg0L/QvtC0INGP0YfQtdC50LrQvtC5INC/0L7Rj9Cy0LvRj9GO0YLRgdGPINC60L3QvtC/0LrQuCDQtNC70Y8g0L/RgNC40LXQvNCwINC4INC+0YLQvNC10L3QsCDRgNC10LTQsNC60YLQuNGA0L7QstCw0L3QuNGPLFxu0YLQvtC70YzQutC+INC60LvQuNC6INC90LAg0L3QuNGFINC30LDQutCw0L3Rh9C40LLQsNC10YIg0YDQtdC00LDQutGC0LjRgNC+0LLQsNC90LjQtS5cblxuKi9cblxuZnVuY3Rpb24gdGFzazQgKCkge1xuICBjb25zdCBFZGl0YWJsZSA9IGZ1bmN0aW9uKG9yaWdpbikge1xuICAgIHRoaXMucGFyZW50ID0gb3JpZ2luXG4gICAgdGhpcy5hcmVhID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndGV4dGFyZWEnKVxuICAgIHRoaXMuYXJlYS5jbGFzc0xpc3QuYWRkKCdjZWxsLWVkaXRhYmxlJylcbiAgICB0aGlzLmFyZWEudmFsdWUgPSBvcmlnaW4uaW5uZXJIVE1MXG4gIH1cbiAgRWRpdGFibGUucHJvdG90eXBlLmRlc3Ryb3kgPSBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5wYXJlbnQucmVtb3ZlQ2hpbGQodGhpcy5hcmVhKVxuICAgIHRoaXMucGFyZW50LnJlbW92ZUNoaWxkKHRoaXMuY29udHJvbHMpXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuICBFZGl0YWJsZS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnBhcmVudC5hcHBlbmRDaGlsZCh0aGlzLmFyZWEpXG4gICAgdGhpcy5wYXJlbnQuYXBwZW5kQ2hpbGQodGhpcy5jb250cm9scylcbiAgICB0aGlzLmFyZWEuZm9jdXMoKVxuICAgIHJldHVybiB0aGlzXG4gIH1cbiAgRWRpdGFibGUucHJvdG90eXBlLmNyZWF0ZUNvbnRyb2xzID0gZnVuY3Rpb24oY29udHJvbHNUZW1wbGF0ZSkge1xuICAgIHRoaXMuY29udHJvbHMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuICAgIHRoaXMuY29udHJvbHMuY2xhc3NMaXN0LmFkZCgnZWRpdGFibGUtY29udHJvbC13cmFwJylcbiAgICBcbiAgICBjb250cm9sc1RlbXBsYXRlLmZvckVhY2goY29udHJvbCA9PiB7XG4gICAgICBsZXQgYnRuID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYnV0dG9uJylcbiAgICAgIGJ0bi5jbGFzc0xpc3QuYWRkKCdlZGl0YWJsZS1jb250cm9sJylcbiAgICAgIGJ0bi50ZXh0Q29udGVudCA9IGNvbnRyb2wubmFtZVxuICAgICAgYnRuLm9uY2xpY2sgPSBjb250cm9sLmhhbmRsZXJcbiAgICAgIHRoaXMuY29udHJvbHMuYXBwZW5kQ2hpbGQoYnRuKVxuICAgIH0pXG4gICAgcmV0dXJuIHRoaXNcbiAgfVxuXG4gIGxldCBpc0VkaXRpbmcgPSBmYWxzZVxuICBjb25zdCB0YWJsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdiYWd1YS10YWJsZScpXG5cbiAgdGFibGUuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBlID0+IHtcbiAgICBsZXQgY2VsbCA9IGUudGFyZ2V0XG5cbiAgICBpZiAoaXNFZGl0aW5nIHx8IGNlbGwudGFnTmFtZSAhPT0gJ1REJykgcmV0dXJuO1xuXG4gICAgaXNFZGl0aW5nID0gdHJ1ZVxuICAgIGxldCBsYXN0U2F2ZWRDb250ZW50ID0gY2VsbC5pbm5lckhUTUxcbiAgICBsZXQgZWRpdGFibGUgPSBuZXcgRWRpdGFibGUoY2VsbClcblxuICAgIGVkaXRhYmxlXG4gICAgICAuY3JlYXRlQ29udHJvbHMoW1xuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ1NhdmUnLFxuICAgICAgICAgIGhhbmRsZXI6IGUgPT4ge1xuICAgICAgICAgICAgZWRpdGFibGUuZGVzdHJveSgpXG4gICAgICAgICAgICBpc0VkaXRpbmcgPSBmYWxzZVxuICAgICAgICAgICAgY2VsbC5pbm5lckhUTUwgPSBlZGl0YWJsZS5hcmVhLnZhbHVlXG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgbmFtZTogJ0NhbmNlbCcsXG4gICAgICAgICAgaGFuZGxlcjogZSA9PiB7XG4gICAgICAgICAgICBlZGl0YWJsZS5kZXN0cm95KClcbiAgICAgICAgICAgIGlzRWRpdGluZyA9IGZhbHNlXG4gICAgICAgICAgICBjZWxsLmlubmVySFRNTCA9IGxhc3RTYXZlZENvbnRlbnRcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIF0pXG4gICAgICAuaW5pdCgpXG4gIH0pXG4gICAgXG59XG50YXNrNCgpXG5cblxuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
