'use strict';

/*
Сделайте так, чтобы при прокрутке ниже элемента 
#avatar (картинка с Винни-Пухом) – он продолжал показываться в левом-верхнем углу.

При прокрутке вверх – должен возвращаться на обычное место.

Solve with markup: http://plnkr.co/edit/JDSm7hVgXoVVQdxgAjcr?p=preview
*/

function task1() {
  var fixElem = function fixElem(elem) {
    elem.style.position = 'fixed';
    elem.style.left = '0';
    elem.style.top = '0';
  };
  var restoreElem = function restoreElem(elem) {
    elem.style.position = 'static';
  };
  var elemPosHandler = function elemPosHandler(elem, elemY, evt) {
    window.pageYOffset >= elemY ? fixElem(elem) : restoreElem(elem);
  };

  var avatarStartY = avatar.getBoundingClientRect().top + window.pageYOffset;
  document.addEventListener('scroll', elemPosHandler.bind(null, avatar, avatarStartY));
}
// task1()

/*Task 2

Создайте кнопку навигации, которая помогает при прокрутке страницы.

Работать должна следующим образом:

Пока страница промотана меньше чем на высоту экрана вниз – кнопка не видна.
При промотке страницы вниз больше, чем на высоту экрана, появляется кнопка «стрелка вверх».
При нажатии на нее страница прыгает вверх, но не только.
Дополнительно, кнопка меняется на «стрелка вниз» и при клике возвратит на старое место. 
Если же в этом состоянии посетитель сам прокрутит вниз больше, чем один экран,
то она вновь изменится на «стрелка вверх».

*/
function task2() {
  var _this = this;

  var helper = document.getElementById('scroll-helper');
  var lastPosition = null;
  var isReturned = false;

  var handleHelperClick = function handleHelperClick(type, e) {
    switch (type) {
      case 'toUp':
        window.scrollTo(0, 0);
        break;
      case 'toDown':
        window.scrollTo(lastPosition.left, lastPosition.top);
        break;
    }
  };

  var activateHelperAs = function activateHelperAs(type) {
    switch (type) {
      case 'toUp':
        helper.classList.remove('is-hidden');
        helper.classList.remove('is-down');
        helper.classList.add('is-up');
        break;
      case 'toDown':
        helper.classList.remove('is-hidden');
        helper.classList.remove('is-up');
        helper.classList.add('is-down');
        break;
      case 'hidden':
        helper.classList.remove('is-up');
        helper.classList.remove('is-down');
        helper.classList.add('is-hidden');
        break;
    }
  };

  var setHelperBehavior = function setHelperBehavior(e) {
    var scrollY = window.pageYOffset;
    var docHeight = window.innerHeight;

    if (scrollY > docHeight) {
      activateHelperAs('toUp');
      lastPosition = {
        top: window.pageYOffset,
        left: window.pageXOffset
      };
      isReturned = true;
      helper.onclick = handleHelperClick.bind(_this, 'toUp');
    } else if (scrollY === 0 && isReturned) {
      activateHelperAs('toDown');
      helper.onclick = handleHelperClick.bind(_this, 'toDown');
    } else if (scrollY <= docHeight) {
      activateHelperAs('hidden');
      isReturned = false;
      helper.onclick = false;
    }
  };

  document.addEventListener('scroll', setHelperBehavior);
}
// task2()

/*
Напишите код, который при прокрутке окна загружает ставшие видимыми изображения.

То есть, как только изображение попало в видимую часть документа – 
в src нужно прописать правильный URL из realsrc.

- При начальной загрузке некоторые изображения должны быть видны сразу, до прокрутки.

- Некоторые изображения могут быть обычными, без realsrc.
  Их код не должен трогать вообще.

- Также код не должен перегружать уже показанное изображение.

- Желательно предусмотреть загрузку изображений не только видимых сейчас,
  но и на страницу вперед и назад от текущего места.

*/

function task3() {
  var cachedSrc = 'realsrc';

  var loadImg = function loadImg(img) {
    img.setAttribute('src', img.getAttribute(cachedSrc));
    img.removeAttribute(cachedSrc);
  };

  var loadImages = function loadImages(visibleArea) {
    $$('img[' + cachedSrc + ']').forEach(function (img) {
      var imgTop = img.getBoundingClientRect().top + pageYOffset;
      if (imgTop > visibleArea.bottom || imgTop < visibleArea.top) return;
      loadImg(img);
    });
  };

  var loadImagesHandler = function loadImagesHandler(e) {
    var visibleArea = {
      top: e.pageYOffset - window.innerHeight,
      bottom: e.pageYOffset + window.innerHeight
    };
    loadImages(visibleArea);
  };

  loadImagesHandler(window); // little tricky
  document.addEventListener('scroll', loadImagesHandler);
}
// task3()
//# sourceMappingURL=data:application/json;base64,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LFlBQVksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFBO0FBQ3BELE9BQUcsQ0FBQyxlQUFlLENBQUMsU0FBUyxDQUFDLENBQUE7R0FDL0IsQ0FBQTs7QUFFRCxNQUFJLFVBQVUsR0FBRyxTQUFiLFVBQVUsQ0FBSSxXQUFXLEVBQUs7QUFDaEMsTUFBRSxVQUFRLFNBQVMsT0FBSSxDQUNwQixPQUFPLENBQUMsVUFBQSxHQUFHLEVBQUk7QUFDZCxVQUFJLE1BQU0sR0FBRyxHQUFHLENBQUMscUJBQXFCLEVBQUUsQ0FBQyxHQUFHLEdBQUcsV0FBVyxDQUFBO0FBQzFELFVBQUksTUFBTSxHQUFHLFdBQVcsQ0FBQyxNQUFNLElBQUksTUFBTSxHQUFHLFdBQVcsQ0FBQyxHQUFHLEVBQUUsT0FBTTtBQUNuRSxhQUFPLENBQUMsR0FBRyxDQUFDLENBQUE7S0FDZixDQUFDLENBQUE7R0FDSCxDQUFBOztBQUVELE1BQUksaUJBQWlCLEdBQUcsU0FBcEIsaUJBQWlCLENBQUksQ0FBQyxFQUFLO0FBQzdCLFFBQUksV0FBVyxHQUFHO0FBQ2hCLFNBQUcsRUFBRSxDQUFDLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxXQUFXO0FBQ3ZDLFlBQU0sRUFBRSxDQUFDLENBQUMsV0FBVyxHQUFHLE1BQU0sQ0FBQyxXQUFXO0tBQzNDLENBQUE7QUFDRCxjQUFVLENBQUMsV0FBVyxDQUFDLENBQUE7R0FDeEIsQ0FBQTs7QUFFRCxtQkFBaUIsQ0FBQyxNQUFNLENBQUM7QUFBQSxBQUN6QixVQUFRLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxFQUFFLGlCQUFpQixDQUFDLENBQUE7Q0FDdkQ7O0FBQUEiLCJmaWxlIjoicGFydDIvZXZlbnRzLzA4LnNjcm9sbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG7QodC00LXQu9Cw0LnRgtC1INGC0LDQuiwg0YfRgtC+0LHRiyDQv9GA0Lgg0L/RgNC+0LrRgNGD0YLQutC1INC90LjQttC1INGN0LvQtdC80LXQvdGC0LAgXG4jYXZhdGFyICjQutCw0YDRgtC40L3QutCwINGBINCS0LjQvdC90Lgt0J/Rg9GF0L7QvCkg4oCTINC+0L0g0L/RgNC+0LTQvtC70LbQsNC7INC/0L7QutCw0LfRi9Cy0LDRgtGM0YHRjyDQsiDQu9C10LLQvtC8LdCy0LXRgNGF0L3QtdC8INGD0LPQu9GDLlxuXG7Qn9GA0Lgg0L/RgNC+0LrRgNGD0YLQutC1INCy0LLQtdGA0YUg4oCTINC00L7Qu9C20LXQvSDQstC+0LfQstGA0LDRidCw0YLRjNGB0Y8g0L3QsCDQvtCx0YvRh9C90L7QtSDQvNC10YHRgtC+LlxuXG5Tb2x2ZSB3aXRoIG1hcmt1cDogaHR0cDovL3BsbmtyLmNvL2VkaXQvSkRTbTdoVmdYb1ZWUWR4Z0FqY3I/cD1wcmV2aWV3XG4qL1xuXG5mdW5jdGlvbiB0YXNrMSAoKSB7XG4gIGxldCBmaXhFbGVtID0gZWxlbSA9PiB7XG4gICAgZWxlbS5zdHlsZS5wb3NpdGlvbiA9ICdmaXhlZCdcbiAgICBlbGVtLnN0eWxlLmxlZnQgPSAnMCdcbiAgICBlbGVtLnN0eWxlLnRvcCA9ICcwJ1xuICB9XG4gIGxldCByZXN0b3JlRWxlbSA9IGVsZW0gPT4ge1xuICAgIGVsZW0uc3R5bGUucG9zaXRpb24gPSAnc3RhdGljJ1xuICB9XG4gIGxldCBlbGVtUG9zSGFuZGxlciA9IChlbGVtLCBlbGVtWSwgZXZ0KSA9PiB7XG4gICAgd2luZG93LnBhZ2VZT2Zmc2V0ID49IGVsZW1ZID8gZml4RWxlbShlbGVtKSA6IHJlc3RvcmVFbGVtKGVsZW0pXG4gIH1cblxuICBsZXQgYXZhdGFyU3RhcnRZID0gYXZhdGFyLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArIHdpbmRvdy5wYWdlWU9mZnNldFxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBlbGVtUG9zSGFuZGxlci5iaW5kKG51bGwsIGF2YXRhciwgYXZhdGFyU3RhcnRZKSlcbn1cbi8vIHRhc2sxKClcblxuXG5cbi8qVGFzayAyXG5cbtCh0L7Qt9C00LDQudGC0LUg0LrQvdC+0L/QutGDINC90LDQstC40LPQsNGG0LjQuCwg0LrQvtGC0L7RgNCw0Y8g0L/QvtC80L7Qs9Cw0LXRgiDQv9GA0Lgg0L/RgNC+0LrRgNGD0YLQutC1INGB0YLRgNCw0L3QuNGG0YsuXG5cbtCg0LDQsdC+0YLQsNGC0Ywg0LTQvtC70LbQvdCwINGB0LvQtdC00YPRjtGJ0LjQvCDQvtCx0YDQsNC30L7QvDpcblxu0J/QvtC60LAg0YHRgtGA0LDQvdC40YbQsCDQv9GA0L7QvNC+0YLQsNC90LAg0LzQtdC90YzRiNC1INGH0LXQvCDQvdCwINCy0YvRgdC+0YLRgyDRjdC60YDQsNC90LAg0LLQvdC40Lcg4oCTINC60L3QvtC/0LrQsCDQvdC1INCy0LjQtNC90LAuXG7Qn9GA0Lgg0L/RgNC+0LzQvtGC0LrQtSDRgdGC0YDQsNC90LjRhtGLINCy0L3QuNC3INCx0L7Qu9GM0YjQtSwg0YfQtdC8INC90LAg0LLRi9GB0L7RgtGDINGN0LrRgNCw0L3QsCwg0L/QvtGP0LLQu9GP0LXRgtGB0Y8g0LrQvdC+0L/QutCwIMKr0YHRgtGA0LXQu9C60LAg0LLQstC10YDRhcK7Llxu0J/RgNC4INC90LDQttCw0YLQuNC4INC90LAg0L3QtdC1INGB0YLRgNCw0L3QuNGG0LAg0L/RgNGL0LPQsNC10YIg0LLQstC10YDRhSwg0L3QviDQvdC1INGC0L7Qu9GM0LrQvi5cbtCU0L7Qv9C+0LvQvdC40YLQtdC70YzQvdC+LCDQutC90L7Qv9C60LAg0LzQtdC90Y/QtdGC0YHRjyDQvdCwIMKr0YHRgtGA0LXQu9C60LAg0LLQvdC40LfCuyDQuCDQv9GA0Lgg0LrQu9C40LrQtSDQstC+0LfQstGA0LDRgtC40YIg0L3QsCDRgdGC0LDRgNC+0LUg0LzQtdGB0YLQvi4gXG7QldGB0LvQuCDQttC1INCyINGN0YLQvtC8INGB0L7RgdGC0L7Rj9C90LjQuCDQv9C+0YHQtdGC0LjRgtC10LvRjCDRgdCw0Lwg0L/RgNC+0LrRgNGD0YLQuNGCINCy0L3QuNC3INCx0L7Qu9GM0YjQtSwg0YfQtdC8INC+0LTQuNC9INGN0LrRgNCw0L0sXG7RgtC+INC+0L3QsCDQstC90L7QstGMINC40LfQvNC10L3QuNGC0YHRjyDQvdCwIMKr0YHRgtGA0LXQu9C60LAg0LLQstC10YDRhcK7LlxuXG4qL1xuZnVuY3Rpb24gdGFzazIgKCkge1xuICBsZXQgaGVscGVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Njcm9sbC1oZWxwZXInKVxuICBsZXQgbGFzdFBvc2l0aW9uID0gbnVsbFxuICBsZXQgaXNSZXR1cm5lZCA9IGZhbHNlXG5cbiAgbGV0IGhhbmRsZUhlbHBlckNsaWNrID0gKHR5cGUsIGUpID0+IHtcbiAgICBzd2l0Y2godHlwZSl7XG4gICAgICBjYXNlICd0b1VwJzpcbiAgICAgICAgd2luZG93LnNjcm9sbFRvKDAsIDApXG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAndG9Eb3duJzpcbiAgICAgICAgd2luZG93LnNjcm9sbFRvKGxhc3RQb3NpdGlvbi5sZWZ0LCBsYXN0UG9zaXRpb24udG9wKVxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBsZXQgYWN0aXZhdGVIZWxwZXJBcyA9ICh0eXBlKSA9PiB7XG4gICAgc3dpdGNoKHR5cGUpe1xuICAgICAgY2FzZSAndG9VcCc6XG4gICAgICAgIGhlbHBlci5jbGFzc0xpc3QucmVtb3ZlKCdpcy1oaWRkZW4nKVxuICAgICAgICBoZWxwZXIuY2xhc3NMaXN0LnJlbW92ZSgnaXMtZG93bicpXG4gICAgICAgIGhlbHBlci5jbGFzc0xpc3QuYWRkKCdpcy11cCcpICAgIFxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ3RvRG93bic6XG4gICAgICAgIGhlbHBlci5jbGFzc0xpc3QucmVtb3ZlKCdpcy1oaWRkZW4nKVxuICAgICAgICBoZWxwZXIuY2xhc3NMaXN0LnJlbW92ZSgnaXMtdXAnKVxuICAgICAgICBoZWxwZXIuY2xhc3NMaXN0LmFkZCgnaXMtZG93bicpICAgIFxuICAgICAgICBicmVhaztcbiAgICAgIGNhc2UgJ2hpZGRlbic6XG4gICAgICAgIGhlbHBlci5jbGFzc0xpc3QucmVtb3ZlKCdpcy11cCcpXG4gICAgICAgIGhlbHBlci5jbGFzc0xpc3QucmVtb3ZlKCdpcy1kb3duJylcbiAgICAgICAgaGVscGVyLmNsYXNzTGlzdC5hZGQoJ2lzLWhpZGRlbicpICAgIFxuICAgICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBsZXQgc2V0SGVscGVyQmVoYXZpb3IgPSAoZSkgPT4ge1xuICAgIGxldCBzY3JvbGxZID0gd2luZG93LnBhZ2VZT2Zmc2V0XG4gICAgbGV0IGRvY0hlaWdodCA9IHdpbmRvdy5pbm5lckhlaWdodFxuXG4gICAgaWYgKHNjcm9sbFkgPiBkb2NIZWlnaHQpIHtcbiAgICAgIGFjdGl2YXRlSGVscGVyQXMoJ3RvVXAnKVxuICAgICAgbGFzdFBvc2l0aW9uID0ge1xuICAgICAgICB0b3A6IHdpbmRvdy5wYWdlWU9mZnNldCxcbiAgICAgICAgbGVmdDogd2luZG93LnBhZ2VYT2Zmc2V0LFxuICAgICAgfVxuICAgICAgaXNSZXR1cm5lZCA9IHRydWVcbiAgICAgIGhlbHBlci5vbmNsaWNrID0gaGFuZGxlSGVscGVyQ2xpY2suYmluZCh0aGlzLCAndG9VcCcpXG4gICAgfSBcbiAgICBlbHNlIGlmIChzY3JvbGxZID09PSAwICAmJiBpc1JldHVybmVkKSB7XG4gICAgICBhY3RpdmF0ZUhlbHBlckFzKCd0b0Rvd24nKVxuICAgICAgaGVscGVyLm9uY2xpY2sgPSBoYW5kbGVIZWxwZXJDbGljay5iaW5kKHRoaXMsICd0b0Rvd24nKVxuICAgIH1cbiAgICBlbHNlIGlmIChzY3JvbGxZIDw9IGRvY0hlaWdodCkge1xuICAgICAgYWN0aXZhdGVIZWxwZXJBcygnaGlkZGVuJylcbiAgICAgIGlzUmV0dXJuZWQgPSBmYWxzZVxuICAgICAgaGVscGVyLm9uY2xpY2sgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIHNldEhlbHBlckJlaGF2aW9yKVxufVxuLy8gdGFzazIoKVxuXG5cblxuLypcbtCd0LDQv9C40YjQuNGC0LUg0LrQvtC0LCDQutC+0YLQvtGA0YvQuSDQv9GA0Lgg0L/RgNC+0LrRgNGD0YLQutC1INC+0LrQvdCwINC30LDQs9GA0YPQttCw0LXRgiDRgdGC0LDQstGI0LjQtSDQstC40LTQuNC80YvQvNC4INC40LfQvtCx0YDQsNC20LXQvdC40Y8uXG5cbtCi0L4g0LXRgdGC0YwsINC60LDQuiDRgtC+0LvRjNC60L4g0LjQt9C+0LHRgNCw0LbQtdC90LjQtSDQv9C+0L/QsNC70L4g0LIg0LLQuNC00LjQvNGD0Y4g0YfQsNGB0YLRjCDQtNC+0LrRg9C80LXQvdGC0LAg4oCTIFxu0LIgc3JjINC90YPQttC90L4g0L/RgNC+0L/QuNGB0LDRgtGMINC/0YDQsNCy0LjQu9GM0L3Ri9C5IFVSTCDQuNC3IHJlYWxzcmMuXG5cbi0g0J/RgNC4INC90LDRh9Cw0LvRjNC90L7QuSDQt9Cw0LPRgNGD0LfQutC1INC90LXQutC+0YLQvtGA0YvQtSDQuNC30L7QsdGA0LDQttC10L3QuNGPINC00L7Qu9C20L3RiyDQsdGL0YLRjCDQstC40LTQvdGLINGB0YDQsNC30YMsINC00L4g0L/RgNC+0LrRgNGD0YLQutC4LlxuXG4tINCd0LXQutC+0YLQvtGA0YvQtSDQuNC30L7QsdGA0LDQttC10L3QuNGPINC80L7Qs9GD0YIg0LHRi9GC0Ywg0L7QsdGL0YfQvdGL0LzQuCwg0LHQtdC3IHJlYWxzcmMuXG4gINCY0YUg0LrQvtC0INC90LUg0LTQvtC70LbQtdC9INGC0YDQvtCz0LDRgtGMINCy0L7QvtCx0YnQtS5cblxuLSDQotCw0LrQttC1INC60L7QtCDQvdC1INC00L7Qu9C20LXQvSDQv9C10YDQtdCz0YDRg9C20LDRgtGMINGD0LbQtSDQv9C+0LrQsNC30LDQvdC90L7QtSDQuNC30L7QsdGA0LDQttC10L3QuNC1LlxuXG4tINCW0LXQu9Cw0YLQtdC70YzQvdC+INC/0YDQtdC00YPRgdC80L7RgtGA0LXRgtGMINC30LDQs9GA0YPQt9C60YMg0LjQt9C+0LHRgNCw0LbQtdC90LjQuSDQvdC1INGC0L7Qu9GM0LrQviDQstC40LTQuNC80YvRhSDRgdC10LnRh9Cw0YEsXG4gINC90L4g0Lgg0L3QsCDRgdGC0YDQsNC90LjRhtGDINCy0L/QtdGA0LXQtCDQuCDQvdCw0LfQsNC0INC+0YIg0YLQtdC60YPRidC10LPQviDQvNC10YHRgtCwLlxuXG4qL1xuXG5mdW5jdGlvbiB0YXNrMyAoKSB7XG4gIGxldCBjYWNoZWRTcmMgPSAncmVhbHNyYydcblxuICBsZXQgbG9hZEltZyA9IChpbWcpID0+IHtcbiAgICBpbWcuc2V0QXR0cmlidXRlKCdzcmMnLCBpbWcuZ2V0QXR0cmlidXRlKGNhY2hlZFNyYykpXG4gICAgaW1nLnJlbW92ZUF0dHJpYnV0ZShjYWNoZWRTcmMpXG4gIH1cblxuICBsZXQgbG9hZEltYWdlcyA9ICh2aXNpYmxlQXJlYSkgPT4ge1xuICAgICQkKGBpbWdbJHtjYWNoZWRTcmN9XWApXG4gICAgICAuZm9yRWFjaChpbWcgPT4ge1xuICAgICAgICBsZXQgaW1nVG9wID0gaW1nLmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCArIHBhZ2VZT2Zmc2V0XG4gICAgICAgIGlmIChpbWdUb3AgPiB2aXNpYmxlQXJlYS5ib3R0b20gfHwgaW1nVG9wIDwgdmlzaWJsZUFyZWEudG9wKSByZXR1cm5cbiAgICAgICAgbG9hZEltZyhpbWcpXG4gICAgfSkgIFxuICB9XG5cbiAgbGV0IGxvYWRJbWFnZXNIYW5kbGVyID0gKGUpID0+IHtcbiAgICBsZXQgdmlzaWJsZUFyZWEgPSB7XG4gICAgICB0b3A6IGUucGFnZVlPZmZzZXQgLSB3aW5kb3cuaW5uZXJIZWlnaHQsXG4gICAgICBib3R0b206IGUucGFnZVlPZmZzZXQgKyB3aW5kb3cuaW5uZXJIZWlnaHRcbiAgICB9XG4gICAgbG9hZEltYWdlcyh2aXNpYmxlQXJlYSlcbiAgfVxuXG4gIGxvYWRJbWFnZXNIYW5kbGVyKHdpbmRvdykgLy8gbGl0dGxlIHRyaWNreVxuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBsb2FkSW1hZ2VzSGFuZGxlcilcbn1cbi8vIHRhc2szKClcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
