"use strict";

/*
Base class Machine realize common enable() and disable() methods

Inherit CoffeeMachine from Machine, via call()
*/

function example1() {

  function Machine() {
    var isEnabled = false;

    this.enable = function () {
      this.isEnabled = true;
    };

    this.disable = function () {
      this.isEnabled = false;
    };
  }

  function CoffeeMachine() {
    Machine.call(this); //inherit machine methods
    var waterAmount = 0;

    this.setWaterAmount = function (amount) {
      waterAmount = amount;
    };
  }

  var cm = new CoffeeMachine(10000);
  cm.enable();
  cm.setWaterAmount(100);
  cm.disable();
}
// example1()

/*Problem: private Parent methods are unavailable from Descendand

Desicion: make ALL Parent methods public (attach to this),
          and define private methods with underscore at start: _privateMethod

          It's a Convention not a Rule (be careful)
*/

function example2() {

  function Machine() {
    this._isEnabled = false; //this is Private property: access only from Parent and Descendants, no outside!
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function CoffeeMachine() {
    Machine.call(this); //inherit machine methods
    this.enable();
    console.log(this._isEnabled);
  }

  var cm = new CoffeeMachine(10000);
}
// example2()

/*
  Task: add power argument to all machines

  use Parent.apply(this, arguments), to invoke Parent inside Descendant
  with correct context and parameters passed to Descendant

*/

function example3() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function CoffeeMachine(power) {
    Machine.apply(this, arguments); // apply M function with CM arguments

    console.log(this._isEnabled);
    console.log(this._power);
  }

  var cm = new CoffeeMachine(1000);
}
// example3()

/*
  Task: Extend Parents methods in Descendant
*/

function example4() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  //1. Overriding method (bad potentially)

  function CoffeeMachine(power, capacity) {
    Machine.apply(this, arguments);

    this.enable = function () {
      //totally new enable
    };
  }

  /* 2. Extending the parent method (better)
        a. Save parent method in variable
        b. define new function (as Overriding method)
        c. call previously saved method with Descendant context passing 
  */

  function Fridge(power, capacity) {
    Machine.apply(this, arguments);

    var parentEnable = this.enable; //a

    this.enable = function () {
      // b
      parentEnable.call(this); // c

      // new extended stuff
    };
  }

  var cm = new CoffeeMachine(1000);
}
// example4()

/*Task 1: 
Make method run causes to error when CM is off
*/

function task1() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function CoffeeMachine(power) {
    Machine.apply(this, arguments); // apply M function with CM arguments

    var onReady = function onReady() {
      console.log("Your coffee is ready!");
    };

    this.run = function () {
      if (!this._isEnabled) {
        throw new Error("CoffeeMachine is turned off.");
      }
      onReady();
    };
  }

  var cm = new CoffeeMachine(1000);
  // cm.run() //Error

  cm.enable();
  cm.run(); //Ok
}
// task1()

/*Task 2:
Stop CM when it disabled
*/

function task3() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function CoffeeMachine(power, capacity) {
    Machine.apply(this, arguments); // apply M function with CM arguments

    var timerID;

    function boilTime() {
      return 3000;
    }

    var onReady = function onReady() {
      console.log("Your coffee is ready!");
    };

    this.run = function () {
      if (!this._isEnabled) {
        throw new Error("CoffeeMachine is turned off.");
      }
      timerID = setTimeout(onReady, boilTime());
    };

    var __disable = this.disable;

    this.disable = function () {
      __disable.call(this);
      clearTimeout(timerID);
      console.log('Turned off. Sorry, no coffee');
    };
  }

  var cm = new CoffeeMachine(1000);

  cm.enable();
  cm.run();
  cm.disable(); // No onReady message
}
// task2()

/*Task 3:
Inherit Fridge from Machine with private food and methods addFood and getFood
food = array
addFood(i[, i1, i2 ...])
getFood()


*/

function task3() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function Fridge(power) {
    Machine.apply(this, arguments);

    var CAPASITY = power / 100;
    var food = [];

    this.addFood = function () {
      if (!this._isEnabled) {
        throw new Error("Can't add food. Fridge is turned off.");
      }

      for (var i = 0; i < arguments.length; i++) {
        if (food.length >= CAPASITY) {
          throw new Error("Can't add " + arguments[i] + ". Max capacity limit.");
        } else {
          food.push(arguments[i]);
        }
      }
    };

    this.getFood = function () {
      return food.slice(); // new array to prevent outside reaching
    };
  }

  var fridge = new Fridge(200);
  // fridge.addFood('Meat') //Error

  fridge.enable(); //Error
  try {
    fridge.addFood('Fish', "Milk", "Bread");
  } catch (e) {
    console.log('Sorry, max capacity');
    console.log(fridge.getFood(), 'add all except overflowed');
  }

  var mutation = fridge.getFood();
  mutation.push('Bread');

  console.log(mutation, 'mutated array');
  console.log(fridge.getFood(), 'no mutation in private property food');
}
// task3()

/*
task 4:
add public filterFood(func)
add public removeFood(item)
*/

function task4() {

  function Machine(power) {
    this._power = power;
    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function Fridge(power) {
    Machine.apply(this, arguments);

    var CAPASITY = power / 100;
    var food = [];

    this.addFood = function () {
      if (!this._isEnabled) {
        throw new Error("Can't add food. Fridge is turned off.");
      }

      for (var i = 0; i < arguments.length; i++) {
        if (food.length >= CAPASITY) {
          throw new Error("Can't add " + arguments[i] + ". Max capacity limit.");
        } else {
          food.push(arguments[i]);
        }
      }
    };

    this.getFood = function () {
      return food.slice(); // new array to prevent outside reaching
    };

    this.filterFood = function (flt) {
      return food.filter(function (i) {
        return flt(i);
      });
    };

    //dump method: works only with items from fridge
    this.removeFood = function (item) {
      food.map(function (i, idx) {
        if (i == item) {
          food.splice(idx, 1);
        }
      });
    };

    // faster with indexOf
    this.removeFood = function (item) {
      var idx = food.indexOf(item);
      if (idx !== -1) food.splice(idx, 1);
    };
  }

  var fridge = new Fridge(500);
  fridge.enable();
  fridge.addFood({
    title: "котлета",
    calories: 100
  });
  fridge.addFood({
    title: "сок",
    calories: 30
  });
  fridge.addFood({
    title: "зелень",
    calories: 10
  });
  fridge.addFood({
    title: "варенье",
    calories: 150
  });

  fridge.removeFood("нет такой еды"); // без эффекта
  console.log(fridge.getFood().length); // 4

  var dietItems = fridge.filterFood(function (item) {
    return item.calories < 50;
  });

  dietItems.forEach(function (item) {
    console.log(item.title); // сок, зелень
    fridge.removeFood(item);
  });

  console.log(fridge.getFood().length); // 2
}
// task4()

/*
task 5:
modify disable method: if food -> error
*/

function task5() {

  function Machine(power) {
    this._power = power;
    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function Fridge(power) {
    Machine.apply(this, arguments);

    var CAPASITY = power / 100;
    var food = [];

    this.addFood = function () {
      if (!this._isEnabled) {
        throw new Error("Can't add food. Fridge is turned off.");
      }

      for (var i = 0; i < arguments.length; i++) {
        if (food.length >= CAPASITY) {
          throw new Error("Can't add " + arguments[i] + ". Max capacity limit.");
        } else {
          food.push(arguments[i]);
        }
      }
    };

    this.getFood = function () {
      return food.slice();
    };

    this.filterFood = function (flt) {
      return food.filter(function (i) {
        return flt(i);
      });
    };

    this.removeFood = function (item) {
      var idx = food.indexOf(item);
      if (idx !== -1) food.splice(idx, 1);
    };

    var __disable = this.disable;

    this.disable = function () {
      if (food.length > 0) {
        throw new Error("Error: Can't disable fridge with food!");
      }

      __disable.call(this);
    };
  }

  var fridge = new Fridge(500);
  fridge.enable();
  fridge.addFood("кус-кус");
  fridge.disable(); // ошибка, в холодильнике есть еда
}
// task5()
//# sourceMappingURL=data:application/json;base64,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RyxDQUFDLENBQUMsQ0FBQztPQUFBLENBQUMsQ0FBQTtLQUNqQyxDQUFBOztBQUVELFFBQUksQ0FBQyxVQUFVLEdBQUcsVUFBUyxJQUFJLEVBQUU7QUFDL0IsVUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUM1QixVQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQTtLQUNwQyxDQUFBOztBQUVELFFBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7O0FBRTVCLFFBQUksQ0FBQyxPQUFPLEdBQUcsWUFBWTtBQUN6QixVQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ25CLGNBQU0sSUFBSSxLQUFLLENBQUMsd0NBQXdDLENBQUMsQ0FBQTtPQUMxRDs7QUFFRCxlQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0tBQ3JCLENBQUE7R0FDRjs7QUFFRCxNQUFJLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUM3QixRQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDaEIsUUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUMxQixRQUFNLENBQUMsT0FBTyxFQUFFO0FBQUMsQ0FDbEI7O0FBQUEiLCJmaWxlIjoib29wX2Z1bmN0aW9uYWwvMDMuaW5oZXJpdGFuY2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKlxuQmFzZSBjbGFzcyBNYWNoaW5lIHJlYWxpemUgY29tbW9uIGVuYWJsZSgpIGFuZCBkaXNhYmxlKCkgbWV0aG9kc1xuXG5Jbmhlcml0IENvZmZlZU1hY2hpbmUgZnJvbSBNYWNoaW5lLCB2aWEgY2FsbCgpXG4qL1xuXG5mdW5jdGlvbiBleGFtcGxlMSAoKSB7XG4gIFxuICBmdW5jdGlvbiBNYWNoaW5lICgpIHtcbiAgICB2YXIgaXNFbmFibGVkID0gZmFsc2VcblxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5pc0VuYWJsZWQgPSB0cnVlXG4gICAgfVxuXG4gICAgdGhpcy5kaXNhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIENvZmZlZU1hY2hpbmUgKCkge1xuICAgIE1hY2hpbmUuY2FsbCh0aGlzKSAvL2luaGVyaXQgbWFjaGluZSBtZXRob2RzXG4gICAgdmFyIHdhdGVyQW1vdW50ID0gMFxuXG4gICAgdGhpcy5zZXRXYXRlckFtb3VudCA9IGZ1bmN0aW9uKGFtb3VudCkge1xuICAgICAgd2F0ZXJBbW91bnQgPSBhbW91bnQ7XG4gICAgfTtcbiAgfVxuXG4gIHZhciBjbSA9IG5ldyBDb2ZmZWVNYWNoaW5lKDEwMDAwKTtcbiAgY20uZW5hYmxlKCk7XG4gIGNtLnNldFdhdGVyQW1vdW50KDEwMCk7XG4gIGNtLmRpc2FibGUoKTtcbn1cbi8vIGV4YW1wbGUxKClcblxuXG5cblxuLypQcm9ibGVtOiBwcml2YXRlIFBhcmVudCBtZXRob2RzIGFyZSB1bmF2YWlsYWJsZSBmcm9tIERlc2NlbmRhbmRcblxuRGVzaWNpb246IG1ha2UgQUxMIFBhcmVudCBtZXRob2RzIHB1YmxpYyAoYXR0YWNoIHRvIHRoaXMpLFxuICAgICAgICAgIGFuZCBkZWZpbmUgcHJpdmF0ZSBtZXRob2RzIHdpdGggdW5kZXJzY29yZSBhdCBzdGFydDogX3ByaXZhdGVNZXRob2RcblxuICAgICAgICAgIEl0J3MgYSBDb252ZW50aW9uIG5vdCBhIFJ1bGUgKGJlIGNhcmVmdWwpXG4qL1xuXG5mdW5jdGlvbiBleGFtcGxlMiAoKSB7XG4gIFxuICBmdW5jdGlvbiBNYWNoaW5lICgpIHtcbiAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZSAvL3RoaXMgaXMgUHJpdmF0ZSBwcm9wZXJ0eTogYWNjZXNzIG9ubHkgZnJvbSBQYXJlbnQgYW5kIERlc2NlbmRhbnRzLCBubyBvdXRzaWRlIVxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZVxuICAgIH1cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIENvZmZlZU1hY2hpbmUgKCkge1xuICAgIE1hY2hpbmUuY2FsbCh0aGlzKSAvL2luaGVyaXQgbWFjaGluZSBtZXRob2RzXG4gICAgdGhpcy5lbmFibGUoKVxuICAgIGNvbnNvbGUubG9nKHRoaXMuX2lzRW5hYmxlZClcbiAgfVxuXG4gIHZhciBjbSA9IG5ldyBDb2ZmZWVNYWNoaW5lKDEwMDAwKTtcbn1cbi8vIGV4YW1wbGUyKClcblxuXG5cblxuXG5cbi8qXG4gIFRhc2s6IGFkZCBwb3dlciBhcmd1bWVudCB0byBhbGwgbWFjaGluZXNcblxuICB1c2UgUGFyZW50LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyksIHRvIGludm9rZSBQYXJlbnQgaW5zaWRlIERlc2NlbmRhbnRcbiAgd2l0aCBjb3JyZWN0IGNvbnRleHQgYW5kIHBhcmFtZXRlcnMgcGFzc2VkIHRvIERlc2NlbmRhbnRcblxuKi9cblxuZnVuY3Rpb24gZXhhbXBsZTMoKSB7XG5cbiAgZnVuY3Rpb24gTWFjaGluZSAocG93ZXIpIHtcbiAgICB0aGlzLl9wb3dlciA9IHBvd2VyXG5cbiAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZVxuICAgIH1cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIENvZmZlZU1hY2hpbmUgKHBvd2VyKSB7XG4gICAgTWFjaGluZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIC8vIGFwcGx5IE0gZnVuY3Rpb24gd2l0aCBDTSBhcmd1bWVudHNcblxuICAgIGNvbnNvbGUubG9nKHRoaXMuX2lzRW5hYmxlZCk7XG4gICAgY29uc29sZS5sb2codGhpcy5fcG93ZXIpO1xuICB9XG5cbiAgdmFyIGNtID0gbmV3IENvZmZlZU1hY2hpbmUoMTAwMClcbn1cbi8vIGV4YW1wbGUzKClcblxuXG5cblxuLypcbiAgVGFzazogRXh0ZW5kIFBhcmVudHMgbWV0aG9kcyBpbiBEZXNjZW5kYW50XG4qL1xuXG5cblxuZnVuY3Rpb24gZXhhbXBsZTQoKSB7XG5cbiAgZnVuY3Rpb24gTWFjaGluZSAocG93ZXIpIHtcbiAgICB0aGlzLl9wb3dlciA9IHBvd2VyXG5cbiAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZVxuICAgIH1cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIC8vMS4gT3ZlcnJpZGluZyBtZXRob2QgKGJhZCBwb3RlbnRpYWxseSlcblxuICBmdW5jdGlvbiBDb2ZmZWVNYWNoaW5lIChwb3dlciwgY2FwYWNpdHkpIHtcbiAgICBNYWNoaW5lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcblxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgICAvL3RvdGFsbHkgbmV3IGVuYWJsZVxuICAgIH1cbiAgfVxuXG5cbiAgLyogMi4gRXh0ZW5kaW5nIHRoZSBwYXJlbnQgbWV0aG9kIChiZXR0ZXIpXG4gICAgICAgIGEuIFNhdmUgcGFyZW50IG1ldGhvZCBpbiB2YXJpYWJsZVxuICAgICAgICBiLiBkZWZpbmUgbmV3IGZ1bmN0aW9uIChhcyBPdmVycmlkaW5nIG1ldGhvZClcbiAgICAgICAgYy4gY2FsbCBwcmV2aW91c2x5IHNhdmVkIG1ldGhvZCB3aXRoIERlc2NlbmRhbnQgY29udGV4dCBwYXNzaW5nIFxuICAqL1xuXG5cbiAgZnVuY3Rpb24gRnJpZGdlIChwb3dlciwgY2FwYWNpdHkpIHtcbiAgICBNYWNoaW5lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcblxuICAgIHZhciBwYXJlbnRFbmFibGUgPSB0aGlzLmVuYWJsZSAgLy9hXG5cbiAgICB0aGlzLmVuYWJsZSA9IGZ1bmN0aW9uKCkgeyAvLyBiXG4gICAgICBwYXJlbnRFbmFibGUuY2FsbCh0aGlzKSAvLyBjXG4gICAgICBcbiAgICAgIC8vIG5ldyBleHRlbmRlZCBzdHVmZlxuICAgIH1cbiAgfVxuXG5cblxuICB2YXIgY20gPSBuZXcgQ29mZmVlTWFjaGluZSgxMDAwKVxufVxuLy8gZXhhbXBsZTQoKVxuXG5cblxuXG5cbi8qVGFzayAxOiBcbk1ha2UgbWV0aG9kIHJ1biBjYXVzZXMgdG8gZXJyb3Igd2hlbiBDTSBpcyBvZmZcbiovXG5cbmZ1bmN0aW9uIHRhc2sxKCkge1xuXG4gIGZ1bmN0aW9uIE1hY2hpbmUgKHBvd2VyKSB7XG4gICAgdGhpcy5fcG93ZXIgPSBwb3dlclxuXG4gICAgdGhpcy5faXNFbmFibGVkID0gZmFsc2VcbiAgICB0aGlzLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IHRydWVcbiAgICB9XG4gICAgdGhpcy5kaXNhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gZmFsc2VcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBDb2ZmZWVNYWNoaW5lIChwb3dlcikge1xuICAgIE1hY2hpbmUuYXBwbHkodGhpcywgYXJndW1lbnRzKSAvLyBhcHBseSBNIGZ1bmN0aW9uIHdpdGggQ00gYXJndW1lbnRzXG5cbiAgICB2YXIgb25SZWFkeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiWW91ciBjb2ZmZWUgaXMgcmVhZHkhXCIpO1xuICAgIH1cblxuICAgIHRoaXMucnVuID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb2ZmZWVNYWNoaW5lIGlzIHR1cm5lZCBvZmYuXCIpXG4gICAgICB9XG4gICAgICBvblJlYWR5KClcbiAgICB9XG4gIH1cblxuICB2YXIgY20gPSBuZXcgQ29mZmVlTWFjaGluZSgxMDAwKVxuICAvLyBjbS5ydW4oKSAvL0Vycm9yXG5cbiAgY20uZW5hYmxlKClcbiAgY20ucnVuKCkgLy9Pa1xufVxuLy8gdGFzazEoKVxuXG5cblxuLypUYXNrIDI6XG5TdG9wIENNIHdoZW4gaXQgZGlzYWJsZWRcbiovXG5cbmZ1bmN0aW9uIHRhc2szKCkge1xuXG4gIGZ1bmN0aW9uIE1hY2hpbmUgKHBvd2VyKSB7XG4gICAgdGhpcy5fcG93ZXIgPSBwb3dlclxuXG4gICAgdGhpcy5faXNFbmFibGVkID0gZmFsc2VcbiAgICB0aGlzLmVuYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IHRydWVcbiAgICB9XG4gICAgdGhpcy5kaXNhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gZmFsc2VcbiAgICB9XG4gIH1cblxuICBmdW5jdGlvbiBDb2ZmZWVNYWNoaW5lIChwb3dlciwgY2FwYWNpdHkpIHtcbiAgICBNYWNoaW5lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgLy8gYXBwbHkgTSBmdW5jdGlvbiB3aXRoIENNIGFyZ3VtZW50c1xuXG4gICAgdmFyIHRpbWVySUQ7XG5cbiAgICBmdW5jdGlvbiBib2lsVGltZSgpIHtcbiAgICAgIHJldHVybiAzMDAwXG4gICAgfVxuXG4gICAgdmFyIG9uUmVhZHkgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIllvdXIgY29mZmVlIGlzIHJlYWR5IVwiKTtcbiAgICB9XG5cbiAgICB0aGlzLnJ1biA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKCF0aGlzLl9pc0VuYWJsZWQpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ29mZmVlTWFjaGluZSBpcyB0dXJuZWQgb2ZmLlwiKVxuICAgICAgfVxuICAgICAgdGltZXJJRCA9IHNldFRpbWVvdXQob25SZWFkeSwgYm9pbFRpbWUoKSk7XG4gICAgfVxuXG4gICAgdmFyIF9fZGlzYWJsZSA9IHRoaXMuZGlzYWJsZVxuXG4gICAgdGhpcy5kaXNhYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgX19kaXNhYmxlLmNhbGwodGhpcylcbiAgICAgIGNsZWFyVGltZW91dCh0aW1lcklEKVxuICAgICAgY29uc29sZS5sb2coJ1R1cm5lZCBvZmYuIFNvcnJ5LCBubyBjb2ZmZWUnKTtcbiAgICB9XG4gIH1cblxuICB2YXIgY20gPSBuZXcgQ29mZmVlTWFjaGluZSgxMDAwKVxuXG4gIGNtLmVuYWJsZSgpXG4gIGNtLnJ1bigpIFxuICBjbS5kaXNhYmxlKCkgLy8gTm8gb25SZWFkeSBtZXNzYWdlXG59XG4vLyB0YXNrMigpXG5cblxuXG4vKlRhc2sgMzpcbkluaGVyaXQgRnJpZGdlIGZyb20gTWFjaGluZSB3aXRoIHByaXZhdGUgZm9vZCBhbmQgbWV0aG9kcyBhZGRGb29kIGFuZCBnZXRGb29kXG5mb29kID0gYXJyYXlcbmFkZEZvb2QoaVssIGkxLCBpMiAuLi5dKVxuZ2V0Rm9vZCgpXG5cblxuKi9cblxuZnVuY3Rpb24gdGFzazMoKSB7XG5cbiAgZnVuY3Rpb24gTWFjaGluZSAocG93ZXIpIHtcbiAgICB0aGlzLl9wb3dlciA9IHBvd2VyXG5cbiAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZVxuICAgIH1cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIEZyaWRnZSAocG93ZXIpIHtcbiAgICBNYWNoaW5lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcblxuICAgIHZhciBDQVBBU0lUWSA9IHBvd2VyIC8gMTAwXG4gICAgdmFyIGZvb2QgPSBbXVxuXG4gICAgdGhpcy5hZGRGb29kID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBhZGQgZm9vZC4gRnJpZGdlIGlzIHR1cm5lZCBvZmYuXCIpXG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChmb29kLmxlbmd0aCA+PSBDQVBBU0lUWSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGFkZCBcIiArIGFyZ3VtZW50c1tpXSArIFwiLiBNYXggY2FwYWNpdHkgbGltaXQuXCIpICBcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb29kLnB1c2goYXJndW1lbnRzW2ldKSAgXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmdldEZvb2QgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBmb29kLnNsaWNlKCkgLy8gbmV3IGFycmF5IHRvIHByZXZlbnQgb3V0c2lkZSByZWFjaGluZ1xuICAgIH1cbiAgfVxuICBcbiAgdmFyIGZyaWRnZSA9IG5ldyBGcmlkZ2UoMjAwKVxuICAvLyBmcmlkZ2UuYWRkRm9vZCgnTWVhdCcpIC8vRXJyb3JcblxuICBmcmlkZ2UuZW5hYmxlKCkgLy9FcnJvclxuICB0cnkge1xuICAgIGZyaWRnZS5hZGRGb29kKCdGaXNoJywgXCJNaWxrXCIsIFwiQnJlYWRcIilcbiAgfSBjYXRjaChlKSB7XG4gICAgY29uc29sZS5sb2coJ1NvcnJ5LCBtYXggY2FwYWNpdHknKTtcbiAgICBjb25zb2xlLmxvZyhmcmlkZ2UuZ2V0Rm9vZCgpLCAnYWRkIGFsbCBleGNlcHQgb3ZlcmZsb3dlZCcpXG4gIH1cbiAgXG4gIHZhciBtdXRhdGlvbiA9IGZyaWRnZS5nZXRGb29kKClcbiAgbXV0YXRpb24ucHVzaCgnQnJlYWQnKVxuXG4gIGNvbnNvbGUubG9nKG11dGF0aW9uLCAnbXV0YXRlZCBhcnJheScpXG4gIGNvbnNvbGUubG9nKGZyaWRnZS5nZXRGb29kKCksICdubyBtdXRhdGlvbiBpbiBwcml2YXRlIHByb3BlcnR5IGZvb2QnKVxufVxuLy8gdGFzazMoKVxuXG5cblxuLypcbnRhc2sgNDpcbmFkZCBwdWJsaWMgZmlsdGVyRm9vZChmdW5jKVxuYWRkIHB1YmxpYyByZW1vdmVGb29kKGl0ZW0pXG4qL1xuXG5mdW5jdGlvbiB0YXNrNCgpIHtcblxuICBmdW5jdGlvbiBNYWNoaW5lIChwb3dlcikge1xuICAgIHRoaXMuX3Bvd2VyID0gcG93ZXJcbiAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZVxuICAgIH1cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIEZyaWRnZSAocG93ZXIpIHtcbiAgICBNYWNoaW5lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcblxuICAgIHZhciBDQVBBU0lUWSA9IHBvd2VyIC8gMTAwXG4gICAgdmFyIGZvb2QgPSBbXVxuXG4gICAgdGhpcy5hZGRGb29kID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBhZGQgZm9vZC4gRnJpZGdlIGlzIHR1cm5lZCBvZmYuXCIpXG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChmb29kLmxlbmd0aCA+PSBDQVBBU0lUWSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGFkZCBcIiArIGFyZ3VtZW50c1tpXSArIFwiLiBNYXggY2FwYWNpdHkgbGltaXQuXCIpICBcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb29kLnB1c2goYXJndW1lbnRzW2ldKSAgXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmdldEZvb2QgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBmb29kLnNsaWNlKCkgLy8gbmV3IGFycmF5IHRvIHByZXZlbnQgb3V0c2lkZSByZWFjaGluZ1xuICAgIH1cblxuICAgIHRoaXMuZmlsdGVyRm9vZCA9IGZ1bmN0aW9uKGZsdCkge1xuICAgICAgcmV0dXJuIGZvb2QuZmlsdGVyKCBpID0+IGZsdChpKSlcbiAgICB9XG5cbiAgICAvL2R1bXAgbWV0aG9kOiB3b3JrcyBvbmx5IHdpdGggaXRlbXMgZnJvbSBmcmlkZ2VcbiAgICB0aGlzLnJlbW92ZUZvb2QgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICBmb29kLm1hcCggKGksIGlkeCkgPT4ge1xuICAgICAgICBpZiAoaSA9PSBpdGVtKSB7XG4gICAgICAgICAgZm9vZC5zcGxpY2UoaWR4LCAxKVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH1cblxuICAgIC8vIGZhc3RlciB3aXRoIGluZGV4T2ZcbiAgICB0aGlzLnJlbW92ZUZvb2QgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICB2YXIgaWR4ID0gZm9vZC5pbmRleE9mKGl0ZW0pXG4gICAgICBpZiAoaWR4ICE9PSAtMSkgZm9vZC5zcGxpY2UoaWR4LCAxKVxuICAgIH1cbiAgfVxuICBcbiAgdmFyIGZyaWRnZSA9IG5ldyBGcmlkZ2UoNTAwKTtcbiAgZnJpZGdlLmVuYWJsZSgpO1xuICBmcmlkZ2UuYWRkRm9vZCh7XG4gICAgdGl0bGU6IFwi0LrQvtGC0LvQtdGC0LBcIixcbiAgICBjYWxvcmllczogMTAwXG4gIH0pO1xuICBmcmlkZ2UuYWRkRm9vZCh7XG4gICAgdGl0bGU6IFwi0YHQvtC6XCIsXG4gICAgY2Fsb3JpZXM6IDMwXG4gIH0pO1xuICBmcmlkZ2UuYWRkRm9vZCh7XG4gICAgdGl0bGU6IFwi0LfQtdC70LXQvdGMXCIsXG4gICAgY2Fsb3JpZXM6IDEwXG4gIH0pO1xuICBmcmlkZ2UuYWRkRm9vZCh7XG4gICAgdGl0bGU6IFwi0LLQsNGA0LXQvdGM0LVcIixcbiAgICBjYWxvcmllczogMTUwXG4gIH0pO1xuXG4gIGZyaWRnZS5yZW1vdmVGb29kKFwi0L3QtdGCINGC0LDQutC+0Lkg0LXQtNGLXCIpOyAvLyDQsdC10Lcg0Y3RhNGE0LXQutGC0LBcbiAgY29uc29sZS5sb2coIGZyaWRnZS5nZXRGb29kKCkubGVuZ3RoKTsgLy8gNFxuXG4gIHZhciBkaWV0SXRlbXMgPSBmcmlkZ2UuZmlsdGVyRm9vZChmdW5jdGlvbihpdGVtKSB7XG4gICAgcmV0dXJuIGl0ZW0uY2Fsb3JpZXMgPCA1MDtcbiAgfSk7XG5cbiAgZGlldEl0ZW1zLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgIGNvbnNvbGUubG9nKCBpdGVtLnRpdGxlICk7IC8vINGB0L7Quiwg0LfQtdC70LXQvdGMXG4gICAgZnJpZGdlLnJlbW92ZUZvb2QoaXRlbSk7XG4gIH0pO1xuXG4gIGNvbnNvbGUubG9nKCBmcmlkZ2UuZ2V0Rm9vZCgpLmxlbmd0aCApOyAvLyAyXG5cbn1cbi8vIHRhc2s0KClcblxuXG5cblxuXG4vKlxudGFzayA1OlxubW9kaWZ5IGRpc2FibGUgbWV0aG9kOiBpZiBmb29kIC0+IGVycm9yXG4qL1xuXG5mdW5jdGlvbiB0YXNrNSgpIHtcblxuICBmdW5jdGlvbiBNYWNoaW5lIChwb3dlcikge1xuICAgIHRoaXMuX3Bvd2VyID0gcG93ZXJcbiAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZVxuICAgIH1cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIEZyaWRnZSAocG93ZXIpIHtcbiAgICBNYWNoaW5lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcblxuICAgIHZhciBDQVBBU0lUWSA9IHBvd2VyIC8gMTAwXG4gICAgdmFyIGZvb2QgPSBbXVxuXG4gICAgdGhpcy5hZGRGb29kID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBhZGQgZm9vZC4gRnJpZGdlIGlzIHR1cm5lZCBvZmYuXCIpXG4gICAgICB9XG5cbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgIGlmIChmb29kLmxlbmd0aCA+PSBDQVBBU0lUWSkge1xuICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGFkZCBcIiArIGFyZ3VtZW50c1tpXSArIFwiLiBNYXggY2FwYWNpdHkgbGltaXQuXCIpICBcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBmb29kLnB1c2goYXJndW1lbnRzW2ldKSAgXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICB0aGlzLmdldEZvb2QgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiBmb29kLnNsaWNlKClcbiAgICB9XG5cbiAgICB0aGlzLmZpbHRlckZvb2QgPSBmdW5jdGlvbihmbHQpIHtcbiAgICAgIHJldHVybiBmb29kLmZpbHRlciggaSA9PiBmbHQoaSkpXG4gICAgfVxuXG4gICAgdGhpcy5yZW1vdmVGb29kID0gZnVuY3Rpb24oaXRlbSkge1xuICAgICAgdmFyIGlkeCA9IGZvb2QuaW5kZXhPZihpdGVtKVxuICAgICAgaWYgKGlkeCAhPT0gLTEpIGZvb2Quc3BsaWNlKGlkeCwgMSlcbiAgICB9XG5cbiAgICB2YXIgX19kaXNhYmxlID0gdGhpcy5kaXNhYmxlXG5cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBpZiAoZm9vZC5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkVycm9yOiBDYW4ndCBkaXNhYmxlIGZyaWRnZSB3aXRoIGZvb2QhXCIpXG4gICAgICB9XG5cbiAgICAgIF9fZGlzYWJsZS5jYWxsKHRoaXMpXG4gICAgfVxuICB9XG4gIFxuICB2YXIgZnJpZGdlID0gbmV3IEZyaWRnZSg1MDApO1xuICBmcmlkZ2UuZW5hYmxlKCk7XG4gIGZyaWRnZS5hZGRGb29kKFwi0LrRg9GBLdC60YPRgVwiKTtcbiAgZnJpZGdlLmRpc2FibGUoKTsgLy8g0L7RiNC40LHQutCwLCDQsiDRhdC+0LvQvtC00LjQu9GM0L3QuNC60LUg0LXRgdGC0Ywg0LXQtNCwXG59XG4vLyB0YXNrNSgpXG5cblxuXG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
