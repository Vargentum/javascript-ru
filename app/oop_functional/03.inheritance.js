"use strict";

/*
Base class Machine realize common enable() and disable() methods

Inherit CoffeeMachine from Machine, via call()
*/

function example1() {

  function Machine() {
    var isEnabled = false;

    this.enable = function () {
      this.isEnabled = true;
    };

    this.disable = function () {
      this.isEnabled = false;
    };
  }

  function CoffeeMachine() {
    Machine.call(this); //inherit machine methods
    var waterAmount = 0;

    this.setWaterAmount = function (amount) {
      waterAmount = amount;
    };
  }

  var cm = new CoffeeMachine(10000);
  cm.enable();
  cm.setWaterAmount(100);
  cm.disable();
}
// example1()

/*Problem: private Parent methods are unavailable from Descendand

Desicion: make ALL Parent methods public (attach to this),
          and define private methods with underscore at start: _privateMethod

          It's a Convention not a Rule (be careful)
*/

function example2() {

  function Machine() {
    this._isEnabled = false; //this is Private property: access only from Parent and Descendants, no outside!
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function CoffeeMachine() {
    Machine.call(this); //inherit machine methods
    this.enable();
    console.log(this._isEnabled);
  }

  var cm = new CoffeeMachine(10000);
}
// example2()

/*
  Task: add power argument to all machines

  use Parent.apply(this, arguments), to invoke Parent inside Descendant
  with correct context and parameters passed to Descendant

*/

function example3() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function CoffeeMachine(power) {
    Machine.apply(this, arguments); // apply M function with CM arguments

    console.log(this._isEnabled);
    console.log(this._power);
  }

  var cm = new CoffeeMachine(1000);
}
// example3()

/*
  Task: Extend Parents methods in Descendant
*/

function example4() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  //1. Overriding method (bad potentially)

  function CoffeeMachine(power, capacity) {
    Machine.apply(this, arguments);

    this.enable = function () {
      //totally new enable
    };
  }

  /* 2. Extending the parent method (better)
        a. Save parent method in variable
        b. define new function (as Overriding method)
        c. call previously saved method with Descendant context passing 
  */

  function Fridge(power, capacity) {
    Machine.apply(this, arguments);

    var parentEnable = this.enable; //a

    this.enable = function () {
      // b
      parentEnable.call(this); // c

      // new extended stuff
    };
  }

  var cm = new CoffeeMachine(1000);
}
// example4()

/*Task 1: 
Make method run causes to error when CM is off
*/

function task1() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function CoffeeMachine(power) {
    Machine.apply(this, arguments); // apply M function with CM arguments

    var onReady = function onReady() {
      console.log("Your coffee is ready!");
    };

    this.run = function () {
      if (!this._isEnabled) {
        throw new Error("CoffeeMachine is turned off.");
      }
      onReady();
    };
  }

  var cm = new CoffeeMachine(1000);
  // cm.run() //Error

  cm.enable();
  cm.run(); //Ok
}
// task1()

/*Task 2:
Stop CM when it disabled
*/

function task3() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function CoffeeMachine(power, capacity) {
    Machine.apply(this, arguments); // apply M function with CM arguments

    var timerID;

    function boilTime() {
      return 3000;
    }

    var onReady = function onReady() {
      console.log("Your coffee is ready!");
    };

    this.run = function () {
      if (!this._isEnabled) {
        throw new Error("CoffeeMachine is turned off.");
      }
      timerID = setTimeout(onReady, boilTime());
    };

    var __disable = this.disable;

    this.disable = function () {
      __disable.call(this);
      clearTimeout(timerID);
      console.log('Turned off. Sorry, no coffee');
    };
  }

  var cm = new CoffeeMachine(1000);

  cm.enable();
  cm.run();
  cm.disable(); // No onReady message
}
// task2()

/*Task 3:
Inherit Fridge from Machine with private food and methods addFood and getFood
food = array
addFood(i[, i1, i2 ...])
getFood()


*/

function task3() {

  function Machine(power) {
    this._power = power;

    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function Fridge(power) {
    Machine.apply(this, arguments);

    var CAPASITY = power / 100;
    var food = [];

    this.addFood = function () {
      if (!this._isEnabled) {
        throw new Error("Can't add food. Fridge is turned off.");
      }

      for (var i = 0; i < arguments.length; i++) {
        if (food.length >= CAPASITY) {
          throw new Error("Can't add " + arguments[i] + ". Max capacity limit.");
        } else {
          food.push(arguments[i]);
        }
      }
    };

    this.getFood = function () {
      return food.slice(); // new array to prevent outside reaching
    };
  }

  var fridge = new Fridge(200);
  // fridge.addFood('Meat') //Error

  fridge.enable(); //Error
  try {
    fridge.addFood('Fish', "Milk", "Bread");
  } catch (e) {
    console.log('Sorry, max capacity');
    console.log(fridge.getFood(), 'add all except overflowed');
  }

  var mutation = fridge.getFood();
  mutation.push('Bread');

  console.log(mutation, 'mutated array');
  console.log(fridge.getFood(), 'no mutation in private property food');
}
// task3()

/*
task 4:
add public filterFood(func)
add public removeFood(item)
*/

function task4() {

  function Machine(power) {
    this._power = power;
    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function Fridge(power) {
    Machine.apply(this, arguments);

    var CAPASITY = power / 100;
    var food = [];

    this.addFood = function () {
      if (!this._isEnabled) {
        throw new Error("Can't add food. Fridge is turned off.");
      }

      for (var i = 0; i < arguments.length; i++) {
        if (food.length >= CAPASITY) {
          throw new Error("Can't add " + arguments[i] + ". Max capacity limit.");
        } else {
          food.push(arguments[i]);
        }
      }
    };

    this.getFood = function () {
      return food.slice(); // new array to prevent outside reaching
    };

    this.filterFood = function (flt) {
      return food.filter(function (i) {
        return flt(i);
      });
    };

    //dump method: works only with items from fridge
    this.removeFood = function (item) {
      food.map(function (i, idx) {
        if (i == item) {
          food.splice(idx, 1);
        }
      });
    };

    // faster with indexOf
    this.removeFood = function (item) {
      var idx = food.indexOf(item);
      if (idx !== -1) food.splice(idx, 1);
    };
  }

  var fridge = new Fridge(500);
  fridge.enable();
  fridge.addFood({
    title: "котлета",
    calories: 100
  });
  fridge.addFood({
    title: "сок",
    calories: 30
  });
  fridge.addFood({
    title: "зелень",
    calories: 10
  });
  fridge.addFood({
    title: "варенье",
    calories: 150
  });

  fridge.removeFood("нет такой еды"); // без эффекта
  console.log(fridge.getFood().length); // 4

  var dietItems = fridge.filterFood(function (item) {
    return item.calories < 50;
  });

  dietItems.forEach(function (item) {
    console.log(item.title); // сок, зелень
    fridge.removeFood(item);
  });

  console.log(fridge.getFood().length); // 2
}
// task4()

/*
task 5:
modify disable method: if food -> error
*/

function task5() {

  function Machine(power) {
    this._power = power;
    this._isEnabled = false;
    this.enable = function () {
      this._isEnabled = true;
    };
    this.disable = function () {
      this._isEnabled = false;
    };
  }

  function Fridge(power) {
    Machine.apply(this, arguments);

    var CAPASITY = power / 100;
    var food = [];

    this.addFood = function () {
      if (!this._isEnabled) {
        throw new Error("Can't add food. Fridge is turned off.");
      }

      for (var i = 0; i < arguments.length; i++) {
        if (food.length >= CAPASITY) {
          throw new Error("Can't add " + arguments[i] + ". Max capacity limit.");
        } else {
          food.push(arguments[i]);
        }
      }
    };

    this.getFood = function () {
      return food.slice();
    };

    this.filterFood = function (flt) {
      return food.filter(function (i) {
        return flt(i);
      });
    };

    this.removeFood = function (item) {
      var idx = food.indexOf(item);
      if (idx !== -1) food.splice(idx, 1);
    };

    var __disable = this.disable;

    this.disable = function () {
      if (food.length > 0) {
        throw new Error("Error: Can't disable fridge with food!");
      }

      __disable.call(this);
    };
  }

  var fridge = new Fridge(500);
  fridge.enable();
  fridge.addFood("кус-кус");
  fridge.disable(); // ошибка, в холодильнике есть еда
}
task5();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIjAzLmluaGVyaXRhbmNlLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBTUEsU0FBUyxRQUFRLEdBQUk7O0FBRW5CLFdBQVMsT0FBTyxHQUFJO0FBQ2xCLFFBQUksU0FBUyxHQUFHLEtBQUssQ0FBQTs7QUFFckIsUUFBSSxDQUFDLE1BQU0sR0FBRyxZQUFZO0FBQ3hCLFVBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFBO0tBQ3RCLENBQUE7O0FBRUQsUUFBSSxDQUFDLE9BQU8sR0FBRyxZQUFZO0FBQ3pCLFVBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSyxDQUFBO0tBQ3ZCLENBQUE7R0FDRjs7QUFFRCxXQUFTLGFBQWEsR0FBSTtBQUN4QixXQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQztBQUFBLEFBQ2xCLFFBQUksV0FBVyxHQUFHLENBQUMsQ0FBQTs7QUFFbkIsUUFBSSxDQUFDLGNBQWMsR0FBRyxVQUFTLE1BQU0sRUFBRTtBQUNyQyxpQkFBVyxHQUFHLE1BQU0sQ0FBQztLQUN0QixDQUFDO0dBQ0g7O0FBRUQsTUFBSSxFQUFFLEdBQUcsSUFBSSxhQUFhLENBQUMsS0FBSyxDQUFDLENBQUM7QUFDbEMsSUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFDO0FBQ1osSUFBRSxDQUFDLGNBQWMsQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUN2QixJQUFFLENBQUMsT0FBTyxFQUFFLENBQUM7Q0FDZDs7Ozs7Ozs7Ozs7QUFBQSxBQWNELFNBQVMsUUFBUSxHQUFJOztBQUVuQixXQUFTLE9BQU8sR0FBSTtBQUNsQixRQUFJLENBQUMsVUFBVSxHQUFHLEtBQUs7QUFBQSxBQUN2QixRQUFJLENBQUMsTUFBTSxHQUFHLFlBQVk7QUFDeEIsVUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUE7S0FDdkIsQ0FBQTtBQUNELFFBQUksQ0FBQyxPQUFPLEdBQUcsWUFBWTtBQUN6QixVQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQTtLQUN4QixDQUFBO0dBQ0Y7O0FBRUQsV0FBUyxhQUFhLEdBQUk7QUFDeEIsV0FBTyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUM7QUFBQSxBQUNsQixRQUFJLENBQUMsTUFBTSxFQUFFLENBQUE7QUFDYixXQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQTtHQUM3Qjs7QUFFRCxNQUFJLEVBQUUsR0FBRyxJQUFJLGFBQWEsQ0FBQyxLQUFLLENBQUMsQ0FBQztDQUNuQzs7Ozs7Ozs7Ozs7QUFBQSxBQWdCRCxTQUFTLFFBQVEsR0FBRzs7QUFFbEIsV0FBUyxPQUFPLENBQUUsS0FBSyxFQUFFO0FBQ3ZCLFFBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFBOztBQUVuQixRQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQTtBQUN2QixRQUFJLENBQUMsTUFBTSxHQUFHLFlBQVk7QUFDeEIsVUFBSSxDQUFDLFVBQVUsR0FBRyxJQUFJLENBQUE7S0FDdkIsQ0FBQTtBQUNELFFBQUksQ0FBQyxPQUFPLEdBQUcsWUFBWTtBQUN6QixVQUFJLENBQUMsVUFBVSxHQUFHLEtBQUssQ0FBQTtLQUN4QixDQUFBO0dBQ0Y7O0FBRUQsV0FBUyxhQUFhLENBQUUsS0FBSyxFQUFFO0FBQzdCLFdBQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQzs7QUFBQSxBQUU5QixXQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztBQUM3QixXQUFPLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsQ0FBQztHQUMxQjs7QUFFRCxNQUFJLEVBQUUsR0FBRyxJQUFJLGFBQWEsQ0FBQyxJQUFJLENBQUMsQ0FBQTtDQUNqQzs7Ozs7OztBQUFBLEFBWUQsU0FBUyxRQUFRLEdBQUc7O0FBRWxCLFdBQVMsT0FBTyxDQUFFLEtBQUssRUFBRTtBQUN2QixRQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQTs7QUFFbkIsUUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUE7QUFDdkIsUUFBSSxDQUFDLE1BQU0sR0FBRyxZQUFZO0FBQ3hCLFVBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFBO0tBQ3ZCLENBQUE7QUFDRCxRQUFJLENBQUMsT0FBTyxHQUFHLFlBQVk7QUFDekIsVUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUE7S0FDeEIsQ0FBQTtHQUNGOzs7O0FBQUEsQUFJRCxXQUFTLGFBQWEsQ0FBRSxLQUFLLEVBQUUsUUFBUSxFQUFFO0FBQ3ZDLFdBQU8sQ0FBQyxLQUFLLENBQUMsSUFBSSxFQUFFLFNBQVMsQ0FBQyxDQUFBOztBQUU5QixRQUFJLENBQUMsTUFBTSxHQUFHLFlBQVc7O0tBRXhCLENBQUE7R0FDRjs7Ozs7Ozs7QUFBQSxBQVVELFdBQVMsTUFBTSxDQUFFLEtBQUssRUFBRSxRQUFRLEVBQUU7QUFDaEMsV0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUE7O0FBRTlCLFFBQUksWUFBWSxHQUFHLElBQUksQ0FBQyxNQUFNOztBQUFBLEFBRTlCLFFBQUksQ0FBQyxNQUFNLEdBQUcsWUFBVzs7QUFDdkIsa0JBQVksQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDOzs7QUFBQSxLQUd4QixDQUFBO0dBQ0Y7O0FBSUQsTUFBSSxFQUFFLEdBQUcsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUE7Q0FDakM7Ozs7Ozs7QUFBQSxBQVdELFNBQVMsS0FBSyxHQUFHOztBQUVmLFdBQVMsT0FBTyxDQUFFLEtBQUssRUFBRTtBQUN2QixRQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQTs7QUFFbkIsUUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUE7QUFDdkIsUUFBSSxDQUFDLE1BQU0sR0FBRyxZQUFZO0FBQ3hCLFVBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFBO0tBQ3ZCLENBQUE7QUFDRCxRQUFJLENBQUMsT0FBTyxHQUFHLFlBQVk7QUFDekIsVUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUE7S0FDeEIsQ0FBQTtHQUNGOztBQUVELFdBQVMsYUFBYSxDQUFFLEtBQUssRUFBRTtBQUM3QixXQUFPLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUM7O0FBQUEsQUFFOUIsUUFBSSxPQUFPLEdBQUcsU0FBVixPQUFPLEdBQWU7QUFDeEIsYUFBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0tBQ3RDLENBQUE7O0FBRUQsUUFBSSxDQUFDLEdBQUcsR0FBRyxZQUFXO0FBQ3BCLFVBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO0FBQ3BCLGNBQU0sSUFBSSxLQUFLLENBQUMsOEJBQThCLENBQUMsQ0FBQTtPQUNoRDtBQUNELGFBQU8sRUFBRSxDQUFBO0tBQ1YsQ0FBQTtHQUNGOztBQUVELE1BQUksRUFBRSxHQUFHLElBQUksYUFBYSxDQUFDLElBQUksQ0FBQzs7O0FBQUEsQUFHaEMsSUFBRSxDQUFDLE1BQU0sRUFBRSxDQUFBO0FBQ1gsSUFBRSxDQUFDLEdBQUcsRUFBRTtBQUFBLENBQ1Q7Ozs7Ozs7QUFBQSxBQVNELFNBQVMsS0FBSyxHQUFHOztBQUVmLFdBQVMsT0FBTyxDQUFFLEtBQUssRUFBRTtBQUN2QixRQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQTs7QUFFbkIsUUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUE7QUFDdkIsUUFBSSxDQUFDLE1BQU0sR0FBRyxZQUFZO0FBQ3hCLFVBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFBO0tBQ3ZCLENBQUE7QUFDRCxRQUFJLENBQUMsT0FBTyxHQUFHLFlBQVk7QUFDekIsVUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUE7S0FDeEIsQ0FBQTtHQUNGOztBQUVELFdBQVMsYUFBYSxDQUFFLEtBQUssRUFBRSxRQUFRLEVBQUU7QUFDdkMsV0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDOztBQUFBLEFBRTlCLFFBQUksT0FBTyxDQUFDOztBQUVaLGFBQVMsUUFBUSxHQUFHO0FBQ2xCLGFBQU8sSUFBSSxDQUFBO0tBQ1o7O0FBRUQsUUFBSSxPQUFPLEdBQUcsU0FBVixPQUFPLEdBQWU7QUFDeEIsYUFBTyxDQUFDLEdBQUcsQ0FBQyx1QkFBdUIsQ0FBQyxDQUFDO0tBQ3RDLENBQUE7O0FBRUQsUUFBSSxDQUFDLEdBQUcsR0FBRyxZQUFXO0FBQ3BCLFVBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO0FBQ3BCLGNBQU0sSUFBSSxLQUFLLENBQUMsOEJBQThCLENBQUMsQ0FBQTtPQUNoRDtBQUNELGFBQU8sR0FBRyxVQUFVLENBQUMsT0FBTyxFQUFFLFFBQVEsRUFBRSxDQUFDLENBQUM7S0FDM0MsQ0FBQTs7QUFFRCxRQUFJLFNBQVMsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFBOztBQUU1QixRQUFJLENBQUMsT0FBTyxHQUFHLFlBQVk7QUFDekIsZUFBUyxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUNwQixrQkFBWSxDQUFDLE9BQU8sQ0FBQyxDQUFBO0FBQ3JCLGFBQU8sQ0FBQyxHQUFHLENBQUMsOEJBQThCLENBQUMsQ0FBQztLQUM3QyxDQUFBO0dBQ0Y7O0FBRUQsTUFBSSxFQUFFLEdBQUcsSUFBSSxhQUFhLENBQUMsSUFBSSxDQUFDLENBQUE7O0FBRWhDLElBQUUsQ0FBQyxNQUFNLEVBQUUsQ0FBQTtBQUNYLElBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQTtBQUNSLElBQUUsQ0FBQyxPQUFPLEVBQUU7QUFBQSxDQUNiOzs7Ozs7Ozs7Ozs7QUFBQSxBQWNELFNBQVMsS0FBSyxHQUFHOztBQUVmLFdBQVMsT0FBTyxDQUFFLEtBQUssRUFBRTtBQUN2QixRQUFJLENBQUMsTUFBTSxHQUFHLEtBQUssQ0FBQTs7QUFFbkIsUUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUE7QUFDdkIsUUFBSSxDQUFDLE1BQU0sR0FBRyxZQUFZO0FBQ3hCLFVBQUksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFBO0tBQ3ZCLENBQUE7QUFDRCxRQUFJLENBQUMsT0FBTyxHQUFHLFlBQVk7QUFDekIsVUFBSSxDQUFDLFVBQVUsR0FBRyxLQUFLLENBQUE7S0FDeEIsQ0FBQTtHQUNGOztBQUVELFdBQVMsTUFBTSxDQUFFLEtBQUssRUFBRTtBQUN0QixXQUFPLENBQUMsS0FBSyxDQUFDLElBQUksRUFBRSxTQUFTLENBQUMsQ0FBQTs7QUFFOUIsUUFBSSxRQUFRLEdBQUcsS0FBSyxHQUFHLEdBQUcsQ0FBQTtBQUMxQixRQUFJLElBQUksR0FBRyxFQUFFLENBQUE7O0FBRWIsUUFBSSxDQUFDLE9BQU8sR0FBRyxZQUFXO0FBQ3hCLFVBQUksQ0FBQyxJQUFJLENBQUMsVUFBVSxFQUFFO0FBQ3BCLGNBQU0sSUFBSSxLQUFLLENBQUMsdUNBQXVDLENBQUMsQ0FBQTtPQUN6RDs7QUFFRCxXQUFLLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsU0FBUyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBRTtBQUN6QyxZQUFJLElBQUksQ0FBQyxNQUFNLElBQUksUUFBUSxFQUFFO0FBQzNCLGdCQUFNLElBQUksS0FBSyxDQUFDLFlBQVksR0FBRyxTQUFTLENBQUMsQ0FBQyxDQUFDLEdBQUcsdUJBQXVCLENBQUMsQ0FBQTtTQUN2RSxNQUFNO0FBQ0wsY0FBSSxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUN4QjtPQUNGO0tBQ0YsQ0FBQTs7QUFFRCxRQUFJLENBQUMsT0FBTyxHQUFHLFlBQVc7QUFDeEIsYUFBTyxJQUFJLENBQUMsS0FBSyxFQUFFO0FBQUEsS0FDcEIsQ0FBQTtHQUNGOztBQUVELE1BQUksTUFBTSxHQUFHLElBQUksTUFBTSxDQUFDLEdBQUcsQ0FBQzs7O0FBQUEsQUFHNUIsUUFBTSxDQUFDLE1BQU0sRUFBRTtBQUFBLEFBQ2YsTUFBSTtBQUNGLFVBQU0sQ0FBQyxPQUFPLENBQUMsTUFBTSxFQUFFLE1BQU0sRUFBRSxPQUFPLENBQUMsQ0FBQTtHQUN4QyxDQUFDLE9BQU0sQ0FBQyxFQUFFO0FBQ1QsV0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDO0FBQ25DLFdBQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFLDJCQUEyQixDQUFDLENBQUE7R0FDM0Q7O0FBRUQsTUFBSSxRQUFRLEdBQUcsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFBO0FBQy9CLFVBQVEsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUE7O0FBRXRCLFNBQU8sQ0FBQyxHQUFHLENBQUMsUUFBUSxFQUFFLGVBQWUsQ0FBQyxDQUFBO0FBQ3RDLFNBQU8sQ0FBQyxHQUFHLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxFQUFFLHNDQUFzQyxDQUFDLENBQUE7Q0FDdEU7Ozs7Ozs7OztBQUFBLEFBV0QsU0FBUyxLQUFLLEdBQUc7O0FBRWYsV0FBUyxPQUFPLENBQUUsS0FBSyxFQUFFO0FBQ3ZCLFFBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFBO0FBQ25CLFFBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFBO0FBQ3ZCLFFBQUksQ0FBQyxNQUFNLEdBQUcsWUFBWTtBQUN4QixVQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQTtLQUN2QixDQUFBO0FBQ0QsUUFBSSxDQUFDLE9BQU8sR0FBRyxZQUFZO0FBQ3pCLFVBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFBO0tBQ3hCLENBQUE7R0FDRjs7QUFFRCxXQUFTLE1BQU0sQ0FBRSxLQUFLLEVBQUU7QUFDdEIsV0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUE7O0FBRTlCLFFBQUksUUFBUSxHQUFHLEtBQUssR0FBRyxHQUFHLENBQUE7QUFDMUIsUUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFBOztBQUViLFFBQUksQ0FBQyxPQUFPLEdBQUcsWUFBVztBQUN4QixVQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtBQUNwQixjQUFNLElBQUksS0FBSyxDQUFDLHVDQUF1QyxDQUFDLENBQUE7T0FDekQ7O0FBRUQsV0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDekMsWUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLFFBQVEsRUFBRTtBQUMzQixnQkFBTSxJQUFJLEtBQUssQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLHVCQUF1QixDQUFDLENBQUE7U0FDdkUsTUFBTTtBQUNMLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDeEI7T0FDRjtLQUNGLENBQUE7O0FBRUQsUUFBSSxDQUFDLE9BQU8sR0FBRyxZQUFXO0FBQ3hCLGFBQU8sSUFBSSxDQUFDLEtBQUssRUFBRTtBQUFBLEtBQ3BCLENBQUE7O0FBRUQsUUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFTLEdBQUcsRUFBRTtBQUM5QixhQUFPLElBQUksQ0FBQyxNQUFNLENBQUUsVUFBQSxDQUFDO2VBQUksR0FBRyxDQUFDLENBQUMsQ0FBQztPQUFBLENBQUMsQ0FBQTtLQUNqQzs7O0FBQUEsQUFHRCxRQUFJLENBQUMsVUFBVSxHQUFHLFVBQVMsSUFBSSxFQUFFO0FBQy9CLFVBQUksQ0FBQyxHQUFHLENBQUUsVUFBQyxDQUFDLEVBQUUsR0FBRyxFQUFLO0FBQ3BCLFlBQUksQ0FBQyxJQUFJLElBQUksRUFBRTtBQUNiLGNBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFBO1NBQ3BCO09BQ0YsQ0FBQyxDQUFBO0tBQ0g7OztBQUFBLEFBR0QsUUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFTLElBQUksRUFBRTtBQUMvQixVQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBQzVCLFVBQUksR0FBRyxLQUFLLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFBO0tBQ3BDLENBQUE7R0FDRjs7QUFFRCxNQUFJLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUM3QixRQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDaEIsUUFBTSxDQUFDLE9BQU8sQ0FBQztBQUNiLFNBQUssRUFBRSxTQUFTO0FBQ2hCLFlBQVEsRUFBRSxHQUFHO0dBQ2QsQ0FBQyxDQUFDO0FBQ0gsUUFBTSxDQUFDLE9BQU8sQ0FBQztBQUNiLFNBQUssRUFBRSxLQUFLO0FBQ1osWUFBUSxFQUFFLEVBQUU7R0FDYixDQUFDLENBQUM7QUFDSCxRQUFNLENBQUMsT0FBTyxDQUFDO0FBQ2IsU0FBSyxFQUFFLFFBQVE7QUFDZixZQUFRLEVBQUUsRUFBRTtHQUNiLENBQUMsQ0FBQztBQUNILFFBQU0sQ0FBQyxPQUFPLENBQUM7QUFDYixTQUFLLEVBQUUsU0FBUztBQUNoQixZQUFRLEVBQUUsR0FBRztHQUNkLENBQUMsQ0FBQzs7QUFFSCxRQUFNLENBQUMsVUFBVSxDQUFDLGVBQWUsQ0FBQztBQUFDLEFBQ25DLFNBQU8sQ0FBQyxHQUFHLENBQUUsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLE1BQU0sQ0FBQzs7QUFBQyxBQUV0QyxNQUFJLFNBQVMsR0FBRyxNQUFNLENBQUMsVUFBVSxDQUFDLFVBQVMsSUFBSSxFQUFFO0FBQy9DLFdBQU8sSUFBSSxDQUFDLFFBQVEsR0FBRyxFQUFFLENBQUM7R0FDM0IsQ0FBQyxDQUFDOztBQUVILFdBQVMsQ0FBQyxPQUFPLENBQUMsVUFBUyxJQUFJLEVBQUU7QUFDL0IsV0FBTyxDQUFDLEdBQUcsQ0FBRSxJQUFJLENBQUMsS0FBSyxDQUFFO0FBQUMsQUFDMUIsVUFBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQztHQUN6QixDQUFDLENBQUM7O0FBRUgsU0FBTyxDQUFDLEdBQUcsQ0FBRSxNQUFNLENBQUMsT0FBTyxFQUFFLENBQUMsTUFBTSxDQUFFO0NBRXZDO0FBRndDOzs7Ozs7O0FBRXhDLEFBWUQsU0FBUyxLQUFLLEdBQUc7O0FBRWYsV0FBUyxPQUFPLENBQUUsS0FBSyxFQUFFO0FBQ3ZCLFFBQUksQ0FBQyxNQUFNLEdBQUcsS0FBSyxDQUFBO0FBQ25CLFFBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFBO0FBQ3ZCLFFBQUksQ0FBQyxNQUFNLEdBQUcsWUFBWTtBQUN4QixVQUFJLENBQUMsVUFBVSxHQUFHLElBQUksQ0FBQTtLQUN2QixDQUFBO0FBQ0QsUUFBSSxDQUFDLE9BQU8sR0FBRyxZQUFZO0FBQ3pCLFVBQUksQ0FBQyxVQUFVLEdBQUcsS0FBSyxDQUFBO0tBQ3hCLENBQUE7R0FDRjs7QUFFRCxXQUFTLE1BQU0sQ0FBRSxLQUFLLEVBQUU7QUFDdEIsV0FBTyxDQUFDLEtBQUssQ0FBQyxJQUFJLEVBQUUsU0FBUyxDQUFDLENBQUE7O0FBRTlCLFFBQUksUUFBUSxHQUFHLEtBQUssR0FBRyxHQUFHLENBQUE7QUFDMUIsUUFBSSxJQUFJLEdBQUcsRUFBRSxDQUFBOztBQUViLFFBQUksQ0FBQyxPQUFPLEdBQUcsWUFBVztBQUN4QixVQUFJLENBQUMsSUFBSSxDQUFDLFVBQVUsRUFBRTtBQUNwQixjQUFNLElBQUksS0FBSyxDQUFDLHVDQUF1QyxDQUFDLENBQUE7T0FDekQ7O0FBRUQsV0FBSyxJQUFJLENBQUMsR0FBRyxDQUFDLEVBQUUsQ0FBQyxHQUFHLFNBQVMsQ0FBQyxNQUFNLEVBQUUsQ0FBQyxFQUFFLEVBQUU7QUFDekMsWUFBSSxJQUFJLENBQUMsTUFBTSxJQUFJLFFBQVEsRUFBRTtBQUMzQixnQkFBTSxJQUFJLEtBQUssQ0FBQyxZQUFZLEdBQUcsU0FBUyxDQUFDLENBQUMsQ0FBQyxHQUFHLHVCQUF1QixDQUFDLENBQUE7U0FDdkUsTUFBTTtBQUNMLGNBQUksQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7U0FDeEI7T0FDRjtLQUNGLENBQUE7O0FBRUQsUUFBSSxDQUFDLE9BQU8sR0FBRyxZQUFXO0FBQ3hCLGFBQU8sSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFBO0tBQ3BCLENBQUE7O0FBRUQsUUFBSSxDQUFDLFVBQVUsR0FBRyxVQUFTLEdBQUcsRUFBRTtBQUM5QixhQUFPLElBQUksQ0FBQyxNQUFNLENBQUUsVUFBQSxDQUFDO2VBQUksR0FBRyxDQUFDLENBQUMsQ0FBQztPQUFBLENBQUMsQ0FBQTtLQUNqQyxDQUFBOztBQUVELFFBQUksQ0FBQyxVQUFVLEdBQUcsVUFBUyxJQUFJLEVBQUU7QUFDL0IsVUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUM1QixVQUFJLEdBQUcsS0FBSyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQTtLQUNwQyxDQUFBOztBQUVELFFBQUksU0FBUyxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7O0FBRTVCLFFBQUksQ0FBQyxPQUFPLEdBQUcsWUFBWTtBQUN6QixVQUFJLElBQUksQ0FBQyxNQUFNLEdBQUcsQ0FBQyxFQUFFO0FBQ25CLGNBQU0sSUFBSSxLQUFLLENBQUMsd0NBQXdDLENBQUMsQ0FBQTtPQUMxRDs7QUFFRCxlQUFTLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFBO0tBQ3JCLENBQUE7R0FDRjs7QUFFRCxNQUFJLE1BQU0sR0FBRyxJQUFJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUM3QixRQUFNLENBQUMsTUFBTSxFQUFFLENBQUM7QUFDaEIsUUFBTSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsQ0FBQztBQUMxQixRQUFNLENBQUMsT0FBTyxFQUFFO0FBQUMsQ0FDbEI7QUFDRCxLQUFLLEVBQUUsQ0FBQSIsImZpbGUiOiJvb3BfZnVuY3Rpb25hbC8wMy5pbmhlcml0YW5jZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qXG5CYXNlIGNsYXNzIE1hY2hpbmUgcmVhbGl6ZSBjb21tb24gZW5hYmxlKCkgYW5kIGRpc2FibGUoKSBtZXRob2RzXG5cbkluaGVyaXQgQ29mZmVlTWFjaGluZSBmcm9tIE1hY2hpbmUsIHZpYSBjYWxsKClcbiovXG5cbmZ1bmN0aW9uIGV4YW1wbGUxICgpIHtcbiAgXG4gIGZ1bmN0aW9uIE1hY2hpbmUgKCkge1xuICAgIHZhciBpc0VuYWJsZWQgPSBmYWxzZVxuXG4gICAgdGhpcy5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmlzRW5hYmxlZCA9IHRydWVcbiAgICB9XG5cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLmlzRW5hYmxlZCA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gQ29mZmVlTWFjaGluZSAoKSB7XG4gICAgTWFjaGluZS5jYWxsKHRoaXMpIC8vaW5oZXJpdCBtYWNoaW5lIG1ldGhvZHNcbiAgICB2YXIgd2F0ZXJBbW91bnQgPSAwXG5cbiAgICB0aGlzLnNldFdhdGVyQW1vdW50ID0gZnVuY3Rpb24oYW1vdW50KSB7XG4gICAgICB3YXRlckFtb3VudCA9IGFtb3VudDtcbiAgICB9O1xuICB9XG5cbiAgdmFyIGNtID0gbmV3IENvZmZlZU1hY2hpbmUoMTAwMDApO1xuICBjbS5lbmFibGUoKTtcbiAgY20uc2V0V2F0ZXJBbW91bnQoMTAwKTtcbiAgY20uZGlzYWJsZSgpO1xufVxuLy8gZXhhbXBsZTEoKVxuXG5cblxuXG4vKlByb2JsZW06IHByaXZhdGUgUGFyZW50IG1ldGhvZHMgYXJlIHVuYXZhaWxhYmxlIGZyb20gRGVzY2VuZGFuZFxuXG5EZXNpY2lvbjogbWFrZSBBTEwgUGFyZW50IG1ldGhvZHMgcHVibGljIChhdHRhY2ggdG8gdGhpcyksXG4gICAgICAgICAgYW5kIGRlZmluZSBwcml2YXRlIG1ldGhvZHMgd2l0aCB1bmRlcnNjb3JlIGF0IHN0YXJ0OiBfcHJpdmF0ZU1ldGhvZFxuXG4gICAgICAgICAgSXQncyBhIENvbnZlbnRpb24gbm90IGEgUnVsZSAoYmUgY2FyZWZ1bClcbiovXG5cbmZ1bmN0aW9uIGV4YW1wbGUyICgpIHtcbiAgXG4gIGZ1bmN0aW9uIE1hY2hpbmUgKCkge1xuICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlIC8vdGhpcyBpcyBQcml2YXRlIHByb3BlcnR5OiBhY2Nlc3Mgb25seSBmcm9tIFBhcmVudCBhbmQgRGVzY2VuZGFudHMsIG5vIG91dHNpZGUhXG4gICAgdGhpcy5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSB0cnVlXG4gICAgfVxuICAgIHRoaXMuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gQ29mZmVlTWFjaGluZSAoKSB7XG4gICAgTWFjaGluZS5jYWxsKHRoaXMpIC8vaW5oZXJpdCBtYWNoaW5lIG1ldGhvZHNcbiAgICB0aGlzLmVuYWJsZSgpXG4gICAgY29uc29sZS5sb2codGhpcy5faXNFbmFibGVkKVxuICB9XG5cbiAgdmFyIGNtID0gbmV3IENvZmZlZU1hY2hpbmUoMTAwMDApO1xufVxuLy8gZXhhbXBsZTIoKVxuXG5cblxuXG5cblxuLypcbiAgVGFzazogYWRkIHBvd2VyIGFyZ3VtZW50IHRvIGFsbCBtYWNoaW5lc1xuXG4gIHVzZSBQYXJlbnQuYXBwbHkodGhpcywgYXJndW1lbnRzKSwgdG8gaW52b2tlIFBhcmVudCBpbnNpZGUgRGVzY2VuZGFudFxuICB3aXRoIGNvcnJlY3QgY29udGV4dCBhbmQgcGFyYW1ldGVycyBwYXNzZWQgdG8gRGVzY2VuZGFudFxuXG4qL1xuXG5mdW5jdGlvbiBleGFtcGxlMygpIHtcblxuICBmdW5jdGlvbiBNYWNoaW5lIChwb3dlcikge1xuICAgIHRoaXMuX3Bvd2VyID0gcG93ZXJcblxuICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgdGhpcy5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSB0cnVlXG4gICAgfVxuICAgIHRoaXMuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gQ29mZmVlTWFjaGluZSAocG93ZXIpIHtcbiAgICBNYWNoaW5lLmFwcGx5KHRoaXMsIGFyZ3VtZW50cykgLy8gYXBwbHkgTSBmdW5jdGlvbiB3aXRoIENNIGFyZ3VtZW50c1xuXG4gICAgY29uc29sZS5sb2codGhpcy5faXNFbmFibGVkKTtcbiAgICBjb25zb2xlLmxvZyh0aGlzLl9wb3dlcik7XG4gIH1cblxuICB2YXIgY20gPSBuZXcgQ29mZmVlTWFjaGluZSgxMDAwKVxufVxuLy8gZXhhbXBsZTMoKVxuXG5cblxuXG4vKlxuICBUYXNrOiBFeHRlbmQgUGFyZW50cyBtZXRob2RzIGluIERlc2NlbmRhbnRcbiovXG5cblxuXG5mdW5jdGlvbiBleGFtcGxlNCgpIHtcblxuICBmdW5jdGlvbiBNYWNoaW5lIChwb3dlcikge1xuICAgIHRoaXMuX3Bvd2VyID0gcG93ZXJcblxuICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgdGhpcy5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSB0cnVlXG4gICAgfVxuICAgIHRoaXMuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgLy8xLiBPdmVycmlkaW5nIG1ldGhvZCAoYmFkIHBvdGVudGlhbGx5KVxuXG4gIGZ1bmN0aW9uIENvZmZlZU1hY2hpbmUgKHBvd2VyLCBjYXBhY2l0eSkge1xuICAgIE1hY2hpbmUuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuXG4gICAgdGhpcy5lbmFibGUgPSBmdW5jdGlvbigpIHtcbiAgICAgIC8vdG90YWxseSBuZXcgZW5hYmxlXG4gICAgfVxuICB9XG5cblxuICAvKiAyLiBFeHRlbmRpbmcgdGhlIHBhcmVudCBtZXRob2QgKGJldHRlcilcbiAgICAgICAgYS4gU2F2ZSBwYXJlbnQgbWV0aG9kIGluIHZhcmlhYmxlXG4gICAgICAgIGIuIGRlZmluZSBuZXcgZnVuY3Rpb24gKGFzIE92ZXJyaWRpbmcgbWV0aG9kKVxuICAgICAgICBjLiBjYWxsIHByZXZpb3VzbHkgc2F2ZWQgbWV0aG9kIHdpdGggRGVzY2VuZGFudCBjb250ZXh0IHBhc3NpbmcgXG4gICovXG5cblxuICBmdW5jdGlvbiBGcmlkZ2UgKHBvd2VyLCBjYXBhY2l0eSkge1xuICAgIE1hY2hpbmUuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuXG4gICAgdmFyIHBhcmVudEVuYWJsZSA9IHRoaXMuZW5hYmxlICAvL2FcblxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24oKSB7IC8vIGJcbiAgICAgIHBhcmVudEVuYWJsZS5jYWxsKHRoaXMpIC8vIGNcbiAgICAgIFxuICAgICAgLy8gbmV3IGV4dGVuZGVkIHN0dWZmXG4gICAgfVxuICB9XG5cblxuXG4gIHZhciBjbSA9IG5ldyBDb2ZmZWVNYWNoaW5lKDEwMDApXG59XG4vLyBleGFtcGxlNCgpXG5cblxuXG5cblxuLypUYXNrIDE6IFxuTWFrZSBtZXRob2QgcnVuIGNhdXNlcyB0byBlcnJvciB3aGVuIENNIGlzIG9mZlxuKi9cblxuZnVuY3Rpb24gdGFzazEoKSB7XG5cbiAgZnVuY3Rpb24gTWFjaGluZSAocG93ZXIpIHtcbiAgICB0aGlzLl9wb3dlciA9IHBvd2VyXG5cbiAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZVxuICAgIH1cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIENvZmZlZU1hY2hpbmUgKHBvd2VyKSB7XG4gICAgTWFjaGluZS5hcHBseSh0aGlzLCBhcmd1bWVudHMpIC8vIGFwcGx5IE0gZnVuY3Rpb24gd2l0aCBDTSBhcmd1bWVudHNcblxuICAgIHZhciBvblJlYWR5ID0gZnVuY3Rpb24gKCkge1xuICAgICAgY29uc29sZS5sb2coXCJZb3VyIGNvZmZlZSBpcyByZWFkeSFcIik7XG4gICAgfVxuXG4gICAgdGhpcy5ydW4gPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNvZmZlZU1hY2hpbmUgaXMgdHVybmVkIG9mZi5cIilcbiAgICAgIH1cbiAgICAgIG9uUmVhZHkoKVxuICAgIH1cbiAgfVxuXG4gIHZhciBjbSA9IG5ldyBDb2ZmZWVNYWNoaW5lKDEwMDApXG4gIC8vIGNtLnJ1bigpIC8vRXJyb3JcblxuICBjbS5lbmFibGUoKVxuICBjbS5ydW4oKSAvL09rXG59XG4vLyB0YXNrMSgpXG5cblxuXG4vKlRhc2sgMjpcblN0b3AgQ00gd2hlbiBpdCBkaXNhYmxlZFxuKi9cblxuZnVuY3Rpb24gdGFzazMoKSB7XG5cbiAgZnVuY3Rpb24gTWFjaGluZSAocG93ZXIpIHtcbiAgICB0aGlzLl9wb3dlciA9IHBvd2VyXG5cbiAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIHRoaXMuZW5hYmxlID0gZnVuY3Rpb24gKCkge1xuICAgICAgdGhpcy5faXNFbmFibGVkID0gdHJ1ZVxuICAgIH1cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSBmYWxzZVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIENvZmZlZU1hY2hpbmUgKHBvd2VyLCBjYXBhY2l0eSkge1xuICAgIE1hY2hpbmUuYXBwbHkodGhpcywgYXJndW1lbnRzKSAvLyBhcHBseSBNIGZ1bmN0aW9uIHdpdGggQ00gYXJndW1lbnRzXG5cbiAgICB2YXIgdGltZXJJRDtcblxuICAgIGZ1bmN0aW9uIGJvaWxUaW1lKCkge1xuICAgICAgcmV0dXJuIDMwMDBcbiAgICB9XG5cbiAgICB2YXIgb25SZWFkeSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiWW91ciBjb2ZmZWUgaXMgcmVhZHkhXCIpO1xuICAgIH1cblxuICAgIHRoaXMucnVuID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMuX2lzRW5hYmxlZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb2ZmZWVNYWNoaW5lIGlzIHR1cm5lZCBvZmYuXCIpXG4gICAgICB9XG4gICAgICB0aW1lcklEID0gc2V0VGltZW91dChvblJlYWR5LCBib2lsVGltZSgpKTtcbiAgICB9XG5cbiAgICB2YXIgX19kaXNhYmxlID0gdGhpcy5kaXNhYmxlXG5cbiAgICB0aGlzLmRpc2FibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICBfX2Rpc2FibGUuY2FsbCh0aGlzKVxuICAgICAgY2xlYXJUaW1lb3V0KHRpbWVySUQpXG4gICAgICBjb25zb2xlLmxvZygnVHVybmVkIG9mZi4gU29ycnksIG5vIGNvZmZlZScpO1xuICAgIH1cbiAgfVxuXG4gIHZhciBjbSA9IG5ldyBDb2ZmZWVNYWNoaW5lKDEwMDApXG5cbiAgY20uZW5hYmxlKClcbiAgY20ucnVuKCkgXG4gIGNtLmRpc2FibGUoKSAvLyBObyBvblJlYWR5IG1lc3NhZ2Vcbn1cbi8vIHRhc2syKClcblxuXG5cbi8qVGFzayAzOlxuSW5oZXJpdCBGcmlkZ2UgZnJvbSBNYWNoaW5lIHdpdGggcHJpdmF0ZSBmb29kIGFuZCBtZXRob2RzIGFkZEZvb2QgYW5kIGdldEZvb2RcbmZvb2QgPSBhcnJheVxuYWRkRm9vZChpWywgaTEsIGkyIC4uLl0pXG5nZXRGb29kKClcblxuXG4qL1xuXG5mdW5jdGlvbiB0YXNrMygpIHtcblxuICBmdW5jdGlvbiBNYWNoaW5lIChwb3dlcikge1xuICAgIHRoaXMuX3Bvd2VyID0gcG93ZXJcblxuICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgdGhpcy5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSB0cnVlXG4gICAgfVxuICAgIHRoaXMuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gRnJpZGdlIChwb3dlcikge1xuICAgIE1hY2hpbmUuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuXG4gICAgdmFyIENBUEFTSVRZID0gcG93ZXIgLyAxMDBcbiAgICB2YXIgZm9vZCA9IFtdXG5cbiAgICB0aGlzLmFkZEZvb2QgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGFkZCBmb29kLiBGcmlkZ2UgaXMgdHVybmVkIG9mZi5cIilcbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGZvb2QubGVuZ3RoID49IENBUEFTSVRZKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYWRkIFwiICsgYXJndW1lbnRzW2ldICsgXCIuIE1heCBjYXBhY2l0eSBsaW1pdC5cIikgIFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvb2QucHVzaChhcmd1bWVudHNbaV0pICBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZ2V0Rm9vZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGZvb2Quc2xpY2UoKSAvLyBuZXcgYXJyYXkgdG8gcHJldmVudCBvdXRzaWRlIHJlYWNoaW5nXG4gICAgfVxuICB9XG4gIFxuICB2YXIgZnJpZGdlID0gbmV3IEZyaWRnZSgyMDApXG4gIC8vIGZyaWRnZS5hZGRGb29kKCdNZWF0JykgLy9FcnJvclxuXG4gIGZyaWRnZS5lbmFibGUoKSAvL0Vycm9yXG4gIHRyeSB7XG4gICAgZnJpZGdlLmFkZEZvb2QoJ0Zpc2gnLCBcIk1pbGtcIiwgXCJCcmVhZFwiKVxuICB9IGNhdGNoKGUpIHtcbiAgICBjb25zb2xlLmxvZygnU29ycnksIG1heCBjYXBhY2l0eScpO1xuICAgIGNvbnNvbGUubG9nKGZyaWRnZS5nZXRGb29kKCksICdhZGQgYWxsIGV4Y2VwdCBvdmVyZmxvd2VkJylcbiAgfVxuICBcbiAgdmFyIG11dGF0aW9uID0gZnJpZGdlLmdldEZvb2QoKVxuICBtdXRhdGlvbi5wdXNoKCdCcmVhZCcpXG5cbiAgY29uc29sZS5sb2cobXV0YXRpb24sICdtdXRhdGVkIGFycmF5JylcbiAgY29uc29sZS5sb2coZnJpZGdlLmdldEZvb2QoKSwgJ25vIG11dGF0aW9uIGluIHByaXZhdGUgcHJvcGVydHkgZm9vZCcpXG59XG4vLyB0YXNrMygpXG5cblxuXG4vKlxudGFzayA0OlxuYWRkIHB1YmxpYyBmaWx0ZXJGb29kKGZ1bmMpXG5hZGQgcHVibGljIHJlbW92ZUZvb2QoaXRlbSlcbiovXG5cbmZ1bmN0aW9uIHRhc2s0KCkge1xuXG4gIGZ1bmN0aW9uIE1hY2hpbmUgKHBvd2VyKSB7XG4gICAgdGhpcy5fcG93ZXIgPSBwb3dlclxuICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgdGhpcy5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSB0cnVlXG4gICAgfVxuICAgIHRoaXMuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gRnJpZGdlIChwb3dlcikge1xuICAgIE1hY2hpbmUuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuXG4gICAgdmFyIENBUEFTSVRZID0gcG93ZXIgLyAxMDBcbiAgICB2YXIgZm9vZCA9IFtdXG5cbiAgICB0aGlzLmFkZEZvb2QgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGFkZCBmb29kLiBGcmlkZ2UgaXMgdHVybmVkIG9mZi5cIilcbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGZvb2QubGVuZ3RoID49IENBUEFTSVRZKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYWRkIFwiICsgYXJndW1lbnRzW2ldICsgXCIuIE1heCBjYXBhY2l0eSBsaW1pdC5cIikgIFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvb2QucHVzaChhcmd1bWVudHNbaV0pICBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZ2V0Rm9vZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGZvb2Quc2xpY2UoKSAvLyBuZXcgYXJyYXkgdG8gcHJldmVudCBvdXRzaWRlIHJlYWNoaW5nXG4gICAgfVxuXG4gICAgdGhpcy5maWx0ZXJGb29kID0gZnVuY3Rpb24oZmx0KSB7XG4gICAgICByZXR1cm4gZm9vZC5maWx0ZXIoIGkgPT4gZmx0KGkpKVxuICAgIH1cblxuICAgIC8vZHVtcCBtZXRob2Q6IHdvcmtzIG9ubHkgd2l0aCBpdGVtcyBmcm9tIGZyaWRnZVxuICAgIHRoaXMucmVtb3ZlRm9vZCA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIGZvb2QubWFwKCAoaSwgaWR4KSA9PiB7XG4gICAgICAgIGlmIChpID09IGl0ZW0pIHtcbiAgICAgICAgICBmb29kLnNwbGljZShpZHgsIDEpXG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgfVxuXG4gICAgLy8gZmFzdGVyIHdpdGggaW5kZXhPZlxuICAgIHRoaXMucmVtb3ZlRm9vZCA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICAgIHZhciBpZHggPSBmb29kLmluZGV4T2YoaXRlbSlcbiAgICAgIGlmIChpZHggIT09IC0xKSBmb29kLnNwbGljZShpZHgsIDEpXG4gICAgfVxuICB9XG4gIFxuICB2YXIgZnJpZGdlID0gbmV3IEZyaWRnZSg1MDApO1xuICBmcmlkZ2UuZW5hYmxlKCk7XG4gIGZyaWRnZS5hZGRGb29kKHtcbiAgICB0aXRsZTogXCLQutC+0YLQu9C10YLQsFwiLFxuICAgIGNhbG9yaWVzOiAxMDBcbiAgfSk7XG4gIGZyaWRnZS5hZGRGb29kKHtcbiAgICB0aXRsZTogXCLRgdC+0LpcIixcbiAgICBjYWxvcmllczogMzBcbiAgfSk7XG4gIGZyaWRnZS5hZGRGb29kKHtcbiAgICB0aXRsZTogXCLQt9C10LvQtdC90YxcIixcbiAgICBjYWxvcmllczogMTBcbiAgfSk7XG4gIGZyaWRnZS5hZGRGb29kKHtcbiAgICB0aXRsZTogXCLQstCw0YDQtdC90YzQtVwiLFxuICAgIGNhbG9yaWVzOiAxNTBcbiAgfSk7XG5cbiAgZnJpZGdlLnJlbW92ZUZvb2QoXCLQvdC10YIg0YLQsNC60L7QuSDQtdC00YtcIik7IC8vINCx0LXQtyDRjdGE0YTQtdC60YLQsFxuICBjb25zb2xlLmxvZyggZnJpZGdlLmdldEZvb2QoKS5sZW5ndGgpOyAvLyA0XG5cbiAgdmFyIGRpZXRJdGVtcyA9IGZyaWRnZS5maWx0ZXJGb29kKGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICByZXR1cm4gaXRlbS5jYWxvcmllcyA8IDUwO1xuICB9KTtcblxuICBkaWV0SXRlbXMuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XG4gICAgY29uc29sZS5sb2coIGl0ZW0udGl0bGUgKTsgLy8g0YHQvtC6LCDQt9C10LvQtdC90YxcbiAgICBmcmlkZ2UucmVtb3ZlRm9vZChpdGVtKTtcbiAgfSk7XG5cbiAgY29uc29sZS5sb2coIGZyaWRnZS5nZXRGb29kKCkubGVuZ3RoICk7IC8vIDJcblxufVxuLy8gdGFzazQoKVxuXG5cblxuXG5cbi8qXG50YXNrIDU6XG5tb2RpZnkgZGlzYWJsZSBtZXRob2Q6IGlmIGZvb2QgLT4gZXJyb3JcbiovXG5cbmZ1bmN0aW9uIHRhc2s1KCkge1xuXG4gIGZ1bmN0aW9uIE1hY2hpbmUgKHBvd2VyKSB7XG4gICAgdGhpcy5fcG93ZXIgPSBwb3dlclxuICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgdGhpcy5lbmFibGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB0aGlzLl9pc0VuYWJsZWQgPSB0cnVlXG4gICAgfVxuICAgIHRoaXMuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIHRoaXMuX2lzRW5hYmxlZCA9IGZhbHNlXG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gRnJpZGdlIChwb3dlcikge1xuICAgIE1hY2hpbmUuYXBwbHkodGhpcywgYXJndW1lbnRzKVxuXG4gICAgdmFyIENBUEFTSVRZID0gcG93ZXIgLyAxMDBcbiAgICB2YXIgZm9vZCA9IFtdXG5cbiAgICB0aGlzLmFkZEZvb2QgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghdGhpcy5faXNFbmFibGVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhbid0IGFkZCBmb29kLiBGcmlkZ2UgaXMgdHVybmVkIG9mZi5cIilcbiAgICAgIH1cblxuICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGZvb2QubGVuZ3RoID49IENBUEFTSVRZKSB7XG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3QgYWRkIFwiICsgYXJndW1lbnRzW2ldICsgXCIuIE1heCBjYXBhY2l0eSBsaW1pdC5cIikgIFxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGZvb2QucHVzaChhcmd1bWVudHNbaV0pICBcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuZ2V0Rm9vZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIGZvb2Quc2xpY2UoKVxuICAgIH1cblxuICAgIHRoaXMuZmlsdGVyRm9vZCA9IGZ1bmN0aW9uKGZsdCkge1xuICAgICAgcmV0dXJuIGZvb2QuZmlsdGVyKCBpID0+IGZsdChpKSlcbiAgICB9XG5cbiAgICB0aGlzLnJlbW92ZUZvb2QgPSBmdW5jdGlvbihpdGVtKSB7XG4gICAgICB2YXIgaWR4ID0gZm9vZC5pbmRleE9mKGl0ZW0pXG4gICAgICBpZiAoaWR4ICE9PSAtMSkgZm9vZC5zcGxpY2UoaWR4LCAxKVxuICAgIH1cblxuICAgIHZhciBfX2Rpc2FibGUgPSB0aGlzLmRpc2FibGVcblxuICAgIHRoaXMuZGlzYWJsZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGlmIChmb29kLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRXJyb3I6IENhbid0IGRpc2FibGUgZnJpZGdlIHdpdGggZm9vZCFcIilcbiAgICAgIH1cblxuICAgICAgX19kaXNhYmxlLmNhbGwodGhpcylcbiAgICB9XG4gIH1cbiAgXG4gIHZhciBmcmlkZ2UgPSBuZXcgRnJpZGdlKDUwMCk7XG4gIGZyaWRnZS5lbmFibGUoKTtcbiAgZnJpZGdlLmFkZEZvb2QoXCLQutGD0YEt0LrRg9GBXCIpO1xuICBmcmlkZ2UuZGlzYWJsZSgpOyAvLyDQvtGI0LjQsdC60LAsINCyINGF0L7Qu9C+0LTQuNC70YzQvdC40LrQtSDQtdGB0YLRjCDQtdC00LBcbn1cbnRhc2s1KClcblxuXG5cbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
